(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{160:function(e,t,a){e.exports=a.p+"static/media/logo.024bbe57.PNG"},170:function(e,t,a){e.exports=a(332)},176:function(e,t,a){},332:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),s=a(4),o=a.n(s),l=(a(175),a(176),a(11)),i=a(52),c=a(150),u=a(20);var d=a(89);function m(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,n)}return a}function f(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?m(Object(a),!0).forEach(function(t){Object(d.a)(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):m(Object(a)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}var g={profile:null,search:!1};function p(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,n)}return a}function v(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?p(Object(a),!0).forEach(function(t){Object(d.a)(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):p(Object(a)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}var h=Object(i.c)({dialogs:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;if("DIALOGS_RECEIVED"===t.type){var a=Object(u.a)(e),n=a.find(function(e){return e.active});return a=t.dialogs,n&&a.forEach(function(e){e.ConversationId===n.ConversationId&&(e.active=!0)}),a}if("OPEN_DIALOG"===t.type){var r=Object(u.a)(e);if("dialog"===t.payload.type)r.forEach(function(e){e.active=!1,e.ConversationId===t.payload.data.ConversationId&&(e.active=!0,e.UnreadedCount=0,e.type=t.payload.type)});else if("user"===t.payload.type)if(r.find(function(e){return e.SecondUid===t.payload.data.Id}))r.forEach(function(e){e.active=!1,e.SecondUid===t.payload.data.Id&&(e.active=!0,e.UnreadedCount=0,e.type="dialog")});else{var s={};s.ConversationId=t.payload.data.Id,s.Title=t.payload.data.NameFirst+" "+t.payload.data.NameSecond,s.Photo=t.payload.data.Photo,s.ConversationType=1,s.SecondUid=t.payload.data.Id,s.fake=!0,r.push(s),r.forEach(function(e){e.active=!1,e.ConversationId===t.payload.data.Id&&(e.active=!0,e.UnreadedCount=0,e.type=t.payload.type)})}else"channel"===t.payload.type&&(r.push(t.payload.data),r.forEach(function(e){e.active=!1,e.ConversationId===t.payload.data.Id&&(e.active=!0,e.UnreadedCount=0,e.type=t.payload.type,e.fake=!0)}));return r}if("MESSAGES_RECEIVED"===t.type){var o=Object(u.a)(e);if(t.messages.length){var l=t.messages[0].ConversationId;o.forEach(function(e){e.ConversationId===l&&(e.messagesRecieved=!0,e.PreviewText=t.messages[0].Text,e.active||(e.UnreadedCount+=1))})}return o}return e},chats:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;if("CHATS_RECEIVED"===t.type)return Object(u.a)(e),t.chats;if("CHATS_USERS_RECEIVED"===t.type){var a=Object(u.a)(e);return a[0].Id===t.chatsUsers[0].ChatId&&(a[0].Users=t.chatsUsers),a}return e},messages:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;if("MESSAGES_RECEIVED"===t.type){var a=Object(u.a)(e);return t.messages.forEach(function(e){a.find(function(t){return t.GlobalId===e.GlobalId})||a.push(e)}),a.sort(function(e,t){var a=new Date(e.SendingTime),n=new Date(t.SendingTime);return a<n?-1:a>n?1:0})}if("READ_MESSAGES"===t.type){var n=Object(u.a)(e);return n.forEach(function(e){e.GlobalId===t.messageIDs[0].GlobalId&&(e.read=!0)}),n}return e},users:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;if("USER_RECEIVED"===t.type){var a=e;return t.users.length>0&&(a.find(function(e){return e.Id===t.users[0].Id})||(a=[].concat(Object(u.a)(a),Object(u.a)(t.users)))),a}return e},forwardMessage:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;if("FORWARD_MESSAGE"===t.type)return t.message;return e},auth:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"CHECK_AUTH",t=arguments.length>1?arguments[1]:void 0;if("SET_AUTH"===t.type)return t.auth;return e},ui:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g,t=arguments.length>1?arguments[1]:void 0;if("OPEN_PROFILE"===t.type){var a=f({},e);return a.profile=t.dialog,a}if("SEARCH_START"===t.type){var n=f({},e);return n.search=t.text,n}if("SEARCH_END"===t.type){var r=f({},e);return r.search=!1,r}return e},searchResult:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;if("SEARCH_RESULT_RECEIVED"===t.type)return v({},e),t.searchResult;if("SEARCH_END"===t.type)return v({},e),null;return e}});var y=a(19),E=a(46),b=a(340);function I(e){return{type:"DIALOGS_RECEIVED",dialogs:e}}function T(e){return{type:"MESSAGES_RECEIVED",messages:e}}function S(e){return{type:"FORWARD_MESSAGE",message:e}}function O(e){return{type:"OPEN_DIALOG",payload:e}}function C(e){return{type:"USER_RECEIVED",users:e}}var R=a(42),j=a(43),_=a(62),k=a(60),N=a(63),w=a(341),U=a(338),A=a(339),P=a(29),x=a(346),M=a(7),D=function(e){function t(){var e;return Object(R.a)(this,t),(e=Object(_.a)(this,Object(k.a)(t).call(this))).state={nodes:[],activeNode:null},e}return Object(N.a)(t,e),Object(j.a)(t,[{key:"componentDidMount",value:function(){var e=this;fetch("https://223421.selcdn.ru/Eruption-dev/nodes/list.json").then(function(t){t.json().then(function(t){e.setState({nodes:t})})}).catch(function(){})}},{key:"selectNode",value:function(e){this.setState({activeNode:e.item.props.data}),localStorage.setItem("node",JSON.stringify(e.item.props.data))}},{key:"render",value:function(){var e=r.a.createElement(w.a,{onClick:this.selectNode.bind(this)},this.state.nodes.map(function(e,t){return r.a.createElement(w.a.Item,{key:t,data:e},e.Name)}));return r.a.createElement(U.a,{type:"flex",align:"middle",justify:"center",style:{height:"100vh"}},r.a.createElement(A.a,null,r.a.createElement("div",{className:"auth__type"},r.a.createElement("h1",null,"\u0412\u0445\u043e\u0434"),r.a.createElement("h2",null,"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u043f\u043e\u0441\u043e\u0431 \u0432\u0445\u043e\u0434\u0430"),r.a.createElement(y.b,{to:this.props.match.url+"/by-phone"},r.a.createElement(P.a,{type:"secondary"},"\u041f\u043e \u043d\u043e\u043c\u0435\u0440\u0443 \u0442\u0435\u043b\u0435\u0444\u043e\u043d\u0430")),r.a.createElement("br",null),r.a.createElement(y.b,{to:this.props.match.url+"/by-email"},r.a.createElement(P.a,{type:"secondary"},"\u041f\u043e \u044d\u043b\u0435\u043a\u0442\u0440\u043e\u043d\u043d\u043e\u0439 \u043f\u043e\u0447\u0442\u0435")),r.a.createElement("br",null),r.a.createElement(P.a,{type:"secondary"},"\u0427\u0435\u0440\u0435\u0437 \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u0435"),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement(y.b,{to:"/registration"},"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f"),r.a.createElement("br",null),r.a.createElement("div",{className:"auth__type_server"},r.a.createElement("span",null,"\u0421\u0435\u0440\u0432\u0435\u0440: "),r.a.createElement(x.a,{overlay:e},r.a.createElement("span",{className:"ant-dropdown-link"},localStorage.getItem("node")?JSON.parse(localStorage.getItem("node")).Name:"\u0410\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438",r.a.createElement(M.a,{type:"down"})))))))}}]),t}(n.Component),F=a(5),q=a(343),L=a(344),V=new WebSocket("wss://testnode1-1.ymess.org:5000"),G=new(function(){function e(){var t=this;Object(R.a)(this,e),V.onopen=function(){console.log("\u0421\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435 \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u043e"),t.wsOnConnect()},V.onclose=function(e){e.wasClean?console.log("\u0421\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435 \u0437\u0430\u043a\u0440\u044b\u0442\u043e"):console.log("\u041e\u0431\u0440\u044b\u0432 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u044f"),console.log("\u041a\u043e\u0434: ",e)},V.onmessage=function(e){var a=t.blobToJson(e.data);a.ErrorCode&&0!==a.ErrorCode?console.log("%c REQUEST ERR ","background: #ff4545; color: #bada55; padding: 3px",a):(t.onMessage(a),console.log("%c RESPONSE ","background: #00ff00; color: #000; padding: 3px",t.blobToJson(e.data)))},V.onerror=function(e){console.log("%c ERROR CONNECT ","background: red; color: #bada55; padding: 3px",e)}}return Object(j.a)(e,[{key:"getStatus",value:function(){return V.readyState}},{key:"blobToJson",value:function(e){var t,a;return t=URL.createObjectURL(e),(a=new XMLHttpRequest).open("GET",t,!1),a.send(),URL.revokeObjectURL(t),JSON.parse(a.responseText)}},{key:"makeId",value:function(){for(var e="",t="0123456789".length,a=0;a<18;a++)e+="0123456789".charAt(Math.floor(Math.random()*t));return parseInt(e)}},{key:"send",value:function(e){console.log("%c REQUEST ","background: #222; color: #bada55; padding: 3px",e),V.send(JSON.stringify(e))}},{key:"onMessage",value:function(){}},{key:"wsOnConnect",value:function(){}}]),e}());var H=function(){var e=Object(n.useState)(""),t=Object(F.a)(e,2),a=t[0],s=t[1],o=Object(n.useState)(""),l=Object(F.a)(o,2),i=l[0],c=l[1],u=Object(n.useState)(""),d=Object(F.a)(u,2),m=d[0],f=d[1],g=Object(n.useState)(""),p=Object(F.a)(g,2),v=p[0],h=p[1],y=Object(n.useState)(!1),E=Object(F.a)(y,2),b=E[0],I=E[1],T=Object(n.useState)(!1),S=Object(F.a)(T,2),O=S[0],C=S[1],R=Object(n.useState)(!1),j=Object(F.a)(R,2),_=j[0],k=j[1];return Object(n.useEffect)(function(){G.onMessage=function(e){0!==e.ErrorCode||6===e.ResponseType&&(localStorage.getItem("FileAccessToken",e.FileAccessToken),localStorage.getItem("AccessToken",e.Token.AccessToken),localStorage.getItem("RefreshToken",e.Token.RefreshToken),localStorage.getItem("User",e.User),window.location.replace("/"))}},[]),r.a.createElement(U.a,{type:"flex",align:"middle",justify:"center",style:{height:"100vh"}},r.a.createElement(A.a,null,r.a.createElement("div",{className:"auth__type"},r.a.createElement("h1",null,"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f"),r.a.createElement("div",null,r.a.createElement(q.a,{className:"login-form"},r.a.createElement(q.a.Item,{validateStatus:b?"error":"",help:b||""},r.a.createElement(L.a,{placeholder:"\u0418\u043c\u044f",onChange:function(e){s(e.target.value),I(!1)}})),r.a.createElement(q.a.Item,{validateStatus:""},r.a.createElement(L.a,{placeholder:"\u0424\u0430\u043c\u0438\u043b\u0438\u044f",onChange:function(e){c(e.target.value)}})),r.a.createElement(q.a.Item,{validateStatus:O?"error":"",help:O||""},r.a.createElement(L.a,{placeholder:"\u041d\u043e\u043c\u0435\u0440 \u0442\u0435\u043b\u0435\u0444\u043e\u043d\u0430",onChange:function(e){f(e.target.value),C(!1)}})),r.a.createElement(q.a.Item,{validateStatus:O?"error":"",help:O||""},r.a.createElement(L.a,{placeholder:"Email",onChange:function(e){h(e.target.value),C(!1)}})),r.a.createElement(q.a.Item,null,r.a.createElement(U.a,null,r.a.createElement(A.a,{style:{textAlign:"center"}},r.a.createElement(P.a,{type:"primary",onClick:function(){if(0===a.length)I("\u042d\u0442\u043e \u043f\u043e\u043b\u0435 \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e \u0434\u043b\u044f \u0437\u0430\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f");else if(0===m.length&&0===v.length)C("\u041e\u0434\u043d\u043e \u0438\u0437 \u044d\u0442\u0438\u0445 \u043f\u043e\u043b\u0435\u0439 \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e \u0434\u043b\u044f \u0437\u0430\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f");else{k(!0);var e={User:{Id:0,Phones:m,NameFirst:a,NameSecond:i,About:"",Photo:"",Country:"",City:"",Birthday:"",Language:null,NodeId:0,Online:null,Emails:[v],Blacklist:null,Visible:null,Security:null,Tag:0,RegistrationDate:null},RequestId:G.makeId(),RequestType:37,Type:0};G.send(e)}},loading:_},"\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c\u0441\u044f")))))))))},B=function(e){function t(){var e;return Object(R.a)(this,t),(e=Object(_.a)(this,Object(k.a)(t).call(this))).state={verifyUid:null,verifyErr:null,verifyRequestSended:!1,verifyCode:null,verifyCodeErr:null,btnPreloader:!1,verifyType:""},e}return Object(N.a)(t,e),Object(j.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=this.props.location.pathname.split("/");this.setState({verifyType:t[2]}),G.onMessage=function(t){e.setState({btnPreloader:!1}),0!==t.ErrorCode?e.setState({verifyErr:t.Message}):10===t.ResponseType?e.setState({verifyRequestSended:!0}):6===t.ResponseType&&(localStorage.setItem("FileAccessToken",t.FileAccessToken),localStorage.setItem("AccessToken",t.Token.AccessToken),localStorage.setItem("RefreshToken",t.Token.RefreshToken),localStorage.setItem("User",JSON.stringify(t.User)),window.location.replace("/"))}}},{key:"onChangePhone",value:function(e){this.setState({verifyUid:e.target.value,verifyErr:null})}},{key:"onChangeVerifCode",value:function(e){this.setState({verifyCode:e.target.value,verifyCodeErr:null})}},{key:"sendverifyCode",value:function(e){e.preventDefault(),this.setState({btnPreloader:!0});var t={Uid:this.state.verifyUid,VCode:this.state.verifyCode,LoginType:1,UidType:"by-email"===this.state.verifyType?2:(this.state.verifyType,0),RequestId:G.makeId(),RequestType:33,Type:0};G.send(t)}},{key:"sendVerificationQuery",value:function(e){e.preventDefault(),this.setState({btnPreloader:!0});var t={VerificationType:"by-email"===this.state.verifyType?1:(this.state.verifyType,0),Uid:this.state.verifyUid,RequestId:G.makeId(),RequestType:42,Type:0};G.send(t)}},{key:"render",value:function(){return r.a.createElement(U.a,{type:"flex",align:"middle",justify:"center",style:{height:"100vh"}},r.a.createElement(A.a,null,r.a.createElement("div",{className:"auth__type"},r.a.createElement("h1",null,"\u0412\u0445\u043e\u0434"),this.state.verifyRequestSended?r.a.createElement("div",null,r.a.createElement("h2",null,"\u041a\u043e\u0434 \u043f\u043e\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043d\u0438\u044f \u0438\u0437 ","by-email"===this.state.verifyType?"\u043f\u0438\u0441\u044c\u043c\u0430":"by-phone"===this.state.verifyType?"SMS":""),r.a.createElement("p",null,"\u041c\u044b \u043e\u0442\u043f\u0440\u0430\u0432\u0438\u043b\u0438 ","by-email"===this.state.verifyType?"\u043f\u0438\u0441\u044c\u043c\u043e":"by-phone"===this.state.verifyType?"SMS":"","\u043d\u0430 ","by-email"===this.state.verifyType?"email":"by-phone"===this.state.verifyType?"\u043d\u043e\u043c\u0435\u0440":""," ",this.state.verifyUid,". \u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u044b\u0439 \u043a\u043e\u0434 \u0432 \u043f\u043e\u043b\u0435 \u043d\u0438\u0436\u0435"),r.a.createElement(q.a,{onSubmit:this.sendverifyCode.bind(this),className:"login-form"},r.a.createElement(q.a.Item,{validateStatus:this.state.verifyCodeErr?"error":"",help:this.state.verifyCodeErr?this.state.verifyCodeErr:""},r.a.createElement(L.a,{placeholder:"\u041a\u043e\u0434 \u0438\u0437 ".concat("by-email"===this.state.verifyType?"\u043f\u0438\u0441\u044c\u043c\u0430":"by-phone"===this.state.verifyType?"SMS":"",", 4 \u0446\u0438\u0444\u0440\u044b"),onChange:this.onChangeVerifCode.bind(this)})),r.a.createElement(q.a.Item,null,r.a.createElement(U.a,null,r.a.createElement(A.a,{style:{textAlign:"center"}},r.a.createElement(P.a,{type:"primary",htmlType:"submit",disabled:!this.state.verifyCode,loading:!!this.state.btnPreloader},"\u0412\u043e\u0439\u0442\u0438")))))):r.a.createElement("div",null,r.a.createElement("h2",null,"by-email"===this.state.verifyType?"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0432\u0430\u0448 email":"by-phone"===this.state.verifyType?"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043d\u043e\u043c\u0435\u0440 \u0442\u0435\u043b\u0435\u0444\u043e\u043d\u0430":""),r.a.createElement(q.a,{onSubmit:this.sendVerificationQuery.bind(this),className:"login-form"},r.a.createElement(q.a.Item,{validateStatus:this.state.verifyErr?"error":"",help:this.state.verifyErr?this.state.verifyErr:""},r.a.createElement(L.a,{placeholder:"by-email"===this.state.verifyType?"\u0412\u0430\u0448 email":"by-phone"===this.state.verifyType?"\u0412\u0430\u0448 \u043d\u043e\u043c\u0435\u0440 \u0442\u0435\u043b\u0435\u0444\u043e\u043d\u0430":"",onChange:this.onChangePhone.bind(this)})),r.a.createElement(q.a.Item,null,r.a.createElement(U.a,null,r.a.createElement(A.a,{style:{textAlign:"center"}},r.a.createElement(P.a,{type:"primary",htmlType:"submit",disabled:!this.state.verifyUid,loading:!!this.state.btnPreloader},"\u041f\u043e\u043b\u0443\u0447\u0438\u0442\u044c ","by-email"===this.state.verifyType?"\u043f\u0438\u0441\u044c\u043c\u043e":"by-phone"===this.state.verifyType?"SMS":""," \u0441 \u043a\u043e\u0434\u043e\u043c")))))))))}}]),t}(n.Component);var J={getFormatedMessages:function(e){var t=[];return e.forEach(function(e){var a={Attachments:e.Attachments,ConversationId:e.ConversationId,ConversationType:e.ConversationType,GlobalId:e.GlobalId,Read:e.Read,SenderId:e.SenderId,SendingTime:e.SendingTime,Text:e.Text};t.push(a)}),t},getFormatedDialogs:function(e){var t=[];return e.forEach(function(e){var a={AttachmentType:e.AttachmentType,ConversationId:e.ConversationId,ConversationType:e.ConversationType,IsMuted:e.IsMuted,LastMessageId:e.LastMessageId,LastMessageSenderId:e.LastMessageSenderId,LastMessageSenderName:e.LastMessageSenderName,LastMessageTime:e.LastMessageTime,Photo:e.Photo,PreviewText:e.PreviewText,Read:e.Read,SecondUid:e.SecondUid,Title:e.Title,UnreadedCount:e.UnreadedCount,messagesRecieved:e.messagesRecieved};t.push(a)}),t},getFormatedChats:function(e){var t=[];return e.forEach(function(e){var a={About:e.About,Id:e.Id,Key:e.Key,Name:e.Name,NodesId:e.NodesId,Photo:e.Photo,Public:e.Public,Security:e.Security,Tag:e.Tag,Type:e.Type,Users:e.Users,Visible:e.Visible};t.push(a)}),t},getFormatedChatsUsers:function(e){var t=[];return e.forEach(function(e){var a={Banned:e.Banned,ChatId:e.ChatId,Deleted:e.Deleted,InviterId:e.InviterId,IsMuted:e.IsMuted,Joined:e.Joined,UserId:e.UserId,UserInfo:e.UserInfo,UserRole:e.UserRole};t.push(a)}),t},getFormatedUser:function(e){var t=[];return e.forEach(function(e){var a={About:e.About,Birthday:e.Birthday,BlackList:e.BlackList,City:e.City,Confirmed:e.Confirmed,Contact:e.Contact,ContactsPrivacy:e.ContactsPrivacy,Country:e.Country,Emails:e.Emails,Encryption:e.Encryption,Groups:e.Groups,Id:e.Id,Keys:e.Keys,Language:e.Language,NameFirst:e.NameFirst,NameSecond:e.NameSecond,NodeId:e.NodeId,Online:e.Online,Phones:e.Phones,Photo:e.Photo,RegistrationDate:e.RegistrationDate,Security:e.Security,Tag:e.Tag,Visible:e.Visible};t.push(a)}),t},getUserById:function(e,t){return t.find(function(t){return t.Id===e})},getUserInitials:function(e){if(!e.Photo){var t="";if(e.Title||e.ChannelName){var a=e.Title||e.ChannelName;(a=a.split(" ",2))[0]&&(t=a[0][0]),a[1]&&(t+=a[1][0])}else e.NameFirst&&(t=e.NameFirst[0],e.NameSecond&&(t+=e.NameSecond[0]));return t}},getActiveDialog:function(e){return e.find(function(e){return e.active})}},z=function(e){function t(){var e;return Object(R.a)(this,t),(e=Object(_.a)(this,Object(k.a)(t).call(this))).state={defaultAva:""},e}return Object(N.a)(t,e),Object(j.a)(t,[{key:"componentDidMount",value:function(){var e=this.refs.messageText,t=e.innerText;t.length>60&&(e.innerText=t.slice(0,60)+" ..."),this.props.dialog.Photo||this.setState({defaultAva:J.getUserInitials(this.props.dialog)})}},{key:"openDialog",value:function(){var e={};e.type=this.props.type,e.data=this.props.dialog,this.props.openDialog(e)}},{key:"render",value:function(){var e=this,t={width:"100%",height:"100%",backgroundSize:"cover",backgroundPosition:"center center",backgroundImage:"url(https://testnode1-1.ymess.org:5000/api/Files/".concat(this.props.dialog.Photo,")"),backgroundRepeat:"no-repeat"};return r.a.createElement(y.c,{to:"/",onClick:function(){return e.openDialog()}},r.a.createElement("div",{className:"sidebar__item"},r.a.createElement("div",{className:"sidebar__ava"},this.props.dialog.UnreadedCount>0?r.a.createElement("div",{className:"sidebar__badge"},this.props.dialog.UnreadedCount):null,r.a.createElement("div",{className:"sidebar__photo"},this.props.dialog.Photo?r.a.createElement("div",{style:t}):r.a.createElement("div",{className:"sidebar__photo-default"},this.state.defaultAva))),r.a.createElement("div",null,r.a.createElement("div",{className:"sidebar__name"},r.a.createElement("span",null,this.props.dialog.Title||this.props.dialog.NameFirst+this.props.dialog.NameSecond||this.props.dialog.ChannelName)),r.a.createElement("div",{className:"sidebar__message",ref:"messageText"},this.props.dialog.PreviewText?this.props.dialog.PreviewText:2===this.props.dialog.AttachmentType?"\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435":null))))}}]),t}(n.Component);var W=Object(l.b)(function(e){return{}},function(e){return{openDialog:function(t){return e(O(t))}}})(z),K=a(160),Q=a.n(K);var X=function(){return r.a.createElement("div",{className:"head-sidebar"},r.a.createElement("div",{className:"head-sidebar__logo"},r.a.createElement("img",{src:Q.a,alt:"Y Messenger"})))};var Y=L.a.Search;var Z=Object(l.b)(function(e){return{search:e.ui.search}},function(e){return{searchStart:function(t){return e({type:"SEARCH_START",text:t})},searchEnd:function(){return e({type:"SEARCH_END"})}}})(function(e){var t=function(t){var a="";"object"===typeof t?a=t.target.value:"string"===typeof t&&(a=t),a.length?e.searchStart(a.toLowerCase()):a.length||e.searchEnd();var n={RequestType:46,SearchQuery:a,RequestId:G.makeId(),Direction:!0,Type:0};G.send(n)};return r.a.createElement("div",{className:"search"},r.a.createElement(Y,{placeholder:"\u041f\u043e\u0438\u0441\u043a",onSearch:t,onChange:t,enterButton:!0}))});var $=Object(l.b)(function(e){return{dialogs:e.dialogs,search:e.ui.search,searchResult:e.searchResult}},function(e){return{openDialog:function(t){return e(O(t))}}})(function(e){var t=Object(n.useState)([]),a=Object(F.a)(t,2),s=a[0],o=a[1];return Object(n.useEffect)(function(){if(e.search){var t=e.dialogs.filter(function(t){if(!t.fake)return t.Title.toLowerCase().indexOf(e.search)>=0});o(t)}else o(e.dialogs)},[e.search,e.dialogs]),r.a.createElement("div",{className:"sidebar"},r.a.createElement(X,null),r.a.createElement(Z,null),r.a.createElement("div",{className:"sidebar-viewport"},s.map(function(e){if(e&&!e.fake)return r.a.createElement(W,{dialog:e,key:G.makeId(),type:"dialog"})}),e.searchResult?function(){if(e.searchResult.users)return e.searchResult.users.map(function(e,t){if(e)return 0===t?r.a.createElement("div",{key:G.makeId()},r.a.createElement("div",{className:"sidebar__title"},"\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0438:"),r.a.createElement(W,{dialog:e,type:"user"})):r.a.createElement(W,{dialog:e,type:"user",key:G.makeId()})})}():null,e.searchResult?function(){if(e.searchResult.chats)return e.searchResult.chats.map(function(e,t){if(e)return 0===t?r.a.createElement("div",{key:G.makeId()},r.a.createElement("div",{className:"sidebar__title"},"\u0427\u0430\u0442\u044b:"),r.a.createElement(W,{dialog:e,type:"chat"})):r.a.createElement(W,{dialog:e,type:"chat",key:G.makeId()})})}():null,e.searchResult?function(){if(e.searchResult.channels)return e.searchResult.channels.map(function(e,t){if(e)return 0===t?r.a.createElement("div",{key:G.makeId()},r.a.createElement("div",{className:"sidebar__title"},"\u041a\u0430\u043d\u0430\u043b\u044b:"),r.a.createElement(W,{dialog:e,type:"channel"})):r.a.createElement(W,{dialog:e,type:"channel",key:G.makeId()})})}():null))}),ee=a(347),te=a(342),ae=a(162),ne=a.n(ae);function re(e){return{type:"OPEN_PROFILE",dialog:e}}te.a.locale(ne.a);var se=Object(l.b)(function(e){return{dialogs:e.dialogs,users:e.users}},function(e){return{openProfile:function(t){return e(re(t))}}})(function(e){var t=Object(n.useState)(null),a=Object(F.a)(t,2),s=a[0],o=a[1],l=Object(n.useState)(""),i=Object(F.a)(l,2),c=i[0],u=i[1],d=Object(n.useState)(null),m=Object(F.a)(d,2),f=m[0],g=m[1],p=Object(n.useState)(document.body.clientWidth),v=Object(F.a)(p,2),h=v[0],E=v[1];return Object(n.useEffect)(function(){},[h]),window.onresize=function(){E(document.body.clientWidth)},Object(n.useEffect)(function(){if(e.users&&s){var t=e.users.find(function(e){return e.Id===s.SecondUid});g(t)}},[e.users,s]),Object(n.useEffect)(function(){e.dialogs.forEach(function(e){e.active&&o(e)})},[e.dialogs]),Object(n.useEffect)(function(){s&&(s.Photo||u(J.getUserInitials(s)))},[s]),r.a.createElement("div",{className:"head-dialog"},h<=675&&e.location.pathname.indexOf("dialog")>0?r.a.createElement("div",{className:"head-dialog__back"},r.a.createElement(y.b,{to:"/"},r.a.createElement(M.a,{type:"left"})),r.a.createElement("br",null)):null,r.a.createElement("div",{className:"head-dialog__user",onClick:function(){e.openProfile(s)}},r.a.createElement("div",{className:"head-dialog__ava"},s?s.Photo?r.a.createElement("div",{style:{width:"100%",height:"100%",backgroundSize:"cover",backgroundPosition:"center center",backgroundImage:"url(https://testnode1-1.ymess.org:5000/api/Files/".concat(s.Photo,")"),backgroundRepeat:"no-repeat"}}):r.a.createElement("div",{className:"head-dialog__photo-default"},c):null),r.a.createElement("div",null,r.a.createElement("div",{className:"head-dialog__name"},s?s.Title||s.ChannelName:null),r.a.createElement("div",{className:"head-dialog__status"},f?r.a.createElement(ee.a,{date:1e3*f.Online,locale:"ru"}):null))),r.a.createElement("div",{onClick:function(){var e={Full:!1,AccessToken:localStorage.getItem("AccessToken"),RequestType:34,RequestId:G.makeId(),Type:0};G.send(e),localStorage.remove("AccessToken"),localStorage.remove("FileAccessToken"),localStorage.remove("RefreshToken"),localStorage.remove("User"),window.location.replace("/")},className:"head-dialog__logout"},"\u0412\u044b\u0445\u043e\u0434"))}),oe=a(345);function le(){return(le=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function ie(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},s=Object.keys(e);for(n=0;n<s.length;n++)a=s[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)a=s[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var ce=r.a.createElement("g",null,r.a.createElement("g",{id:"check"},r.a.createElement("polygon",{points:"142.8,323.85 35.7,216.75 0,252.45 142.8,395.25 448.8,89.25 413.1,53.55  "}))),ue=r.a.createElement("g",null),de=r.a.createElement("g",null),me=r.a.createElement("g",null),fe=r.a.createElement("g",null),ge=r.a.createElement("g",null),pe=r.a.createElement("g",null),ve=r.a.createElement("g",null),he=r.a.createElement("g",null),ye=r.a.createElement("g",null),Ee=r.a.createElement("g",null),be=r.a.createElement("g",null),Ie=r.a.createElement("g",null),Te=r.a.createElement("g",null),Se=r.a.createElement("g",null),Oe=r.a.createElement("g",null),Ce=function(e){var t=e.svgRef,a=ie(e,["svgRef"]);return r.a.createElement("svg",le({id:"Capa_1",x:"0px",y:"0px",width:"448.8px",height:"448.8px",viewBox:"0 0 448.8 448.8",style:{enableBackground:"new 0 0 448.8 448.8"},xmlSpace:"preserve",ref:t},a),ce,ue,de,me,fe,ge,pe,ve,he,ye,Ee,be,Ie,Te,Se,Oe)},Re=r.a.forwardRef(function(e,t){return r.a.createElement(Ce,le({svgRef:t},e))});a.p;function je(){return(je=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function _e(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},s=Object.keys(e);for(n=0;n<s.length;n++)a=s[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)a=s[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var ke=r.a.createElement("g",null,r.a.createElement("g",{id:"done-all"},r.a.createElement("path",{d:"M448.8,161.925l-35.7-35.7l-160.65,160.65l35.7,35.7L448.8,161.925z M555.899,126.225l-267.75,270.3l-107.1-107.1 l-35.7,35.7l142.8,142.8l306-306L555.899,126.225z M0,325.125l142.8,142.8l35.7-35.7l-142.8-142.8L0,325.125z"}))),Ne=r.a.createElement("g",null),we=r.a.createElement("g",null),Ue=r.a.createElement("g",null),Ae=r.a.createElement("g",null),Pe=r.a.createElement("g",null),xe=r.a.createElement("g",null),Me=r.a.createElement("g",null),De=r.a.createElement("g",null),Fe=r.a.createElement("g",null),qe=r.a.createElement("g",null),Le=r.a.createElement("g",null),Ve=r.a.createElement("g",null),Ge=r.a.createElement("g",null),He=r.a.createElement("g",null),Be=r.a.createElement("g",null),Je=function(e){var t=e.svgRef,a=_e(e,["svgRef"]);return r.a.createElement("svg",je({id:"Capa_1",x:"0px",y:"0px",width:"594.149px",height:"594.149px",viewBox:"0 0 594.149 594.149",style:{enableBackground:"new 0 0 594.149 594.149"},xmlSpace:"preserve",ref:t},a),ke,Ne,we,Ue,Ae,Pe,xe,Me,De,Fe,qe,Le,Ve,Ge,He,Be)},ze=r.a.forwardRef(function(e,t){return r.a.createElement(Je,je({svgRef:t},e))});a.p;var We=Object(l.b)(function(e){return{users:e.users,forwardMessage:e.forwardMessage}},function(e){return{forwardingMessage:function(t){return e(S(t))}}})(function(e){var t=Object(n.useState)(!1),a=Object(F.a)(t,2),s=a[0],o=a[1],l=Object(n.useState)(""),i=Object(F.a)(l,2),c=i[0],u=i[1],d=Object(n.useState)(!1),m=Object(F.a)(d,2),f=m[0],g=m[1],p=Object(n.useState)(!1),v=Object(F.a)(p,2),h=v[0],b=v[1],I=J.getUserById(e.message.SenderId,e.users)||{};Object(n.useEffect)(function(){if(e.message){var t=new Date(1e3*e.message.SendingTime),a=new Date;a.setTime(t);var n="".concat(a.getHours()),r="".concat(a.getMinutes());1===n.length&&(n="0".concat(n)),1===r.length&&(r="0".concat(r)),u("".concat(n,":").concat(r))}},[e.message]);var T={};return I&&(T={alignSelf:"flex-end",flexShrink:0,width:"44px",height:"44px",backgroundSize:"cover",backgroundPosition:"center center",backgroundImage:"url(https://testnode1-1.ymess.org:5000/api/Files/".concat(I.Photo,")"),backgroundRepeat:"no-repeat",borderRadius:"100%"}),h?r.a.createElement(E.a,{to:"/"}):I&&e.message?r.a.createElement("div",{className:I.currentUser?"message message-out":"message message-in",onClick:function(){g(!f)},style:e.message&&f?{background:"#ebf5ff"}:null},I.currentUser?null:r.a.createElement("div",{className:"message__ava",style:T}),I.currentUser&&e.message.Read?r.a.createElement(ze,{className:"message__read"}):I.currentUser&&!e.message.Read?r.a.createElement(Re,{className:"message__read"}):null,r.a.createElement("div",{className:"message__content"},I.currentUser?null:r.a.createElement("div",{className:"message__name"},I.NameFirst?I.NameFirst+" ":null,I.NameSecond?I.NameSecond:null),function(t){if(!t.Attachments)return t.Text?r.a.createElement("div",null,t.Text):null;if(!t.Attachments.length)return t.Text?r.a.createElement("div",null,t.Text):null;if(2===t.Attachments[0].Type)return r.a.createElement("div",{className:"message__img",onClick:function(){return o(!0)}},r.a.createElement("img",{src:"https://testnode1-1.ymess.org:5000/api/Files/"+t.Attachments[0].Payload.FileId,alt:""}));if(1===t.Attachments[0].Type){if(t.Attachments[0].Payload)return r.a.createElement("div",null,r.a.createElement(y.c,{to:"/dialog/".concat(t.ConversationId)},t.Attachments[0].Payload.Filename),t.Text)}else if(5===t.Attachments[0].Type)return t.Attachments[0].Payload.length>0?r.a.createElement("div",{className:"forwarding_message"},"\u041f\u0435\u0440\u0435\u0441\u043b\u0430\u043d\u043d\u043e\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u043e\u0442",r.a.createElement(y.c,{to:"/dialog/".concat(t.ConversationId)},function(t){var a=e.users.find(function(e){return e.Id===t});if(a)return" ".concat(a.NameFirst," ").concat(a.NameSecond)}(t.Attachments[0].Payload[0].SenderId)),r.a.createElement("div",null,t.Attachments[0].Payload[0].Text),t.Text?r.a.createElement("div",null,t.Text):null):r.a.createElement("div",{className:"forwarding_message"},"\u041f\u0435\u0440\u0435\u0441\u043b\u0430\u043d\u043d\u043e\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u043e\u0442:",r.a.createElement("div",null,"\u041f\u0435\u0440\u0435\u0441\u043b\u0430\u043d\u043d\u043e\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u0443\u0434\u0430\u043b\u0435\u043d\u043e"))}(e.message)),r.a.createElement("div",{className:"message__time"},c),e.message.Attachments&&e.message.Attachments[0]?r.a.createElement(oe.a,{visible:s,onCancel:function(){return o(!1)},footer:null,maskClosable:!0},r.a.createElement("img",{className:"popup__img",src:"https://testnode1-1.ymess.org:5000/api/Files/".concat(e.message.Attachments[0].Payload.FileId),alt:""})):null,e.message&&f?r.a.createElement("div",{className:"message-menu"},r.a.createElement("ul",null,r.a.createElement("li",{onClick:function(){e.forwardingMessage(e.message)}},"\u041e\u0442\u0432\u0435\u0442\u0438\u0442\u044c"),r.a.createElement("li",{onClick:function(){e.forwardingMessage(e.message),b(!0)}},"\u041f\u0435\u0440\u0435\u0441\u043b\u0430\u0442\u044c"))):null):null});function Ke(){return(Ke=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function Qe(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},s=Object.keys(e);for(n=0;n<s.length;n++)a=s[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)a=s[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var Xe=r.a.createElement("g",{transform:"translate(-198)",id:"g69"},r.a.createElement("g",{id:"_x33__22_"},r.a.createElement("g",{id:"g66"},r.a.createElement("path",{id:"path64",d:"m 544.5,99 v 495 c 0,82.021 -66.479,148.5 -148.5,148.5 -82.021,0 -148.5,-66.479 -148.5,-148.5 V 148.5 c 0,-54.673 44.327,-99 99,-99 54.673,0 99,44.327 99,99 V 594 c 0,27.349 -22.176,49.5 -49.5,49.5 -27.349,0 -49.5,-22.151 -49.5,-49.5 V 198 H 297 v 396 c 0,54.673 44.327,99 99,99 54.673,0 99,-44.327 99,-99 V 148.5 C 495,66.479 428.521,0 346.5,0 264.479,0 198,66.479 198,148.5 V 618.75 C 210.202,716.389 295.045,792 396,792 496.955,792 581.798,716.389 594,618.75 V 99 Z"})))),Ye=function(e){var t=e.svgRef,a=Qe(e,["svgRef"]);return r.a.createElement("svg",Ke({xmlSpace:"preserve",viewBox:"0 0 396 792",height:0,width:0,y:"0px",x:"0px",id:"Capa_1",ref:t},a),Xe)};r.a.forwardRef(function(e,t){return r.a.createElement(Ye,Ke({svgRef:t},e))}),a.p;function Ze(){return(Ze=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function $e(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},s=Object.keys(e);for(n=0;n<s.length;n++)a=s[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)a=s[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var et=r.a.createElement("g",{transform:"translate(0,-38.25)",id:"g95"},r.a.createElement("g",{id:"send"},r.a.createElement("polygon",{id:"polygon92",points:"0,38.25 0,216.75 382.5,267.75 0,318.75 0,497.25 535.5,267.75 "}))),tt=r.a.createElement("g",{transform:"translate(0,-38.25)",id:"g97"}),at=r.a.createElement("g",{transform:"translate(0,-38.25)",id:"g99"}),nt=r.a.createElement("g",{transform:"translate(0,-38.25)",id:"g101"}),rt=r.a.createElement("g",{transform:"translate(0,-38.25)",id:"g103"}),st=r.a.createElement("g",{transform:"translate(0,-38.25)",id:"g105"}),ot=r.a.createElement("g",{transform:"translate(0,-38.25)",id:"g107"}),lt=r.a.createElement("g",{transform:"translate(0,-38.25)",id:"g109"}),it=r.a.createElement("g",{transform:"translate(0,-38.25)",id:"g111"}),ct=r.a.createElement("g",{transform:"translate(0,-38.25)",id:"g113"}),ut=r.a.createElement("g",{transform:"translate(0,-38.25)",id:"g115"}),dt=r.a.createElement("g",{transform:"translate(0,-38.25)",id:"g117"}),mt=r.a.createElement("g",{transform:"translate(0,-38.25)",id:"g119"}),ft=r.a.createElement("g",{transform:"translate(0,-38.25)",id:"g121"}),gt=r.a.createElement("g",{transform:"translate(0,-38.25)",id:"g123"}),pt=r.a.createElement("g",{transform:"translate(0,-38.25)",id:"g125"}),vt=function(e){var t=e.svgRef,a=$e(e,["svgRef"]);return r.a.createElement("svg",Ze({xmlSpace:"preserve",viewBox:"0 0 535.5 459",height:0,width:0,y:"0px",x:"0px",id:"Capa_1",ref:t},a),et,tt,at,nt,rt,st,ot,lt,it,ct,ut,dt,mt,ft,gt,pt)},ht=r.a.forwardRef(function(e,t){return r.a.createElement(vt,Ze({svgRef:t},e))});a.p;var yt=Object(l.b)(function(e){return{user:e.users.find(function(e){return!0===e.currentUser}),dialogs:e.dialog,forwardMessage:e.forwardMessage}},function(e){return{forwardingMessage:function(t){return e(S(t))}}})(function(e){var t=Object(n.useState)(""),a=Object(F.a)(t,2),s=a[0],o=a[1];function l(){if(e.forwardMessage){var t={Messages:[{Id:0,SendingTime:"",SenderId:e.user.Id,ReceiverId:15,ConversationId:e.dialog.ConversationId,ConversationType:e.dialog.ConversationType,Read:!1,NodesId:null,ReplyTo:null,Text:s,Attachments:[{Type:5,Payload:{MessagesGlobalId:[e.forwardMessage.GlobalId],ConversationId:e.forwardMessage.ConversationId,ConversationType:e.forwardMessage.ConversationType}}]}],RequestType:39,RequestId:G.makeId(),Type:0};G.send(t)}else{var a={Messages:[{Id:0,SendingTime:"",SenderId:e.user.Id,ReceiverId:e.dialog.SecondUid,ConversationId:e.dialog.ConversationId,ConversationType:e.dialog.ConversationType,Read:!1,NodesId:null,ReplyTo:null,Text:s,Attachments:null,GlobalId:null}],RequestType:39,RequestId:G.makeId(),Type:0};G.send(a)}o(""),e.forwardMessage&&e.forwardingMessage(!1)}return r.a.createElement("div",{className:"new-message"},r.a.createElement("input",{type:"text",className:"new-message__inp",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435",value:s,onChange:function(e){o(e.target.value)},onKeyDown:function(e){13===e.keyCode&&l()}}),r.a.createElement(ht,{onClick:function(){l()},className:"new-message__send"}))});var Et=Object(l.b)(function(e){return{messages:e.messages,forwardMessage:e.forwardMessage,users:e.users,user:e.users.find(function(e){return!0===e.currentUser})}},function(e){return{openDialog:function(t){return e(O(t))}}})(function(e){var t=Object(n.useState)([]),a=Object(F.a)(t,2),s=a[0],o=a[1],l=Object(n.useState)(null),i=Object(F.a)(l,2),c=i[0],d=i[1],m=Object(n.useRef)(null);return Object(n.useEffect)(function(){if(e.dialog&&(d(e.dialog),e.dialog.LastMessageId)){var t={MessagesId:[e.dialog.LastMessageId],ConversationType:e.dialog.ConversationType,ConversationId:e.dialog.ConversationId,RequestId:G.makeId(),RequestType:35,Type:0};G.send(t)}},[e.dialog]),Object(n.useEffect)(function(){if(c){var t=e.messages.filter(function(e){return e.ConversationId===parseInt(c.ConversationId||c.ChannelId)});o(t),setTimeout(function(){m.current&&(m.current.scrollTop=45e4)},10),function(t){var a=[];t.forEach(function(t){t.Attachments&&t.Attachments.length&&5===t.Attachments[0].Type&&t.Attachments[0].Payload.length>0&&(e.users.find(function(e){return e.Id===t.Attachments[0].Payload[0].SenderId})||t.Attachments[0].Payload[0].SenderId&&a.push(t.Attachments[0].Payload[0].SenderId)),e.users.find(function(e){return e.Id===t.SenderId})||t.SenderId&&a.push(t.SenderId)});var n=Object(u.a)(new Set(a.map(function(e){return e})));if(n.length){var r={UsersId:Object(u.a)(n),RequestType:28,RequestId:G.makeId(),Type:0};G.send(r)}}(t)}},[c,e.messages]),r.a.createElement("div",{className:"dialog"},r.a.createElement("div",{className:"dialog__messages-viewport",ref:m},r.a.createElement("div",{className:"dialog__messages"},c?s.map(function(e){return r.a.createElement(We,{key:e.GlobalId,message:e})}):null)),e.forwardMessage?r.a.createElement("div",{className:"reply-message"},"\u041e\u0442\u0432\u0435\u0442 \u043d\u0430:"," ".concat(e.forwardMessage.Text)):null,e.dialog?"channel"===e.dialog.type&&e.dialog.fake?r.a.createElement(P.a,{type:"primary",size:"large",onClick:function(){var t={ChannelsId:[c.ChannelId],UsersId:[e.user.Id],RequestType:48,RequestId:G.makeId(),Type:0};G.send(t)}},"\u0412\u0441\u0442\u0443\u043f\u0438\u0442\u044c"):3!==e.dialog.ConversationType?r.a.createElement(yt,Object.assign({},e,{dialog:c})):null:null)});var bt=Object(l.b)(function(e){return{dialogs:e.dialogs,messages:e.messages}},function(e){return{openDialog:function(t){return e(O(t))}}})(function(e){var t=Object(n.useState)(null),a=Object(F.a)(t,2),s=a[0],o=a[1];return Object(n.useEffect)(function(){e.dialogs.forEach(function(e){e.active&&o(e)})},[e.dialogs]),Object(n.useEffect)(function(){},[e.messages]),Object(n.useEffect)(function(){if(s&&!s.messagesRecieved){var e={ConversationType:"channel"===s.type?3:s.ConversationType,ConversationId:s.ConversationId?s.ConversationId:s.ChannelId,NavigationMessageTime:null,MessageId:null,RequestType:25,RequestId:G.makeId(),Type:0};G.send(e)}},[s]),r.a.createElement("div",{className:"dialog-container"},r.a.createElement(se,e),r.a.createElement(Et,Object.assign({dialog:s},e)))});var It=Object(l.b)(function(e){return{profile:e.ui.profile,users:e.users,chats:e.chats}},function(e){return{openProfile:function(t){return e(re(t))},openDialog:function(t){return e(O(t))}}})(function(e){var t=Object(n.useState)(!1),a=Object(F.a)(t,2),s=a[0],o=a[1],l=Object(n.useState)(null),i=Object(F.a)(l,2),c=i[0],u=i[1],d=Object(n.useState)(null),m=Object(F.a)(d,2),f=m[0],g=m[1];Object(n.useEffect)(function(){if(e.profile)if(1===e.profile.ConversationType){var t=J.getUserById(e.profile.SecondUid,e.users);t&&(u(t),o(!0))}else if(e.profile.NameFirst)u(e.profile),o(!0);else if(e.profile.Users)u(e.profile),o(!0);else if(2===e.profile.ConversationType){var a={RequestType:45,ChatsId:[e.profile.ConversationId],RequestId:G.makeId(),Type:0};G.send(a)}},[e.profile]),Object(n.useEffect)(function(){if(e.chats.length){u(e.chats[0]),o(!0);var t=[];if(e.chats[0].Users.map(function(a){J.getUserById(a.UserId,e.users)||t.push(a.UserId)}),t.length){var a={UsersId:[].concat(t),RequestType:28,RequestId:G.makeId(),Type:0};G.send(a)}}},[e.chats]);var p=function(){o(!1),e.openProfile(null)};return r.a.createElement(oe.a,{visible:s,onCancel:p,footer:null,maskClosable:!0},c?r.a.createElement("div",{className:"profile"},f?r.a.createElement("div",{onClick:function(){e.openProfile(f),g(null)}},"\u041d\u0430\u0437\u0430\u0434"):null,c.Photo?r.a.createElement("div",{className:"profile__ava",style:{width:"100px",height:"100px",backgroundSize:"cover",backgroundPosition:"center center",backgroundImage:"url(https://testnode1-1.ymess.org:5000/api/Files/".concat(c.Photo,")"),backgroundRepeat:"no-repeat",borderRadius:100,margin:"0 auto"}}):null,c.Name?r.a.createElement("div",{className:"profile__name"},c.Name):r.a.createElement("div",{className:"profile__name"},c.NameFirst?c.NameFirst:null," ",c.NameSecond?c.NameSecond:null),c.Phones&&c.Phones.length>0?r.a.createElement("div",{className:"profile__info"},r.a.createElement("div",{className:"profile__info_name"},"\u0422\u0435\u043b\u0435\u0444\u043e\u043d"),r.a.createElement("div",{className:"profile__info_value"},c.Phones[0].FullNumber)):null,c.Emails?r.a.createElement("div",{className:"profile__info"},r.a.createElement("div",{className:"profile__info_name"},"Email"),r.a.createElement("div",{className:"profile__info_value"},r.a.createElement("a",{href:"mailto:".concat(c.Emails[0])},c.Emails[0]))):null,c.About?r.a.createElement("div",{className:"profile__info"},r.a.createElement("div",{className:"profile__info_name"},"\u041e \u0441\u0435\u0431\u0435"),r.a.createElement("div",{className:"profile__info_value"},c.About)):null,c.Users?r.a.createElement("div",{className:"profile__info"},r.a.createElement("div",{className:"profile__info_name"},"\u0423\u0447\u0430\u0441\u0442\u043d\u0438\u043a\u0438"),r.a.createElement("div",{className:"profile__info_users"},e.chats[0].Users.map(function(t){var a=J.getUserById(t.UserId,e.users);if(a)return r.a.createElement("div",{key:a.Tag,className:"profile__info_user",onClick:function(){var t;t=a,g(c),e.openProfile(t)}},a.NameFirst+" "+a.NameSecond,a.Photo?r.a.createElement("div",{style:{width:"50px",height:"50px",backgroundSize:"cover",backgroundPosition:"center center",backgroundImage:"url(https://testnode1-1.ymess.org:5000/api/Files/".concat(a.Photo,")"),backgroundRepeat:"no-repeat",borderRadius:100,margin:"0 auto",marginTop:"10px"}}):r.a.createElement("div",{className:"profile__info_ava"},J.getUserInitials(a)))}))):null,e.profile?r.a.createElement(y.c,{to:"/",onClick:function(){var t={};t.data=e.profile,t.type="user",e.openDialog(t),p()}},r.a.createElement("div",{className:"profile__open_chat"},"\u041e\u0442\u043a\u0440\u044b\u0442\u044c \u0447\u0430\u0442")):null):null)});var Tt=Object(l.b)(function(e){return{dialogs:e.dialogs,ui:e.ui}},function(e){return{}})(function(e){var t=Object(n.useState)(document.body.clientWidth),a=Object(F.a)(t,2),s=a[0],o=a[1];return window.addEventListener("resize",function(){o(document.body.clientWidth)},!1),r.a.createElement(y.a,null,r.a.createElement("div",{className:"page"},r.a.createElement("div",{className:"page__content"},s>675?r.a.createElement(r.a.Fragment,null,r.a.createElement($,e),J.getActiveDialog(e.dialogs)?r.a.createElement(bt,null):null):r.a.createElement(r.a.Fragment,null,r.a.createElement(E.b,{exact:!0,path:"/",render:function(e){return r.a.createElement($,e)}}),J.getActiveDialog(e.dialogs)?r.a.createElement(bt,null):null))),r.a.createElement(It,null))});function St(e){return{type:"SET_AUTH",auth:e}}var Ot=Object(l.b)(function(e){return{users:e.users}},function(e){return{dialogsReceived:function(t){return e(I(t))},chatsReceived:function(t){return e(function(e){return{type:"CHATS_RECEIVED",chats:e}}(t))},chatsUsersReceived:function(t){return e(function(e){return{type:"CHATS_USERS_RECEIVED",chatsUsers:e}}(t))},openDialog:function(t){return e(O(t))},userReceived:function(t){return e(C(t))},messagesReceived:function(t){return e(T(t))},readMessages:function(t){return e({type:"READ_MESSAGES",messageIDs:t})},setAuth:function(t){return e(St(t))},searchResultReceived:function(t){return e({type:"SEARCH_RESULT_RECEIVED",searchResult:t})}}})(function(e){return Object(n.useEffect)(function(){G.onMessage=function(t){if(6===t.ResponseType){var a={RequestId:G.makeId(),RequestType:27,Type:0};G.send(a),localStorage.setItem("FileAccessToken",t.FileAccessToken),localStorage.setItem("AccessToken",t.Token.AccessToken),localStorage.setItem("RefreshToken",t.Token.RefreshToken),e.setAuth("AUTH_SUCCESS")}else if(12===t.ResponseType){var n=J.getFormatedUser([t.User]);n[0].currentUser=!0,e.userReceived(n)}else if(15===t.ResponseType)e.dialogsReceived(J.getFormatedDialogs(t.Conversations));else if(9===t.ResponseType)e.messagesReceived(J.getFormatedMessages(t.Messages));else if(t.Message){e.messagesReceived(J.getFormatedMessages([t.Message]));var r={NavigationMessageTime:null,RequestId:G.makeId(),RequestType:12,Type:0};G.send(r)}else if(2===t.Type&&5===t.Code)e.readMessages(t.MessagesId);else if(0===t.ResponseType)e.userReceived(J.getFormatedUser(t.Users));else if(2===t.ResponseType)J.getFormatedChats(t.Chats).forEach(function(e){var t={ChatId:e.Id,NavigationUserId:null,RequestId:G.makeId(),RequestType:17,Type:0};G.send(t)}),e.chatsReceived(J.getFormatedChats(t.Chats));else if(16===t.ResponseType)e.chatsUsersReceived(J.getFormatedChatsUsers(t.ChatUsers));else if(21===t.ResponseType){var s={NavigationMessageTime:null,RequestId:G.makeId(),RequestType:12,Type:0};G.send(s)}else if(23===t.ResponseType){var o={};t.Users.length>0&&(o.users=t.Users),t.Chats.length>0&&(o.chats=t.Chats),t.Channels.length>0&&(o.channels=t.Channels),e.searchResultReceived(o)}}},[]),null});var Ct=Object(l.b)(function(e){return{dialogs:e.dialogs,users:e.users,auth:e.auth}},function(e){return{dialogsReceived:function(t){return e(I(t))},openDialog:function(t){return e(O(t))},userReceived:function(t){return e(C(t))},messagesReceived:function(t){return e(T(t))},setAuth:function(t){return e(St(t))}}})(function(e){return Object(n.useEffect)(function(){if("AUTH_SUCCESS"===e.auth){var t={NavigationMessageTime:null,RequestId:G.makeId(),RequestType:12,Type:0};G.send(t)}},[e.auth]),Object(n.useEffect)(function(){G.wsOnConnect=function(){var t;localStorage.getItem("AccessToken")?(localStorage.getItem("User")?t={Token:{UserId:JSON.parse(localStorage.getItem("User")).Id,AccessToken:localStorage.getItem("AccessToken"),RefreshToken:localStorage.getItem("RefreshToken")},LoginType:0,UidType:1,RequestId:G.makeId(),RequestType:33,Type:0}:localStorage.getItem("Phone")?t={Uid:localStorage.getItem("Phone"),Token:{AccessToken:localStorage.getItem("AccessToken"),RefreshToken:localStorage.getItem("RefreshToken")},LoginType:0,UidType:0,RequestId:G.makeId(),RequestType:33,Type:0}:localStorage.getItem("Email")&&console.log("\u041f\u043e \u043f\u043e\u0447\u0442\u0435"),G.send(t)):e.setAuth("NO_AUTH")}}),r.a.createElement(r.a.Fragment,null,r.a.createElement(Ot,null),r.a.createElement(y.a,null,r.a.createElement(E.b,{path:"/",render:"CHECK_AUTH"===e.auth?function(){return r.a.createElement("div",{className:"preloader"},r.a.createElement(b.a,{size:"large"}))}:"AUTH_SUCCESS"===e.auth?function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(E.b,{path:"/",component:Tt}))}:function(){return r.a.createElement(E.a,{to:"/auth"})}}),r.a.createElement(E.b,{path:"/auth/by-phone",component:B}),r.a.createElement(E.b,{path:"/auth/by-email",component:B}),r.a.createElement(E.b,{exact:!0,path:"/auth",component:D}),r.a.createElement(E.b,{exact:!0,path:"/registration",component:H})))});Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var Rt,jt=Object(i.d)(h,Rt,Object(i.a)(c.a));o.a.render(r.a.createElement(l.a,{store:jt},r.a.createElement(y.a,null,r.a.createElement(Ct,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[170,1,2]]]);
//# sourceMappingURL=main.c3eaa63b.chunk.js.map