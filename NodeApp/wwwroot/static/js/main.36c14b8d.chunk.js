(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{224:function(e,t,a){e.exports=a.p+"static/media/logo.024bbe57.PNG"},234:function(e,t,a){e.exports=a(464)},239:function(e,t,a){},241:function(e,t,a){},464:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(8),s=a.n(o),l=(a(239),a(240),a(241),a(13)),c=a(70),i=a(215),u=a(20);var d=a(24),m={activeNode:null,allNodes:null};var p={prevPath:"",currentPath:""};var f={profile:null,search:!1,showDrawer:!1,appFocus:!0,modals:{createChatModal:!1,contactsModal:!1,contactsGroupsModal:!1,settingsModal:!1},callbacks:[],socketReconnect:!1};var g={users:[],usersIDs:[],groups:[]};var y=a(30),v=a.n(y);var h=Object(c.c)({dialogs:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;if("DIALOGS_RECEIVED"===t.type){var a=Object(u.a)(e),n=a.find(function(e){return e.active});return a=t.dialogs,n&&a.forEach(function(e){e.ConversationId===n.ConversationId&&e.ConversationType===n.ConversationType&&(e.active=!0,e.messagesRecieved=n.messagesRecieved||!1)}),a}if("OPEN_DIALOG"===t.type){var r=Object(u.a)(e);if("dialog"===t.payload.type)r.forEach(function(e){e.active=!1,e.isCrypto=!1,e.ConversationId===t.payload.data.ConversationId&&e.ConversationType===t.payload.data.ConversationType&&(e.active=!0,e.UnreadedCount=0,e.type=t.payload.type)});else if("user"===t.payload.type)if(r.find(function(e){return e.SecondUid===t.payload.data.Id}))r.forEach(function(e){e.active=!1,e.SecondUid===t.payload.data.Id&&(e.active=!0,e.UnreadedCount=0,e.type="dialog")});else{var o={};o.ConversationId=t.payload.data.Id,o.Title=t.payload.data.NameFirst+" "+t.payload.data.NameSecond,o.Photo=t.payload.data.Photo,o.ConversationType=1,o.SecondUid=t.payload.data.Id,o.fake=!0,r.push(o),r.forEach(function(e){e.active=!1,e.ConversationId===t.payload.data.Id&&(e.active=!0,e.UnreadedCount=0,e.type=t.payload.type)})}else if("channel"===t.payload.type)r.push(t.payload.data),r.forEach(function(e){e.active=!1,e.ConversationId===t.payload.data.Id&&(e.active=!0,e.UnreadedCount=0,e.type=t.payload.type,e.fake=!0)});else if("chat"===t.payload.type)if(r.find(function(e){return e.ConversationId===t.payload.data.Id}))r.forEach(function(e){e.active=!1,e.ConversationId===t.payload.data.Id&&(e.active=!0,e.UnreadedCount=0,e.type="chat")});else{var s={};s.ConversationId=t.payload.data.Id,s.Title=t.payload.data.NameFirst+" "+t.payload.data.NameSecond,s.Photo=t.payload.data.Photo,s.ConversationType=1,s.SecondUid=t.payload.data.Id,s.fake=!0,r.push(s),r.forEach(function(e){e.active=!1,e.ConversationId===t.payload.data.Id&&(e.active=!0,e.UnreadedCount=0,e.type=t.payload.type)})}return r}if("CLOSE_DIALOG"===t.type){var l=Object(u.a)(e);return l.forEach(function(e){e.active&&(e.active=!1)}),l}if("MESSAGES_RECEIVED"===t.type){var c=Object(u.a)(e);if(t.payload.messages.length){var i=t.payload.messages[0].ConversationId,d=t.payload.messages[0].ConversationType;c.forEach(function(e){if(e.ConversationId===i&&e.ConversationType===d&&(t.payload.isResponse&&(e.messagesRecieved=!0),e.PreviewText=t.payload.messages[0].Text,e.active||(e.UnreadedCount+=1),!t.payload.isResponse)){var a=c.indexOf(e);c.splice(a,1),c.unshift(e)}})}return c}if("UP_DIALOG"===t.type){var m=Object(u.a)(e);if(t.dialog){var p=t.dialog.ConversationId,f=t.dialog.ConversationType;m.forEach(function(e){if(e.ConversationId===p&&e.ConversationType===f){var t=m.indexOf(e);m.splice(t,1),m.unshift(e)}})}return m}if("TOGGLE_CRYPTO_MODE"===t.type){var g=Object(u.a)(e);return t.payload.isCrypto?g.forEach(function(e){e.ConversationId===t.payload.dialog.ConversationId&&e.ConversationType===t.payload.dialog.ConversationType&&(e.isCrypto=t.payload.isCrypto)}):g.forEach(function(e){e.isCrypto=!1}),g}return e},chats:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;if("CHATS_RECEIVED"===t.type)return Object(u.a)(e),t.chats;if("CHATS_USERS_RECEIVED"===t.type){var a=Object(u.a)(e);return a[0].Id===t.chatsUsers[0].ChatId&&(a[0].Users=t.chatsUsers),a}return e},messages:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;if("MESSAGES_RECEIVED"===t.type){var a=Object(u.a)(e);return t.payload.messages.forEach(function(e){a.find(function(t){return t.GlobalId===e.GlobalId})||a.push(e)}),a.sort(function(e,t){var a=new Date(e.SendingTime),n=new Date(t.SendingTime);return a<n?-1:a>n?1:0})}if("READ_MESSAGES"===t.type){var n=Object(u.a)(e);return n.forEach(function(e){e.ConversationId===t.data.ConversationId&&e.ConversationType===t.data.ConversationType&&(e.Read=!0)}),n}return e},users:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;if("USER_RECEIVED"===t.type){var a=e;return t.users.length>0&&(a.find(function(e){return e.Id===t.users[0].Id})||(a=[].concat(Object(u.a)(a),Object(u.a)(t.users)))),a}return e},contacts:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g,t=arguments.length>1?arguments[1]:void 0;if("SET_CONTACT_USERS_IDS"===t.type){var a=Object(d.a)({},e);return a.usersIDs=t.usersIDs,a}if("SET_CONTACTS"===t.type){var n=Object(d.a)({},e);return n.users=t.contacts,n}if("USER_GROUPS_RECEIVED"===t.type){var r=Object(d.a)({},e);return r.groups=t.groups,r}if("REMOVE_CONTACT_FROM_GROUP"===t.type){var o=Object(d.a)({},e);return o.users.forEach(function(e){if(e.ContactUserId===t.payload.userId){var a=e.GroupsId.indexOf(t.payload.groupId);e.GroupsId.splice(a,1)}}),o}if("REMOVE_GROUP"===t.type){var s=Object(d.a)({},e);return s.groups.forEach(function(e){if(e.GroupId===t.groupId){var a=s.groups.indexOf(e);s.groups.splice(a,1)}}),s}return e},forwardMessage:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;if("FORWARD_MESSAGE"===t.type)return t.message;return e},auth:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"CHECK_AUTH",t=arguments.length>1?arguments[1]:void 0;if("SET_AUTH"===t.type)return t.auth;return e},node:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:m,t=arguments.length>1?arguments[1]:void 0;if("SET_NODE"===t.type){var a=Object(d.a)({},e);return a.activeNode=t.node,a}if("SET_NODES"===t.type){var n=Object(d.a)({},e);return n.allNodes=t.nodes,n}return e},path:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:p,t=arguments.length>1?arguments[1]:void 0;if("SET_PATH"===t.type){var a=Object(d.a)({},e);return a.prevPath=a.path,a.currentPath=t.path,a}if("PREV_PATH"===t.type){var n=Object(d.a)({},e);return n.currentPath=n.prevPath,n}return e},ui:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f,t=arguments.length>1?arguments[1]:void 0;if("OPEN_PROFILE"===t.type){var a=Object(d.a)({},e);return a.profile=t.dialog,a}if("SEARCH_START"===t.type){var n=Object(d.a)({},e);return n.search=t.text,n}if("SEARCH_END"===t.type){var r=Object(d.a)({},e);return r.search=!1,r}if("TOGGLE_DRAWER"===t.type){var o=Object(d.a)({},e);return"close"===t.name?o.showDrawer=!1:o.showDrawer=!o.showDrawer,o}if("TOGGLE_MODAL"===t.type){var s=Object(d.a)({},e);if("close"===t.name)for(var l in s.modals)s.modals[l]=!1;else s.modals[t.name]=!s.modals[t.name];return s}if("SET_APP_FOCUS"===t.type){var c=Object(d.a)({},e);return c.appFocus=t.data,c}if("SOCKET_RECONNECT"===t.type){var i=Object(d.a)({},e);return t.data?i.socketReconnect="\u0421\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435 \u0440\u0430\u0437\u043e\u0440\u0432\u0430\u043d\u043e. \u041f\u0435\u0440\u0435\u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435...":i.socketReconnect=!1,i}return e},callbacks:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;if("SET_CALLBACK_ID"===t.type){var a=Object(u.a)(e),n={id:t.id,data:null};return a.push(n),a}if("SET_CALLBACK_DATA"===t.type){var r=Object(u.a)(e);return r.forEach(function(e){e.id===t.response.RequestId&&(e.data=t.response)}),r}return e},publicKeys:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;if("SET_PUBLIC_KEYS"===t.type){var a=Object(u.a)(e);return t.publicKeys.forEach(function(e){a.find(function(t){return v.a.stringify(t.KeyId)===v.a.stringify(e.KeyId)})||a.push(e)}),a}return e},searchResult:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;if("SEARCH_RESULT_RECEIVED"===t.type)return Object(d.a)({},e),t.searchResult;if("SEARCH_END"===t.type)return Object(d.a)({},e),null;return e},symmetricKey:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;if("SET_SYMMETRIC_KEY"===t.type)return t.symmetricKey;return e},symmetricKeysForDecrypt:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;if("SET_SYMMETRIC_KEY_FOR_DECRYPT"===t.type){var a=Object(u.a)(e);return a.find(function(e){return e.KeyId===t.symmetricKeyForDecrypt.KeyId})||a.push(t.symmetricKeyForDecrypt),a}return e}});var E=a(475);function I(e){return{type:"DIALOGS_RECEIVED",dialogs:e}}function b(e){return{type:"MESSAGES_RECEIVED",payload:e}}function S(e){return{type:"FORWARD_MESSAGE",message:e}}function T(e){return{type:"OPEN_DIALOG",payload:e}}function C(e){return{type:"TOGGLE_CRYPTO_MODE",payload:e}}function O(e){return{type:"USER_RECEIVED",users:e}}function N(e){return{type:"OPEN_PROFILE",dialog:e}}function k(e){return{type:"TOGGLE_DRAWER",name:e}}function R(e){return{type:"TOGGLE_MODAL",name:e}}var _=a(16),j=a(17),P=a(52),A=a(50),U=a(53),w=a(472),M=a(473),D=a(474),K=a(62),F=a(216),x=new(function(){function e(){Object(_.a)(this,e),this.reconnectInterval,this.needReconnect=!0}return Object(j.a)(e,[{key:"start",value:function(e){var t=this;this.webSocket=new F.a("wss://".concat(e,":5000")),this.webSocket.onopen=function(){t.needReconnect=!0,clearInterval(t.reconnectInterval),t.wsOnConnect(),setInterval(function(){t.send({Length:1,RequestType:102,RequestId:999,Type:0})},3e3)},this.webSocket.onclose=function(e){},this.webSocket.onmessage=function(e){var a=t.blobToJson(e.data);a.ErrorCode&&0!==a.ErrorCode?(t.onMessage(a),t.onMessageAuth(a),t.onMessageReg(a)):(t.onMessage(a),t.onMessageAuth(a),t.onMessageReg(a),t.blobToJson(e.data).RequestId)},this.webSocket.onerror=function(e){}}},{key:"close",value:function(){this.needReconnect=!1,this.webSocket.close(1e3,"changeNode")}},{key:"getStatus",value:function(){return this.webSocket.readyState}},{key:"blobToJson",value:function(e){var t,a;return t=URL.createObjectURL(e),(a=new XMLHttpRequest).open("GET",t,!1),a.send(),URL.revokeObjectURL(t),v.a.parse(a.responseText)}},{key:"makeId",value:function(){for(var e="",t="0123456789".length,a=0;a<14;a++)e+="0123456789".charAt(Math.floor(Math.random()*t));return parseInt(e)}},{key:"send",value:function(e){e.RequestId,this.webSocket.send(JSON.stringify(e))}},{key:"onMessage",value:function(){}},{key:"onMessageAuth",value:function(){}},{key:"onMessageReg",value:function(){}},{key:"wsOnConnect",value:function(){}},{key:"reconnect",value:function(){}}]),e}());function q(e){return{type:"SET_NODE",node:e}}function G(e){return{type:"SET_PATH",path:e}}var L=w.a.Option,B=function(e){function t(){return Object(_.a)(this,t),Object(P.a)(this,Object(A.a)(t).call(this))}return Object(U.a)(t,e),Object(j.a)(t,[{key:"componentDidMount",value:function(){}},{key:"selectNode",value:function(e){if(e)if(JSON.parse(e).auto)this.props.setActiveNode(this.props.node.allNodes[0]),localStorage.setItem("node",JSON.stringify(this.props.node.allNodes[0]));else{var t=this.props.node.allNodes.find(function(t){return t.Id===e});t&&(this.props.setActiveNode(t),localStorage.setItem("node",JSON.stringify(t)))}}},{key:"connectNode",value:function(e){this.props.node.activeNode?x.start(this.props.node.activeNode.Domains[0]):this.props.node.allNodes&&(x.start(this.props.node.allNodes[0].Domains[0]),this.props.setActiveNode(this.props.node.allNodes[0]),localStorage.setItem("node",JSON.stringify(this.props.node.allNodes[0]))),this.props.setPath(e)}},{key:"handleChangeNode",value:function(e){JSON.parse(e)&&(connectNode(JSON.parse(e)),q(JSON.parse(e)),localStorage.setItem("node",e))}},{key:"render",value:function(){return r.a.createElement(M.a,{type:"flex",align:"middle",justify:"center",style:{height:"100vh"}},r.a.createElement(D.a,null,r.a.createElement("div",{className:"auth__type"},r.a.createElement("h1",null,"\u0412\u0445\u043e\u0434"),r.a.createElement("h2",null,"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u043f\u043e\u0441\u043e\u0431 \u0432\u0445\u043e\u0434\u0430"),r.a.createElement("div",{className:"auth__type_server"},r.a.createElement("span",null,"\u0421\u0435\u0440\u0432\u0435\u0440: "),this.props.node.allNodes?r.a.createElement(w.a,{defaultValue:localStorage.getItem("node")?JSON.parse(localStorage.getItem("node")).Id:'{"auto": "true"}',style:{width:"100%",overflow:"hidden"},onChange:this.selectNode.bind(this)},r.a.createElement(L,{key:999,value:'{"auto": "true"}'},"\u0410\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438"),this.props.node.allNodes.map(function(e,t){var a={width:"50px",height:"50px",backgroundSize:"cover",backgroundPosition:"center center",backgroundImage:"url(https://".concat(e.Domains[0],":5000/api/Files/").concat(e.Photo,")"),backgroundRepeat:"no-repeat",borderRadius:"100%",flexShrink:0};return r.a.createElement(L,{key:t,value:e.Id},r.a.createElement("div",{className:"node_photo",style:a}),r.a.createElement("div",{className:"node_fields"},r.a.createElement("div",null,r.a.createElement("span",{className:"node_field"},"\u0418\u043c\u044f: "),r.a.createElement("span",null,e.Name)),r.a.createElement("div",null,r.a.createElement("span",{className:"node_field"},"\u0422\u044d\u0433: "),r.a.createElement("span",null,e.Tag)),r.a.createElement("div",null,r.a.createElement("span",{className:"node_field"},"\u0421\u0442\u0440\u0430\u043d\u0430: "),r.a.createElement("span",null,e.Country))))})):null),r.a.createElement(K.a,{type:"secondary",onClick:this.connectNode.bind(this,"by-phone")},"\u041f\u043e \u043d\u043e\u043c\u0435\u0440\u0443 \u0442\u0435\u043b\u0435\u0444\u043e\u043d\u0430"),r.a.createElement("br",null),r.a.createElement(K.a,{type:"secondary",onClick:this.connectNode.bind(this,"by-email")},"\u041f\u043e \u044d\u043b\u0435\u043a\u0442\u0440\u043e\u043d\u043d\u043e\u0439 \u043f\u043e\u0447\u0442\u0435"),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement(K.a,{type:"link",onClick:this.connectNode.bind(this,"registration")},"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f"))))}}]),t}(n.Component);var J=Object(l.b)(function(e){return{node:e.node}},function(e){return{setActiveNode:function(t){return e(q(t))},setPath:function(t){return e(G(t))}}})(B),V=a(5),H=a(486),z=a(481),W=a(487);var Y=a(33),Z=a.n(Y),$=JSON.parse(localStorage.getItem("keysPair")),Q=JSON.parse(localStorage.getItem("signKeysPair")),X=null;$&&localStorage.getItem("User")&&(X=$.map(function(e){return{KeyId:e.id,UserId:JSON.parse(localStorage.getItem("User")).Id,PublicKey:e.public,PrivateKey:e.private,Lifetime:99999,GenerationTime:0,IsSign:!1}})),Q&&localStorage.getItem("User")&&Q.forEach(function(e){var t={KeyId:e.id,UserId:JSON.parse(localStorage.getItem("User")).Id,PublicKey:e.public,PrivateKey:e.private,Lifetime:99999,GenerationTime:0,IsSign:!0};X.push(t)});var ee=a(54),te=a.n(ee);var ae={bufferToBase64:function(e){var t=Array.prototype.map.call(e,function(e){return String.fromCharCode(e)}).join("");return btoa(t)},base64ToBuffer:function(e){var t=atob(e),a=new Uint8Array(t.length);return Array.prototype.forEach.call(t,function(e,t){a[t]=e.charCodeAt(0)}),a},devicesKeysExchange:function(e,t){var a=new TextEncoder,n=a.encode("qwerty"),r=BigInt(1),o=new Z.a(n,r),s=JSON.parse(localStorage.getItem("signKeysPair"))[JSON.parse(localStorage.getItem("signKeysPair")).length-1],l=x.makeId();o.setPublicEncryptKeyToSend(ae.base64ToBuffer(e)),o.setPrivateSignKeyToSend(ae.base64ToBuffer(s.private)),o.getSymmetricKey(1,l,99999).then(function(e){o.setSymmetricKey(e),o.encryptSecretMsg(1,1,99999,a.encode(JSON.stringify(X))).then(function(a){o.encryptKeyMsg(1,99999,e).then(function(e){var n={ResponseType:1,Type:9,EncryptedSymmetricKey:ae.bufferToBase64(e),EncryptedData:ae.bufferToBase64(a),PublicKey:s.public,RequestId:t};x.send(n)}).catch(function(e){})}).catch(function(e){})}).catch(function(e){})},setKeysFromAnotherDevice:function(e){var t=new TextEncoder,a=new TextDecoder,n=t.encode("qwerty"),r=BigInt(1),o=new Z.a(n,r),s=JSON.parse(localStorage.getItem("keysPair"))[JSON.parse(localStorage.getItem("keysPair")).length-1];o.setPublicSignKeyToRecive(ae.base64ToBuffer(e.PublicKey)),o.setPrivateEncryptKeyToRecive(ae.base64ToBuffer(s.private)),o.decryptKeyMsg(ae.base64ToBuffer(e.EncryptedSymmetricKey)).then(function(t){t&&(o.setSymmetricKey(t.key),o.decryptSecretMsg(ae.base64ToBuffer(e.EncryptedKeys)).then(function(e){if(e.msg){var t=JSON.parse(a.decode(e.msg)),n=[];X&&(n=X.map(function(e){return e.KeyId})),t.forEach(function(e){if(!n.includes(e.KeyId))if(e.IsSign){var t=JSON.parse(localStorage.getItem("signKeysPair"))||[],a={};a.id=e.KeyId,a.public=e.PublicKey,a.private=e.PrivateKey,t.push(a),localStorage.setItem("signKeysPair",JSON.stringify(t))}else{var r=JSON.parse(localStorage.getItem("keysPair"))||[],o={};o.id=e.KeyId,o.public=e.PublicKey,o.private=e.PrivateKey,r.push(o),localStorage.setItem("keysPair",JSON.stringify(r))}})}}).catch(function(e){console.log()}))}).catch(function(e){console.log()})},setKeysPair:function(){var e=(new TextEncoder).encode("qwerty"),t=te()(1),a=new Z.a(e,t),n=function(e,t){var a=JSON.parse(localStorage.getItem("keysPair"))||[],n=e;n.id=t,n.public=ae.bufferToBase64(e.public),n.private=ae.bufferToBase64(e.private),a.push(n),localStorage.setItem("keysPair",JSON.stringify(a))},r=function(e,t){var a=JSON.parse(localStorage.getItem("signKeysPair"))||[],n=e;n.id=t,n.public=ae.bufferToBase64(e.public),n.private=ae.bufferToBase64(e.private),a.push(n),localStorage.setItem("signKeysPair",JSON.stringify(a))},o=x.makeId();a.getKeyPairShort(1,o,99999,!0).then(function(e){n(e,o),o=x.makeId(),a.getKeyPairMidle(1,o,99999,!0).then(function(e){n(e,o),o=x.makeId(),a.getKeyPairLong(1,o,99999,!0).then(function(e){n(e,o)}).catch(function(e){console.log(e)})}).catch(function(e){console.log(e)})}).catch(function(e){console.log(e)});var s=x.makeId();a.getKeyPairShort(1,s,99999,!1).then(function(e){r(e,s),s=x.makeId(),a.getKeyPairMidle(1,s,99999,!1).then(function(e){r(e,s),s=x.makeId(),a.getKeyPairLong(1,s,99999,!1).then(function(e){r(e,s)}).catch(function(e){console.log(e)})}).catch(function(e){console.log(e)})}).catch(function(e){console.log(e)})},getOS:function(){return navigator.appVersion.indexOf("Windows")>=0?"Windows":navigator.appVersion.indexOf("Android")>=0?"Android":navigator.appVersion.indexOf("Mac")>=0?"MacOS":"unknown"},getDevice:function(){return navigator.userAgent.indexOf("Android")>=0?"Phone":navigator.userAgent.indexOf("webOS")>=0?"webOS":navigator.userAgent.indexOf("iPhone")>=0?"iPhone":navigator.userAgent.indexOf("iPad")>=0?"iPad":navigator.userAgent.indexOf("iPod")>=0?"iPod":"PC"}};var ne=Object(l.b)(function(e){return{nodes:e.node.allNodes}},function(e){return{}})(function(e){var t=Object(n.useState)(""),a=Object(V.a)(t,2),o=a[0],s=a[1],l=Object(n.useState)(""),c=Object(V.a)(l,2),i=c[0],u=c[1],d=Object(n.useState)(""),m=Object(V.a)(d,2),p=m[0],f=m[1],g=Object(n.useState)(""),y=Object(V.a)(g,2),v=y[0],h=y[1],E=Object(n.useState)(""),I=Object(V.a)(E,2),b=I[0],S=I[1],T=Object(n.useState)(!1),C=Object(V.a)(T,2),O=C[0],N=C[1],k=Object(n.useState)(!1),R=Object(V.a)(k,2),_=R[0],j=R[1],P=Object(n.useState)(!1),A=Object(V.a)(P,2),U=A[0],F=A[1],q=Object(n.useState)(!1),G=Object(V.a)(q,2),L=G[0],B=G[1],J=Object(n.useState)(!1),Y=Object(V.a)(J,2),Z=Y[0],$=Y[1],Q=Object(n.useState)(!1),X=Object(V.a)(Q,2),ee=X[0],te=X[1],ne=Object(n.useState)(null),re=Object(V.a)(ne,2),oe=re[0],se=re[1],le=Object(n.useState)(!1),ce=Object(V.a)(le,2),ie=ce[0],ue=ce[1],de=w.a.Option;Object(n.useEffect)(function(){x.onMessageReg=function(e){if(0!==e.ErrorCode){if(18===e.ErrorCode){var t=JSON.parse(e.Message);t.Phone?F(t.Phone):t.Email&&j(t.Email)}H.a.warning(e.Message)}else 6===e.ResponseType?(localStorage.setItem("FileAccessToken",e.FileAccessToken),localStorage.setItem("AccessToken",e.Token.AccessToken),localStorage.setItem("RefreshToken",e.Token.RefreshToken),localStorage.setItem("User",JSON.stringify(e.User)),window.location.replace("/")):10===e.ResponseType&&ue(!0)},se(JSON.parse(localStorage.getItem("node"))),ae.setKeysPair()},[]);var me=function(e){var t=e.target.value;!isNaN(t)&&/^-?\d*(\.\d*)?$/.test(t)||""===t||"-"===t?(f(e.target.value),F(!1)):F("\u042d\u0442\u043e \u043f\u043e\u043b\u0435 \u043c\u043e\u0436\u0435\u0442 \u0441\u043e\u0434\u0435\u0440\u0436\u0430\u0442\u044c \u0442\u043e\u043b\u044c\u043a\u043e \u0446\u0438\u0444\u0440\u044b"),B(!1)},pe=function(e){var t;h(e.target.value),B(!1),t=e.target.value,/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(t)?j(!1):j("\u041d\u0435\u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u044b\u0439 email \u0430\u0434\u0440\u0435\u0441"),0===e.target.value.length&&j(!1)},fe=function(e){e&&(x.close(),x.start(e.Domains[0]))};return r.a.createElement(M.a,{type:"flex",align:"middle",justify:"center",style:{height:"100vh"}},r.a.createElement(D.a,null,r.a.createElement("div",{className:"auth__type reg__form"},r.a.createElement("h1",null,"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f"),r.a.createElement("div",null,r.a.createElement("div",{className:"auth__type_server"},r.a.createElement("span",null,"\u0421\u0435\u0440\u0432\u0435\u0440: "),r.a.createElement(w.a,{defaultValue:localStorage.getItem("node")?JSON.parse(localStorage.getItem("node")).Id:'{"auto": "true"}',style:{width:"100%",overflow:"hidden"},onChange:function(t){if(t)if(JSON.parse(t).auto)fe(e.nodes[0]),se(e.nodes[0]),localStorage.setItem("node",JSON.stringify(e.nodes[0]));else{var a=e.nodes.find(function(e){return e.Id===t});a&&(se(a),fe(a),localStorage.setItem("node",JSON.stringify(a)))}}},r.a.createElement(de,{key:999,value:'{"auto": "true"}'},"\u0410\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438"),e.nodes.map(function(e,t){var a={width:"50px",height:"50px",backgroundSize:"cover",backgroundPosition:"center center",backgroundImage:"url(https://".concat(e.Domains[0],":5000/api/Files/").concat(e.Photo,")"),backgroundRepeat:"no-repeat",borderRadius:"100%",flexShrink:0};return r.a.createElement(de,{key:t,value:e.Id},r.a.createElement("div",{className:"node_photo",style:a}),r.a.createElement("div",{className:"node_fields"},r.a.createElement("div",null,r.a.createElement("span",{className:"node_field"},"\u0418\u043c\u044f: "),r.a.createElement("span",null,e.Name)),r.a.createElement("div",null,r.a.createElement("span",{className:"node_field"},"\u0422\u044d\u0433: "),r.a.createElement("span",null,e.Tag)),r.a.createElement("div",null,r.a.createElement("span",{className:"node_field"},"\u0421\u0442\u0440\u0430\u043d\u0430: "),r.a.createElement("span",null,e.Country))))}))),r.a.createElement(z.a,{className:"login-form"},ie?r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"verify-text"},"\u041c\u044b \u043e\u0442\u043f\u0440\u0430\u0432\u0438\u043b\u0438 \u0432\u0430\u043c \u043a\u043e\u0434 \u043f\u043e\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043d\u0438\u044f \u043d\u0430 \u0432\u0430\u0448 ".concat(p?"\u0442\u0435\u043b\u0435\u0444\u043e\u043d":"email",", \u043f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430 \u0432\u0432\u0435\u0434\u0438\u0442\u0435 \u0435\u0433\u043e \u0432 \u043f\u043e\u043b\u0435 \u043d\u0438\u0436\u0435 \u0438 \u0437\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u0435 \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044e")),r.a.createElement(z.a.Item,{validateStatus:Z?"error":"",help:Z||""},r.a.createElement(W.a,{placeholder:"\u041a\u043e\u0434",value:b,onChange:function(e){S(e.target.value),$(!1)}})),r.a.createElement(z.a.Item,null,r.a.createElement(M.a,null,r.a.createElement(D.a,{style:{textAlign:"center"}},r.a.createElement(K.a,{type:"primary",onClick:function(){if(b){te(!0);for(var e=[],t=0;e.length<=31;t++)e.push(!1);e[1]=!0,e[2]=!1,e[14]=!1,e[15]=!0,e[17]=!0;var a={User:{Id:0,Phones:p?[{FullNumber:"+".concat(p)}]:null,NameFirst:o,NameSecond:i,About:"",Photo:"",Country:"",City:"",Birthday:"",Language:null,NodeId:oe.Id,Online:null,Emails:v?[v]:null,Blacklist:null,Visible:null,Security:null,Tag:0,RegistrationDate:null,Privacy:e},VCode:parseInt(b),RequestId:x.makeId(),RequestType:37,Type:0};x.send(a)}else $("\u042d\u0442\u043e \u043f\u043e\u043b\u0435 \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e \u0434\u043b\u044f \u0437\u0430\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f")},loading:ee},"\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c\u0441\u044f"))))):r.a.createElement(r.a.Fragment,null,r.a.createElement(z.a.Item,{validateStatus:O?"error":"",help:O||""},r.a.createElement(W.a,{placeholder:"\u0418\u043c\u044f",onChange:function(e){s(e.target.value),N(!1)}})),r.a.createElement(z.a.Item,{validateStatus:""},r.a.createElement(W.a,{placeholder:"\u0424\u0430\u043c\u0438\u043b\u0438\u044f",onChange:function(e){u(e.target.value)}})),oe?1===oe.RegistrationMethod?r.a.createElement(z.a.Item,{validateStatus:L||U?"error":"",help:L||U||""},r.a.createElement(W.a,{addonBefore:"+",inputMode:"tel",type:"phone",placeholder:"\u041d\u043e\u043c\u0435\u0440 \u0442\u0435\u043b\u0435\u0444\u043e\u043d\u0430",value:p,disabled:!!v.length,onChange:me})):2===oe.RegistrationMethod?r.a.createElement(z.a.Item,{validateStatus:L||_?"error":"",help:L||_||""},r.a.createElement(W.a,{inputMode:"email",type:"email",placeholder:"Email",disabled:!!p.length,onChange:pe})):r.a.createElement(r.a.Fragment,null,r.a.createElement(z.a.Item,{validateStatus:L||U?"error":"",help:L||U||""},r.a.createElement(W.a,{addonBefore:"+",inputMode:"tel",type:"phone",placeholder:"\u041d\u043e\u043c\u0435\u0440 \u0442\u0435\u043b\u0435\u0444\u043e\u043d\u0430",value:p,disabled:!!v.length,onChange:me})),r.a.createElement("div",{className:"verify-text"},r.a.createElement("span",null,"\u0438\u043b\u0438")),r.a.createElement(z.a.Item,{validateStatus:L||_?"error":"",help:L||_||""},r.a.createElement(W.a,{inputMode:"email",type:"email",placeholder:"Email",disabled:!!p.length,onChange:pe}))):null,r.a.createElement(z.a.Item,null,r.a.createElement(M.a,null,r.a.createElement(D.a,{style:{textAlign:"center"}},r.a.createElement(K.a,{type:"primary",onClick:function(){return function(){if(0===o.length)N("\u042d\u0442\u043e \u043f\u043e\u043b\u0435 \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e \u0434\u043b\u044f \u0437\u0430\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f");else if(0===p.length&&0===v.length)B("\u041e\u0434\u043d\u043e \u0438\u0437 \u044d\u0442\u0438\u0445 \u043f\u043e\u043b\u0435\u0439 \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e \u0434\u043b\u044f \u0437\u0430\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f");else if(p.length>0&&11!=p.length)F("\u041d\u043e\u043c\u0435\u0440 \u0434\u043e\u043b\u0436\u0435\u043d \u0441\u043e\u0441\u0442\u043e\u044f\u0442\u044c \u0438\u0437 11 \u0446\u0438\u0444\u0440");else{var e=x.makeId(),t={VerificationType:v?1:0,Uid:p?"+".concat(p):v,IsRegistration:!0,RequestId:e,RequestType:42,Type:0};F(!1),x.send(t)}}()},disabled:!(o&&p||v),htmlType:"submit"},"\u041f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u043a\u043e\u0434"))))))))))}),re=a(11),oe=a(63);function se(e){return{type:"SET_AUTH",auth:e}}var le=function(e){function t(){var e;return Object(_.a)(this,t),(e=Object(P.a)(this,Object(A.a)(t).call(this))).state={verifyUid:null,verifyErr:null,verifyRequestSended:!1,verifyCode:null,verifyCodeErr:null,btnPreloader:!1,redirect:!1},e}return Object(U.a)(t,e),Object(j.a)(t,[{key:"componentDidMount",value:function(){var e=this;x.onMessageAuth=function(t){if(e.setState({btnPreloader:!1}),0!=t.ErrorCode&&1!=t.ErrorCode){if(18===t.ErrorCode){var a=JSON.parse(t.Message);a.Phone||a.Email&&e.setState({verifyErr:a.Email})}}else 10===t.ResponseType?e.setState({verifyRequestSended:!0}):6===t.ResponseType&&(localStorage.setItem("FileAccessToken",t.FileAccessToken),localStorage.setItem("AccessToken",t.Token.AccessToken),localStorage.setItem("RefreshToken",t.Token.RefreshToken),localStorage.setItem("User",JSON.stringify(t.User)),e.props.setAuth("AUTH_SUCCESS"),e.setState({redirect:!0}))},ae.setKeysPair()}},{key:"onChangePhone",value:function(e){if("by-email"===this.props.verifyType)this.setState({verifyUid:e.target.value,verifyErr:null});else if("by-phone"===this.props.verifyType){(!isNaN(e.target.value)&&/^-?\d*(\.\d*)?$/.test(e.target.value)||""===e.target.value||"-"===e.target.value)&&this.setState({verifyUid:e.target.value,verifyErr:null})}}},{key:"onChangeVerifCode",value:function(e){this.setState({verifyCode:e.target.value,verifyCodeErr:null})}},{key:"getOS",value:function(){return navigator.appVersion.indexOf("Windows")>=0?"Windows":navigator.appVersion.indexOf("Android")>=0?"Android":navigator.appVersion.indexOf("Mac")>=0?"MacOS":"unknown"}},{key:"getDevice",value:function(){return navigator.userAgent.indexOf("Android")>=0?"Phone":navigator.userAgent.indexOf("webOS")>=0?"webOS":navigator.userAgent.indexOf("iPhone")>=0?"iPhone":navigator.userAgent.indexOf("iPad")>=0?"iPad":navigator.userAgent.indexOf("iPod")>=0?"iPod":"PC"}},{key:"sendverifyCode",value:function(e){e.preventDefault(),this.setState({btnPreloader:!0});var t={Uid:"by-email"===this.props.verifyType?this.state.verifyUid:"+".concat(this.state.verifyUid),VCode:this.state.verifyCode,LoginType:1,UidType:"by-email"===this.props.verifyType?2:(this.props.verifyType,0),DeviceName:ae.getDevice(),OSName:ae.getOS(),AppName:"Y messenger - WEB",RequestId:x.makeId(),RequestType:33,Type:0};x.send(t)}},{key:"sendVerificationQuery",value:function(e){var t=this;e.preventDefault();var a,n=function(){t.setState({btnPreloader:!0});var e={VerificationType:"by-email"===t.props.verifyType?1:(t.props.verifyType,0),Uid:"by-email"===t.props.verifyType?t.state.verifyUid:"+".concat(t.state.verifyUid),RequestId:x.makeId(),RequestType:42,Type:0};x.send(e)};if("by-email"===this.props.verifyType){a=this.state.verifyUid,/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(a)?(n(),this.setState({verifyErr:null})):this.setState({verifyErr:"\u041d\u0435\u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u044b\u0439 email \u0430\u0434\u0440\u0435\u0441"})}else"by-phone"===this.props.verifyType&&(this.state.verifyUid.length>0&&11!=this.state.verifyUid.length?this.setState({verifyErr:"\u041d\u043e\u043c\u0435\u0440 \u0434\u043e\u043b\u0436\u0435\u043d \u0441\u043e\u0441\u0442\u043e\u044f\u0442\u044c \u0438\u0437 11 \u0446\u0438\u0444\u0440"}):n())}},{key:"render",value:function(){var e=this;return this.state.redirect?r.a.createElement(oe.a,{to:"/"}):r.a.createElement(M.a,{type:"flex",align:"middle",justify:"center",style:{height:"100vh"}},r.a.createElement(D.a,null,r.a.createElement("div",{className:"auth__type"},r.a.createElement("div",{className:"modal_back",onClick:function(){return e.props.setPrevPath()}},r.a.createElement(re.a,{type:"arrow-left"})),r.a.createElement("h1",null,"\u0412\u0445\u043e\u0434"),this.state.verifyRequestSended?r.a.createElement("div",null,r.a.createElement("h2",null,"\u041a\u043e\u0434 \u043f\u043e\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043d\u0438\u044f \u0438\u0437 ","by-email"===this.props.verifyType?"\u043f\u0438\u0441\u044c\u043c\u0430":"by-phone"===this.props.verifyType?"SMS":""),r.a.createElement("p",null,"\u041c\u044b \u043e\u0442\u043f\u0440\u0430\u0432\u0438\u043b\u0438 ","by-email"===this.props.verifyType?"\u043f\u0438\u0441\u044c\u043c\u043e ":"by-phone"===this.props.verifyType?" SMS ":"","\u043d\u0430 ","by-email"===this.props.verifyType?"email ".concat(this.state.verifyUid):"by-phone"===this.props.verifyType?"\u043d\u043e\u043c\u0435\u0440 +".concat(this.state.verifyUid):"",". \u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u044b\u0439 \u043a\u043e\u0434 \u0432 \u043f\u043e\u043b\u0435 \u043d\u0438\u0436\u0435"),r.a.createElement(z.a,{onSubmit:this.sendverifyCode.bind(this),className:"login-form"},r.a.createElement(z.a.Item,{validateStatus:this.state.verifyCodeErr?"error":"",help:this.state.verifyCodeErr?this.state.verifyCodeErr:""},r.a.createElement(W.a,{autoFocus:!0,inputMode:"tel",placeholder:"\u041a\u043e\u0434 \u0438\u0437 ".concat("by-email"===this.props.verifyType?"\u043f\u0438\u0441\u044c\u043c\u0430":"by-phone"===this.props.verifyType?"SMS":"",", 4 \u0446\u0438\u0444\u0440\u044b"),onChange:this.onChangeVerifCode.bind(this)})),r.a.createElement(z.a.Item,null,r.a.createElement(M.a,null,r.a.createElement(D.a,{style:{textAlign:"center"}},r.a.createElement(K.a,{type:"primary",htmlType:"submit",disabled:!this.state.verifyCode,loading:!!this.state.btnPreloader},"\u0412\u043e\u0439\u0442\u0438")))))):r.a.createElement("div",null,r.a.createElement("h2",null,"by-email"===this.props.verifyType?"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0432\u0430\u0448 email":"by-phone"===this.props.verifyType?"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043d\u043e\u043c\u0435\u0440 \u0442\u0435\u043b\u0435\u0444\u043e\u043d\u0430":""),r.a.createElement(z.a,{className:"login-form"},r.a.createElement(z.a.Item,{validateStatus:this.state.verifyErr?"error":"",help:this.state.verifyErr?this.state.verifyErr:""},r.a.createElement(W.a,{autoFocus:!0,addonBefore:"by-phone"===this.props.verifyType&&"+",inputMode:"by-email"===this.props.verifyType?"email":"by-phone"===this.props.verifyType?"tel":"",placeholder:"by-email"===this.props.verifyType?"\u0412\u0430\u0448 email":"by-phone"===this.props.verifyType?"\u0412\u0430\u0448 \u043d\u043e\u043c\u0435\u0440 \u0442\u0435\u043b\u0435\u0444\u043e\u043d\u0430":"",onChange:this.onChangePhone.bind(this),value:this.state.verifyUid,type:"by-email"===this.props.verifyType?"email":"by-phone"===this.props.verifyType?"phone":""})),r.a.createElement(z.a.Item,null,r.a.createElement(M.a,null,r.a.createElement(D.a,{style:{textAlign:"center"}},r.a.createElement(K.a,{type:"primary",onClick:this.sendVerificationQuery.bind(this),disabled:!this.state.verifyUid,loading:!!this.state.btnPreloader,htmlType:"submit"},"\u041f\u043e\u043b\u0443\u0447\u0438\u0442\u044c ","by-email"===this.props.verifyType?"\u043f\u0438\u0441\u044c\u043c\u043e":"by-phone"===this.props.verifyType?"SMS":""," \u0441 \u043a\u043e\u0434\u043e\u043c")))))))))}}]),t}(n.Component);var ce=Object(l.b)(function(e){return{verifyType:e.path.currentPath}},function(e){return{setAuth:function(t){return e(se(t))},setPrevPath:function(){return e({type:"PREV_PATH"})}}})(le),ie=a(45);var ue={getFormatedMessages:function(e){var t=[];return e.forEach(function(e){var a={Attachments:e.Attachments,ConversationId:e.ConversationId,ConversationType:e.ConversationType,GlobalId:e.GlobalId,Read:e.Read,SenderId:e.SenderId,SendingTime:e.SendingTime,Text:e.Text};t.push(a)}),t},getFormatedDialogs:function(e){var t=[];return e.forEach(function(e){var a={AttachmentType:e.AttachmentType,ConversationId:e.ConversationId,ConversationType:e.ConversationType,IsMuted:e.IsMuted,LastMessageId:e.LastMessageId,LastMessageSenderId:e.LastMessageSenderId,LastMessageSenderName:e.LastMessageSenderName,LastMessageTime:e.LastMessageTime,Photo:e.Photo,PreviewText:e.PreviewText,Read:e.Read,SecondUid:e.SecondUid,Title:e.Title,UnreadedCount:e.UnreadedCount};t.push(a)}),t},getFormatedChats:function(e){var t=[];return e.forEach(function(e){var a={About:e.About,Id:e.Id,Key:e.Key,Name:e.Name,NodesId:e.NodesId,Photo:e.Photo,Public:e.Public,Security:e.Security,Tag:e.Tag,Type:e.Type,Users:e.Users,Visible:e.Visible};t.push(a)}),t},getFormatedChatsUsers:function(e){var t=[];return e.forEach(function(e){var a={Banned:e.Banned,ChatId:e.ChatId,Deleted:e.Deleted,InviterId:e.InviterId,IsMuted:e.IsMuted,Joined:e.Joined,UserId:e.UserId,UserInfo:e.UserInfo,UserRole:e.UserRole};t.push(a)}),t},getFormatedUser:function(e){var t=[];return e.forEach(function(e){var a={About:e.About,Birthday:e.Birthday,BlackList:e.BlackList,City:e.City,Confirmed:e.Confirmed,Contact:e.Contact,ContactsPrivacy:e.ContactsPrivacy,Country:e.Country,Emails:e.Emails,Encryption:e.Encryption,Groups:e.Groups,Id:e.Id,Keys:e.Keys,Language:e.Language,NameFirst:e.NameFirst,NameSecond:e.NameSecond,NodeId:e.NodeId,Online:e.Online,Phones:e.Phones,Photo:e.Photo,RegistrationDate:e.RegistrationDate,Security:e.Security,Tag:e.Tag,Visible:e.Visible};t.push(a)}),t},getUserById:function(e,t){return t.find(function(t){return t.Id+""===e+""})},getUserInitials:function(e){if(!e.Photo){var t="";if(e.Title||e.ChannelName||e.Name){var a=e.Title||e.ChannelName||e.Name;(a=(a=a.replace(/ +/g," ").trim()).split(" ",2))[0]&&(t=a[0][0]),a[1]&&(t+=a[1][0])}else if(e.NameFirst)t=e.NameFirst[0],e.NameSecond&&(t+=e.NameSecond[0]);else{var n=e.SecondUid||e.Id;t=(n+="").substr(0,2)}return t}},getActiveDialog:function(e){return e.find(function(e){return e.active})},getUserName:function(e,t){if(e&&t){var a="",n=e.SecondUid||e.Id,r=t.find(function(e){return e.ContactUserId===n});return r?r.Name&&(a=r.Name):a=e.Title||e.ChannelName||e.Name?e.Title||e.ChannelName||e.Name:e.NameFirst||e.NameSecond?"".concat(e.NameFirst," ").concat(e.NameSecond):"\u0418\u043c\u044f \u0441\u043a\u0440\u044b\u0442\u043e",a}}},de=function(e){function t(){var e;return Object(_.a)(this,t),(e=Object(P.a)(this,Object(A.a)(t).call(this))).state={defaultAva:""},e}return Object(U.a)(t,e),Object(j.a)(t,[{key:"componentDidMount",value:function(){var e=this.refs.messageText,t=e.innerText;t.length>60&&(e.innerText=t.slice(0,60)+" ..."),this.props.dialog.Photo||this.setState({defaultAva:ue.getUserInitials(this.props.dialog)})}},{key:"openDialog",value:function(){var e={};e.type=this.props.type,e.data=this.props.dialog,this.props.openDialog(e)}},{key:"render",value:function(){var e=this,t={width:"100%",height:"100%",backgroundSize:"cover",backgroundPosition:"center center",backgroundImage:"url(https://".concat(this.props.node,":5000/api/Files/").concat(this.props.dialog.Photo,")"),backgroundRepeat:"no-repeat"};return r.a.createElement(ie.b,{to:"/",onClick:function(){return e.openDialog()}},r.a.createElement("div",{className:"sidebar__item"},r.a.createElement("div",{className:"sidebar__ava"},this.props.dialog.UnreadedCount>0?r.a.createElement("div",{className:"sidebar__badge"},this.props.dialog.UnreadedCount):null,r.a.createElement("div",{className:"sidebar__photo"},this.props.dialog.Photo?this.props.dialog.Photo.length>0?r.a.createElement("div",{style:t}):null:r.a.createElement("div",{className:"sidebar__photo-default avatar-default"},this.state.defaultAva))),r.a.createElement("div",null,r.a.createElement("div",{className:"sidebar__name"},"user"===this.props.type?r.a.createElement("span",null,this.props.dialog.Title||this.props.dialog.NameFirst+" "+this.props.dialog.NameSecond||this.props.dialog.ChannelName||this.props.dialog.Name||"\u0418\u043c\u044f \u0441\u043a\u0440\u044b\u0442\u043e"):r.a.createElement("span",null,ue.getUserName(this.props.dialog,this.props.contacts.users))),r.a.createElement("div",{className:"sidebar__message",ref:"messageText"},this.props.dialog.PreviewText?this.props.dialog.PreviewText:1===this.props.dialog.AttachmentType?"\u0424\u0430\u0439\u043b":2===this.props.dialog.AttachmentType?"\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435":4===this.props.dialog.AttachmentType?"\u0417\u0430\u0448\u0438\u0444\u0440\u043e\u0432\u0430\u043d\u043d\u043e\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435":5===this.props.dialog.AttachmentType?"\u041f\u0435\u0440\u0435\u0441\u043b\u0430\u043d\u043d\u043e\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435":6===this.props.dialog.AttachmentType?"\u0421\u0438\u043c\u043c\u0435\u0442\u0440\u0438\u0447\u043d\u044b\u0439 \u043a\u043b\u044e\u0447 \u0448\u0438\u0444\u0440\u043e\u0432\u0430\u043d\u0438\u044f":this.props.dialog.About?this.props.dialog.About:null))))}}]),t}(n.Component);var me=Object(l.b)(function(e){return{node:e.node.activeNode.Domains[0],contacts:e.contacts}},function(e){return{openDialog:function(t){return e(T(t))}}})(de),pe=a(224),fe=a.n(pe);var ge=Object(l.b)(function(e){return{}},function(e){return{toggleDrawer:function(){return e(k())}}})(function(e){return r.a.createElement("div",{className:"head-sidebar"},r.a.createElement(re.a,{type:"menu",className:"menu-btn",onClick:function(){return e.toggleDrawer()}}),r.a.createElement("div",{className:"head-sidebar__logo"},r.a.createElement("img",{src:fe.a,alt:"Y Messenger"})))});var ye=W.a.Search;var ve=Object(l.b)(function(e){return{search:e.ui.search}},function(e){return{searchStart:function(t){return e({type:"SEARCH_START",text:t})},searchEnd:function(){return e({type:"SEARCH_END"})}}})(function(e){var t=function(t){var a=t.target.value||t;if("string"===typeof a)if(a.length){e.searchStart(a.toLowerCase());var n={RequestType:46,SearchQuery:a,RequestId:x.makeId(),Direction:!0,Type:0};x.send(n)}else e.searchEnd();else e.searchEnd()};return r.a.createElement("div",{className:"search"},r.a.createElement(ye,{placeholder:"\u041f\u043e\u0438\u0441\u043a",onSearch:t,onChange:t,enterButton:!0}))});var he=Object(l.b)(function(e){return{dialogs:e.dialogs,search:e.ui.search,searchResult:e.searchResult,socketReconnect:e.ui.socketReconnect}},function(e){return{openDialog:function(t){return e(T(t))}}})(function(e){var t=Object(n.useState)([]),a=Object(V.a)(t,2),o=a[0],s=a[1];return Object(n.useEffect)(function(){if(e.search){var t=e.dialogs.filter(function(t){if(!t.fake&&t.Title)return t.Title.toLowerCase().indexOf(e.search)>=0});s(t)}else s(e.dialogs)},[e.search,e.dialogs]),r.a.createElement("div",{className:"sidebar"},r.a.createElement(ge,null),r.a.createElement(ve,null),r.a.createElement("div",{className:"sidebar-viewport"},o.map(function(e){if(e&&!e.fake)return r.a.createElement(me,{dialog:e,key:x.makeId(),type:"dialog"})}),e.searchResult?function(){if(e.searchResult.users)return e.searchResult.users.map(function(e,t){if(e)return 0===t?r.a.createElement("div",{key:x.makeId()},r.a.createElement("div",{className:"sidebar__title"},"\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0438:"),r.a.createElement(me,{dialog:e,type:"user"})):r.a.createElement(me,{dialog:e,type:"user",key:x.makeId()})})}():null,e.searchResult?function(){if(e.searchResult.chats)return e.searchResult.chats.map(function(e,t){if(e)return 0===t?r.a.createElement("div",{key:x.makeId()},r.a.createElement("div",{className:"sidebar__title"},"\u0427\u0430\u0442\u044b:"),r.a.createElement(me,{dialog:e,type:"chat"})):r.a.createElement(me,{dialog:e,type:"chat",key:x.makeId()})})}():null,e.searchResult?function(){if(e.searchResult.channels)return e.searchResult.channels.map(function(e,t){if(e)return 0===t?r.a.createElement("div",{key:x.makeId()},r.a.createElement("div",{className:"sidebar__title"},"\u041a\u0430\u043d\u0430\u043b\u044b:"),r.a.createElement(me,{dialog:e,type:"channel"})):r.a.createElement(me,{dialog:e,type:"channel",key:x.makeId()})})}():null),e.socketReconnect?r.a.createElement("div",{className:"socket_reconnect"},r.a.createElement(E.a,{size:"small"}),e.socketReconnect):null)}),Ee=a(485),Ie=a(480),be=a(226),Se=a.n(be),Te=a(476);var Ce=Object(l.b)(function(e){return{node:e.node.activeNode.Domains[0]}},function(e){return{}})(function(e){var t={width:"100%",height:"100%",backgroundSize:"cover",backgroundPosition:"center center",backgroundImage:"url(https://".concat(e.node,":5000/api/Files/").concat(e.user.Photo,")"),backgroundRepeat:"no-repeat",borderRadius:"100%"};return r.a.createElement("div",{className:"avatar"},e.user.Photo?r.a.createElement("div",{style:t}):r.a.createElement("div",{className:"avatar-default"},ue.getUserInitials(e.user)))});Ie.a.locale(Se.a);var Oe=Object(l.b)(function(e){return{dialogs:e.dialogs,users:e.users,node:e.node.activeNode.Domains[0],contacts:e.contacts}},function(e){return{openProfile:function(t){return e(N(t))},closeDialog:function(){return e({type:"CLOSE_DIALOG"})},toggleCryptoMode:function(t){return e(C(t))}}})(function(e){var t=Object(n.useState)(null),a=Object(V.a)(t,2),o=a[0],s=a[1],l=Object(n.useState)(""),c=Object(V.a)(l,2),i=(c[0],c[1]),u=Object(n.useState)(null),d=Object(V.a)(u,2),m=d[0],p=d[1],f=Object(n.useState)(document.body.clientWidth),g=Object(V.a)(f,2),y=g[0],v=g[1];return Object(n.useEffect)(function(){},[y]),window.onresize=function(){v(document.body.clientWidth)},Object(n.useEffect)(function(){if(e.users&&o){var t=e.users.find(function(e){return e.Id===o.SecondUid});p(t)}},[e.users,o]),Object(n.useEffect)(function(){e.dialogs.forEach(function(e){e.active&&s(e)})},[e.dialogs]),Object(n.useEffect)(function(){o&&(o.Photo||i(ue.getUserInitials(o)))},[o]),r.a.createElement("div",{className:"head-dialog"},y<=675&&ue.getActiveDialog(e.dialogs)?r.a.createElement("div",{className:"head-dialog__back",onClick:e.closeDialog},r.a.createElement(re.a,{type:"left"})):null,r.a.createElement("div",{className:"head-dialog__user",onClick:function(){e.openProfile(o)}},r.a.createElement("div",{className:"head-dialog__ava"},o?r.a.createElement(Ce,{user:o}):null),r.a.createElement("div",null,o?r.a.createElement("div",{className:"head-dialog__name"},ue.getUserName(o,e.contacts.users)):null,r.a.createElement("div",{className:"head-dialog__status"},m&&m.Online?r.a.createElement(Ee.a,{date:1e3*m.Online,locale:"ru"}):null))),o&&1===o.ConversationType?r.a.createElement("div",{className:"switch-label"},r.a.createElement("div",null,"\u0421\u0435\u043a\u0440\u0435\u0442\u043d\u044b\u0439 \u0447\u0430\u0442"),r.a.createElement(Te.a,{checked:o.isCrypto,onChange:function(t){return e.toggleCryptoMode({dialog:o,isCrypto:t})}})):null)}),Ne=a(483);function ke(e){return{type:"SET_CALLBACK_ID",id:e}}function Re(e){return{type:"SET_SYMMETRIC_KEY",symmetricKey:e}}function _e(e){return{type:"SET_SYMMETRIC_KEY_FOR_DECRYPT",symmetricKeyForDecrypt:e}}function je(e){return{type:"SET_PUBLIC_KEYS",publicKeys:e}}function Pe(){return(Pe=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function Ae(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var Ue=r.a.createElement("g",null,r.a.createElement("g",{id:"check"},r.a.createElement("polygon",{points:"142.8,323.85 35.7,216.75 0,252.45 142.8,395.25 448.8,89.25 413.1,53.55  "}))),we=r.a.createElement("g",null),Me=r.a.createElement("g",null),De=r.a.createElement("g",null),Ke=r.a.createElement("g",null),Fe=r.a.createElement("g",null),xe=r.a.createElement("g",null),qe=r.a.createElement("g",null),Ge=r.a.createElement("g",null),Le=r.a.createElement("g",null),Be=r.a.createElement("g",null),Je=r.a.createElement("g",null),Ve=r.a.createElement("g",null),He=r.a.createElement("g",null),ze=r.a.createElement("g",null),We=r.a.createElement("g",null),Ye=function(e){var t=e.svgRef,a=Ae(e,["svgRef"]);return r.a.createElement("svg",Pe({id:"Capa_1",x:"0px",y:"0px",width:"448.8px",height:"448.8px",viewBox:"0 0 448.8 448.8",style:{enableBackground:"new 0 0 448.8 448.8"},xmlSpace:"preserve",ref:t},a),Ue,we,Me,De,Ke,Fe,xe,qe,Ge,Le,Be,Je,Ve,He,ze,We)},Ze=r.a.forwardRef(function(e,t){return r.a.createElement(Ye,Pe({svgRef:t},e))});a.p;function $e(){return($e=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function Qe(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var Xe=r.a.createElement("g",null,r.a.createElement("g",{id:"done-all"},r.a.createElement("path",{d:"M448.8,161.925l-35.7-35.7l-160.65,160.65l35.7,35.7L448.8,161.925z M555.899,126.225l-267.75,270.3l-107.1-107.1 l-35.7,35.7l142.8,142.8l306-306L555.899,126.225z M0,325.125l142.8,142.8l35.7-35.7l-142.8-142.8L0,325.125z"}))),et=r.a.createElement("g",null),tt=r.a.createElement("g",null),at=r.a.createElement("g",null),nt=r.a.createElement("g",null),rt=r.a.createElement("g",null),ot=r.a.createElement("g",null),st=r.a.createElement("g",null),lt=r.a.createElement("g",null),ct=r.a.createElement("g",null),it=r.a.createElement("g",null),ut=r.a.createElement("g",null),dt=r.a.createElement("g",null),mt=r.a.createElement("g",null),pt=r.a.createElement("g",null),ft=r.a.createElement("g",null),gt=function(e){var t=e.svgRef,a=Qe(e,["svgRef"]);return r.a.createElement("svg",$e({id:"Capa_1",x:"0px",y:"0px",width:"594.149px",height:"594.149px",viewBox:"0 0 594.149 594.149",style:{enableBackground:"new 0 0 594.149 594.149"},xmlSpace:"preserve",ref:t},a),Xe,et,tt,at,nt,rt,ot,st,lt,ct,it,ut,dt,mt,pt,ft)},yt=r.a.forwardRef(function(e,t){return r.a.createElement(gt,$e({svgRef:t},e))});a.p;var vt=Object(l.b)(function(e){return{users:e.users,user:e.users.find(function(e){return!0===e.currentUser}),dialogs:e.dialogs,forwardMessage:e.forwardMessage,node:e.node.activeNode.Domains[0],symmetricKeysForDecrypt:e.symmetricKeysForDecrypt,publicKeys:e.publicKeys}},function(e){return{forwardingMessage:function(t){return e(S(t))},openDialog:function(t){return e(T(t))},closeDialog:function(){return e({type:"CLOSE_DIALOG"})},setSymmetricKey:function(t){return e(Re(t))},setSymmetricKeyForDecrypt:function(t){return e(_e(t))},setCallbackId:function(t){return e(ke(t))}}})(function(e){var t=Object(n.useState)(!1),a=Object(V.a)(t,2),o=a[0],s=a[1],l=Object(n.useState)(""),c=Object(V.a)(l,2),i=c[0],u=c[1],d=Object(n.useState)(!1),m=Object(V.a)(d,2),p=m[0],f=m[1],g=Object(n.useState)(null),y=Object(V.a)(g,2),h=y[0],E=y[1],I=Object(n.useState)(!1),b=Object(V.a)(I,2),S=b[0],T=b[1],C=ue.getUserById(te()(e.message.SenderId).toString(),e.users)||{},O=new TextEncoder,N=new TextDecoder,k=O.encode("qwerty"),R=te()(1),_=new Z.a(k,R);Object(n.useEffect)(function(){if(e.message){var t=new Date(1e3*e.message.SendingTime),a=new Date;a.setTime(t);var n="".concat(a.getHours()),r="".concat(a.getMinutes());1===n.length&&(n="0".concat(n)),1===r.length&&(r="0".concat(r)),u("".concat(n,":").concat(r))}},[e.message]);var j=function(e){var t=e,a=!1;t&&(a=t.match(/(http|https|ftp|ftps)\:\/\/[a-zA-Z0-9\-\.]+\.[a-zA-Z]{2,3}(\/\S*)?/g));var n=0;for(n in a)t=t.replace(a[n],' <a href="'+a[n]+'" target="_blank"> '+a[n]+" </a> ");return t},P=function(){var t=e.dialogs.find(function(t){return t.ConversationId===e.message.Attachments[0].Payload[0].ConversationId&&t.ConversationType===e.message.Attachments[0].Payload[0].ConversationType});if(t){var a={type:"dialog"};a.data=t,e.openDialog(a)}};return C&&e.message?r.a.createElement("div",{className:C.currentUser?"message message-out":"message message-in",id:e.message.GlobalId,onClick:function(){var t;(t=e.message).Attachments[0]&&1!==t.Attachments[0].Type&&2!==t.Attachments[0].Type&&5!==t.Attachments[0].Type||f(!p)},style:e.message&&p?{background:"#ebf5ff"}:null},r.a.createElement("div",{className:"wrap-message-content"},C.currentUser||3===e.message.ConversationType?null:r.a.createElement(Ce,{user:C}),C.currentUser&&e.message.Read?r.a.createElement(yt,{className:"message__read"}):C.currentUser&&!e.message.Read?r.a.createElement(Ze,{className:"message__read"}):null,r.a.createElement("div",{className:e.message.Attachments?e.message.Attachments[0]?6===e.message.Attachments[0].Type?"message__content key_message":4===e.message.Attachments[0].Type?"message__content encrypted_message":null:"message__content":null},C.currentUser?null:r.a.createElement("div",{className:"message__name"},C.NameFirst?C.NameFirst+" ":null,C.NameSecond?C.NameSecond:null),function(t){if(!t.Attachments)return t.Text?r.a.createElement("div",null,t.Text):null;if(!t.Attachments.length)return t.Text?r.a.createElement("div",{dangerouslySetInnerHTML:{__html:j(t.Text)}}):null;if(2===t.Attachments[0].Type&&t.Attachments[0].Payload.FileId){var a={};return t.Attachments[0].Payload.ImageMetadata&&(a={height:150*t.Attachments[0].Payload.ImageMetadata.Height/t.Attachments[0].Payload.ImageMetadata.Width}),r.a.createElement("div",{className:"message__img",onClick:function(){return s(!0)},style:a},r.a.createElement("img",{src:"https://".concat(e.node,":5000/api/Files/")+t.Attachments[0].Payload.FileId,alt:""}))}if(1!==t.Attachments[0].Type){if(5===t.Attachments[0].Type)return t.Attachments[0].Payload.length>0?r.a.createElement("div",{className:"forwarding_message message__content"},"\u041f\u0435\u0440\u0435\u0441\u043b\u0430\u043d\u043d\u043e\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u043e\u0442 ",r.a.createElement(ie.b,{to:"/",onClick:function(){return P()}},function(t){var a=e.users.find(function(e){return e.Id===t});if(a)return a.NameFirst||a.NameSecond?"".concat(a.NameFirst," ").concat(a.NameSecond):"\u0418\u043c\u044f \u0441\u043a\u0440\u044b\u0442\u043e"}(t.Attachments[0].Payload[0].SenderId)),r.a.createElement("div",{dangerouslySetInnerHTML:{__html:j(t.Attachments[0].Payload[0].Text)},className:"forward-message-text"}),t.Text?r.a.createElement("div",{dangerouslySetInnerHTML:{__html:j(t.Text)}}):null):r.a.createElement("div",{className:"forwarding_message message__content"},"\u041f\u0435\u0440\u0435\u0441\u043b\u0430\u043d\u043d\u043e\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u043e\u0442:",r.a.createElement("div",null,"\u041f\u0435\u0440\u0435\u0441\u043b\u0430\u043d\u043d\u043e\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u0443\u0434\u0430\u043b\u0435\u043d\u043e"));if(6===t.Attachments[0].Type){var n=null;if(t.SenderId===e.user.Id);else if(n=e.publicKeys.find(function(e){return v.a.stringify(e.KeyId)===v.a.stringify(t.Attachments[0].Payload.SignKeyId)})){var o=JSON.parse(localStorage.getItem("keysPair")).find(function(e){return v.a.stringify(e.id)===v.a.stringify(t.Attachments[0].Payload.KeyId)});o&&(_.setPublicSignKeyToRecive(ae.base64ToBuffer(n.Data)),_.setPrivateEncryptKeyToRecive(ae.base64ToBuffer(o.private)),_.decryptKeyMsg(ae.base64ToBuffer(t.Attachments[0].Payload.EncryptedData)).then(function(t){e.symmetricKeysForDecrypt.find(function(e){return e.idKey==t.idKey})||e.setSymmetricKeyForDecrypt(t)}).catch(function(e){}))}else x.makeId();return r.a.createElement("div",null,"\u0421\u0438\u043c\u043c\u0435\u0442\u0440\u0438\u0447\u043d\u044b\u0439 \u043a\u043b\u044e\u0447 \u0448\u0438\u0444\u0440\u043e\u0432\u0430\u043d\u0438\u044f")}if(4===t.Attachments[0].Type){var l=e.symmetricKeysForDecrypt.find(function(e){return e.idKey.toString()==v.a.stringify(t.Attachments[0].Payload.KeyId)}),c=!1;if(l){var i=e.publicKeys.find(function(e){return v.a.stringify(e.KeyId)==v.a.stringify(t.Attachments[0].Payload.SignKeyId)});i&&(_.setSymmetricKey("string"===typeof l.key?ae.base64ToBuffer(l.key):l.key),_.setPublicSignKeyToRecive(ae.base64ToBuffer(i.Data)),_.decryptSecretMsg(ae.base64ToBuffer(t.Attachments[0].Payload.EncryptedData)).then(function(e){0===Z.a.getMetaDataMsg(ae.base64ToBuffer(t.Attachments[0].Payload.EncryptedData)).attach.type?E(N.decode(e.msg)):(T(!0),E("\u041f\u0440\u043e\u0441\u043c\u043e\u0442\u0440 \u0444\u0430\u0439\u043b\u043e\u0432 \u0434\u043e\u0441\u0442\u0443\u043f\u0435\u043d \u0442\u043e\u043b\u044c\u043a\u043e \u0432 \u043c\u043e\u0431\u0438\u043b\u044c\u043d\u043e\u0439 \u0432\u0435\u0440\u0441\u0438\u0438 \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u044f"))}).catch(function(e){console.log(e),E("\u0417\u0430\u0448\u0438\u0444\u0440\u043e\u0432\u0430\u043d\u043d\u043e\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435")}))}else c="\u0417\u0430\u0448\u0438\u0444\u0440\u043e\u0432\u0430\u043d\u043d\u043e\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435";return r.a.createElement("div",{style:!h||S?{fontStyle:"italic"}:null},c||h||"\u0421\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u0440\u0430\u0441\u0448\u0438\u0444\u0440\u043e\u0432\u044b\u0432\u0430\u0435\u0442\u0441\u044f...")}return r.a.createElement("div",{style:{fontStyle:"italic"}},"*\u043d\u0435\u043f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u043c\u044b\u0439 \u0442\u0438\u043f \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f*")}return t.Attachments[0].Payload?r.a.createElement("div",{className:"message__content"},r.a.createElement(re.a,{type:"download",className:"download-icon"}),r.a.createElement("a",{href:"https://".concat(e.node,":5000/api/Files/")+t.Attachments[0].Payload.FileId,download:!0},t.Attachments[0].Payload.Filename),r.a.createElement("span",{dangerouslySetInnerHTML:{__html:j(t.Text)}})):void 0}(e.message)),r.a.createElement("div",{className:"message__time"},i)),e.message.Attachments&&e.message.Attachments[0]?r.a.createElement(Ne.a,{visible:o,onCancel:function(){return s(!1)},footer:null,maskClosable:!0},r.a.createElement("img",{className:"popup__img",src:"https://".concat(e.node,":5000/api/Files/").concat(e.message.Attachments[0].Payload.FileId),alt:""})):null,e.message&&p?r.a.createElement("div",{className:"message-menu"},r.a.createElement("ul",null,r.a.createElement("li",{onClick:function(){e.forwardingMessage(e.message)}},"\u041e\u0442\u0432\u0435\u0442\u0438\u0442\u044c"),r.a.createElement("li",{onClick:function(){e.forwardingMessage(e.message),e.closeDialog()}},"\u041f\u0435\u0440\u0435\u0441\u043b\u0430\u0442\u044c"))):null):null});function ht(){return(ht=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function Et(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var It=r.a.createElement("g",{transform:"translate(-198)",id:"g69"},r.a.createElement("g",{id:"_x33__22_"},r.a.createElement("g",{id:"g66"},r.a.createElement("path",{id:"path64",d:"m 544.5,99 v 495 c 0,82.021 -66.479,148.5 -148.5,148.5 -82.021,0 -148.5,-66.479 -148.5,-148.5 V 148.5 c 0,-54.673 44.327,-99 99,-99 54.673,0 99,44.327 99,99 V 594 c 0,27.349 -22.176,49.5 -49.5,49.5 -27.349,0 -49.5,-22.151 -49.5,-49.5 V 198 H 297 v 396 c 0,54.673 44.327,99 99,99 54.673,0 99,-44.327 99,-99 V 148.5 C 495,66.479 428.521,0 346.5,0 264.479,0 198,66.479 198,148.5 V 618.75 C 210.202,716.389 295.045,792 396,792 496.955,792 581.798,716.389 594,618.75 V 99 Z"})))),bt=function(e){var t=e.svgRef,a=Et(e,["svgRef"]);return r.a.createElement("svg",ht({xmlSpace:"preserve",viewBox:"0 0 396 792",height:0,width:0,y:"0px",x:"0px",id:"Capa_1",ref:t},a),It)},St=r.a.forwardRef(function(e,t){return r.a.createElement(bt,ht({svgRef:t},e))});a.p;function Tt(){return(Tt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function Ct(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var Ot=r.a.createElement("g",{transform:"translate(0,-38.25)",id:"g95"},r.a.createElement("g",{id:"send"},r.a.createElement("polygon",{id:"polygon92",points:"0,38.25 0,216.75 382.5,267.75 0,318.75 0,497.25 535.5,267.75 "}))),Nt=r.a.createElement("g",{transform:"translate(0,-38.25)",id:"g97"}),kt=r.a.createElement("g",{transform:"translate(0,-38.25)",id:"g99"}),Rt=r.a.createElement("g",{transform:"translate(0,-38.25)",id:"g101"}),_t=r.a.createElement("g",{transform:"translate(0,-38.25)",id:"g103"}),jt=r.a.createElement("g",{transform:"translate(0,-38.25)",id:"g105"}),Pt=r.a.createElement("g",{transform:"translate(0,-38.25)",id:"g107"}),At=r.a.createElement("g",{transform:"translate(0,-38.25)",id:"g109"}),Ut=r.a.createElement("g",{transform:"translate(0,-38.25)",id:"g111"}),wt=r.a.createElement("g",{transform:"translate(0,-38.25)",id:"g113"}),Mt=r.a.createElement("g",{transform:"translate(0,-38.25)",id:"g115"}),Dt=r.a.createElement("g",{transform:"translate(0,-38.25)",id:"g117"}),Kt=r.a.createElement("g",{transform:"translate(0,-38.25)",id:"g119"}),Ft=r.a.createElement("g",{transform:"translate(0,-38.25)",id:"g121"}),xt=r.a.createElement("g",{transform:"translate(0,-38.25)",id:"g123"}),qt=r.a.createElement("g",{transform:"translate(0,-38.25)",id:"g125"}),Gt=function(e){var t=e.svgRef,a=Ct(e,["svgRef"]);return r.a.createElement("svg",Tt({xmlSpace:"preserve",viewBox:"0 0 535.5 459",height:0,width:0,y:"0px",x:"0px",id:"Capa_1",ref:t},a),Ot,Nt,kt,Rt,_t,jt,Pt,At,Ut,wt,Mt,Dt,Kt,Ft,xt,qt)},Lt=r.a.forwardRef(function(e,t){return r.a.createElement(Gt,Tt({svgRef:t},e))}),Bt=(a.p,a(478)),Jt=a(35),Vt=a.n(Jt);var Ht=Object(l.b)(function(e){return{user:e.users.find(function(e){return!0===e.currentUser}),dialogs:e.dialog,forwardMessage:e.forwardMessage,node:e.node.activeNode.Domains[0],symmetricKey:e.symmetricKey}},function(e){return{forwardingMessage:function(t){return e(S(t))},upDialog:function(t){return e(function(e){return{type:"UP_DIALOG",dialog:e}}(t))}}})(function(e){var t=Object(n.useState)(""),a=Object(V.a)(t,2),o=a[0],s=a[1],l=Object(n.useState)(!1),c=Object(V.a)(l,2),i=c[0],u=c[1],d=Object(n.useState)(null),m=Object(V.a)(d,2),p=m[0],f=m[1],g=Object(n.useState)(null),y=Object(V.a)(g,2),v=y[0],h=y[1];Object(n.useEffect)(function(){p&&E()},[p]);var E=function(){if(e.forwardMessage){var t={Messages:[{Id:0,SendingTime:"",SenderId:e.user.Id,ReceiverId:e.dialog.SecondUid,ConversationId:e.dialog.ConversationId,ConversationType:e.dialog.ConversationType,Read:!1,NodesId:null,ReplyTo:null,Text:o,Attachments:[{Type:5,Payload:{MessagesGlobalId:[e.forwardMessage.GlobalId],ConversationId:e.forwardMessage.ConversationId,ConversationType:e.forwardMessage.ConversationType}}]}],RequestType:39,RequestId:x.makeId(),Type:0};x.send(t)}else if(p){var a={Messages:[{Id:0,SendingTime:"",SenderId:e.user.Id,ReceiverId:e.dialog.SecondUid,ConversationId:e.dialog.ConversationId,ConversationType:e.dialog.ConversationType,Read:!1,NodesId:null,ReplyTo:null,Text:o,Attachments:[{Type:v,Hash:null,MessageId:0,Payload:p,NodesId:null}],GlobalId:null}],RequestType:39,RequestId:x.makeId(),Type:0};x.send(a)}else if(e.dialog.isCrypto){var n=new TextEncoder,r=n.encode("qwerty"),l=te()(1),c=new Z.a(r,l);c.setSymmetricKey(ae.base64ToBuffer(e.symmetricKey.key)),c.encryptMsg(1,1,99999,n.encode(o)).then(function(t){var a={Messages:[{Id:0,SendingTime:"",SenderId:e.user.Id,ReceiverId:e.dialog.SecondUid,ConversationId:e.dialog.ConversationId,ConversationType:e.dialog.ConversationType,Read:!1,NodesId:null,ReplyTo:null,Text:null,Attachments:[{Type:4,Hash:null,MessageId:0,Payload:{KeyId:e.symmetricKey.id,SignKeyId:JSON.parse(localStorage.getItem("signKeysPair"))[JSON.parse(localStorage.getItem("signKeysPair")).length-1].id,SaveFlag:1,Lifetime:99999,EncryptedData:ae.bufferToBase64(t)},NodesId:null}],GlobalId:null}],RequestType:39,RequestId:x.makeId(),Type:0};x.send(a)}).catch(function(e){})}else{var i={Messages:[{Id:0,SendingTime:"",SenderId:e.user.Id,ReceiverId:e.dialog.SecondUid,ConversationId:e.dialog.ConversationId,ConversationType:e.dialog.ConversationType,Read:!1,NodesId:null,ReplyTo:null,Text:o,Attachments:null,GlobalId:null}],RequestType:39,RequestId:x.makeId(),Type:0};x.send(i)}s(""),e.upDialog(e.dialog),e.forwardMessage&&e.forwardingMessage(!1)};return r.a.createElement("div",{className:"new-message"},r.a.createElement(Bt.a,{showUploadList:!1,customRequest:function(t){return function(t){var a=localStorage.getItem("FileAccessToken");Vt.a.defaults.headers.FileAccessToken=a;var n=new FormData;n.append("file",t.file),Vt.a.post("https://".concat(e.node,":5000/api/Files"),n).then(function(e){200===e.status&&(u(!1),f(e.data.File.FileId))}).catch(function(e){})}(t)},beforeUpload:function(e){var t="image/jpeg"===e.type||"image/png"===e.type;return h(t?2:1),t},onChange:function(e){"uploading"!==e.file.status||u(!0)}},i?r.a.createElement(re.a,{type:"loading",className:"loading-icon"}):r.a.createElement(St,{className:"new-message__attach"})),r.a.createElement("input",{type:"text",className:"new-message__inp",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435",value:o,onChange:function(e){s(e.target.value)},onKeyDown:function(e){13===e.keyCode&&E()}}),r.a.createElement(Lt,{onClick:function(){E()},className:"new-message__send"}))}),zt=a(488),Wt=a(489);var Yt=Object(l.b)(function(e){return{messages:e.messages,forwardMessage:e.forwardMessage,users:e.users,user:e.users.find(function(e){return!0===e.currentUser}),node:e.node.activeNode.Domains[0],appFocus:e.ui.appFocus,requestsId:e.ui.requestsId,symmetricKey:e.symmetricKey,callbacks:e.callbacks,dialogs:e.dialogs}},function(e){return{openDialog:function(t){return e(T(t))},forwardingMessage:function(t){return e(S(t))},setCallbackId:function(t){return e(ke(t))},setSymmetricKey:function(t){return e(Re(t))},setSymmetricKeyForDecrypt:function(t){return e(_e(t))},toggleCryptoMode:function(t){return e(C(t))},setPublicKeys:function(t){return e(je(t))}}})(function(e){var t=Object(n.useState)(null),a=Object(V.a)(t,2),o=a[0],s=a[1],l=Object(n.useState)(!1),c=Object(V.a)(l,2),i=c[0],u=c[1],d=Object(n.useState)(!1),m=Object(V.a)(d,2),p=m[0],f=m[1],g=Object(n.useState)(null),y=Object(V.a)(g,2),v=y[0],h=y[1],E=Object(n.useState)([]),I=Object(V.a)(E,2),b=I[0],S=I[1],T=Object(n.useState)(null),C=Object(V.a)(T,2),O=C[0],N=C[1],k=Object(n.useRef)(null);Object(n.useEffect)(function(){if(o&&o.SecondUid){var e={UsersId:[o.SecondUid],RequestType:28,RequestId:x.makeId(),Type:0};x.send(e)}},[o]),Object(n.useEffect)(function(){if(i){var t=x.makeId();e.setCallbackId(t);var a=b;if(a.push(t),S(a),e.user&&o){var n={UserId:o.SecondUid,Direction:!0,KeysId:null,RequestType:105,NavigationTime:parseInt((new Date).getTime()/1e3),RequestId:t,Type:0};x.send(n)}}},[i]),Object(n.useEffect)(function(){o&&o.isCrypto!=i&&u(o.isCrypto)},[e.dialogs]);var R=function(e){Ne.a.error({title:"\u041e\u0448\u0438\u0431\u043a\u0430",icon:r.a.createElement(zt.a,null),content:e,okText:"\u041e\u043a",cancelText:"\u0417\u0430\u043a\u0440\u044b\u0442\u044c"})};return Object(n.useEffect)(function(){e.callbacks.forEach(function(t){if(b.includes(t.id)&&t.data){S([]);var a=(new TextEncoder).encode("qwerty"),n=te()(1),r=new Z.a(a,n);if(t.data.Keys[0]){var o=1e3*(t.data.Keys[0].GenerationTime+t.data.Keys[0].Lifetime);if((new Date).getTime()/1e3<o){var s=1===t.data.Keys[0].Type?t.data.Keys[0]:t.data.Keys[1];N(s);var l=JSON.parse(localStorage.getItem("signKeysPair"))[JSON.parse(localStorage.getItem("signKeysPair")).length-1],c=x.makeId();r.setPublicEncryptKeyToSend(ae.base64ToBuffer(s.Data)),r.setPrivateSignKeyToSend(ae.base64ToBuffer(l.private)),r.getSymmetricKey(1,c,99999).then(function(t){var a={key:ae.bufferToBase64(t),idKey:c};e.setSymmetricKeyForDecrypt(a),r.encryptKeyMsg(1,99999,t).then(function(a){var n={key:ae.bufferToBase64(t),id:c};e.setSymmetricKey(n)}).catch(function(t){e.toggleCryptoMode({dialog:null,isCrypto:!1}),R(t.message),console.log(t)})}).catch(function(t){e.toggleCryptoMode({dialog:null,isCrypto:!1}),R(t.message),console.log(t)})}else e.toggleCryptoMode({dialog:null,isCrypto:!1}),R(err.message)}else e.toggleCryptoMode({dialog:null,isCrypto:!1}),R(err.message)}})},[e.callbacks]),Object(n.useEffect)(function(){if(e.user&&e.dialog){var t=x.makeId(),a=JSON.parse(localStorage.getItem("keysPair")),n=JSON.parse(localStorage.getItem("signKeysPair"));e.setCallbackId(t);var r={Keys:[{KeyId:a[a.length-1].id,Data:a[a.length-1].public,Lifetime:99999,GenerationTime:parseInt((new Date).getTime()/1e3),Version:1,Type:1,UserId:e.user.Id,ChatId:null},{KeyId:n[a.length-1].id,Data:n[a.length-1].public,Lifetime:99999,GenerationTime:parseInt((new Date).getTime()/1e3),Version:1,Type:0,UserId:e.user.Id,ChatId:null}],RequestType:100,RequestId:t,Type:0};x.send(r)}},[e.user,e.dialog]),Object(n.useEffect)(function(){if(e.dialog){if(s(e.dialog),e.appFocus&&e.dialog.LastMessageId){var t={MessagesId:[e.dialog.LastMessageId],ConversationType:e.dialog.ConversationType,ConversationId:e.dialog.ConversationId,RequestId:x.makeId(),RequestType:35,Type:0};x.send(t)}k.current.onscroll=function(){if(0===k.current.scrollTop&&e.messages[0]){f(!0),document.querySelectorAll(".message")[0]&&h(document.querySelectorAll(".message")[0].getAttribute("id"));var t={ConversationType:e.dialog.ConversationType,ConversationId:e.dialog.ConversationId,NavigationMessageId:e.messages[0].GlobalId,MessagesId:null,RequestType:25,RequestId:x.makeId(),Direction:!0,Type:0};x.send(t)}}}},[e.messages,e.dialog]),Object(n.useEffect)(function(){if(o)if(k.current&&!p)setTimeout(function(){k.current.scrollTop=45e4},1),f(!1);else if(v){f(!1),h(null);var e=document.getElementById(v).offsetTop-70;k.current.scrollTop=e-20}},[o,e.messages]),Object(n.useEffect)(function(){if(e.symmetricKey){var t={Messages:[{Id:0,SendingTime:"",SenderId:e.user.Id,ReceiverId:e.dialog.SecondUid,ConversationId:e.dialog.ConversationId,ConversationType:e.dialog.ConversationType,Read:!1,NodesId:null,ReplyTo:null,Text:null,Attachments:[{Type:6,Hash:null,MessageId:0,Payload:{KeyId:O.KeyId,SignKeyId:JSON.parse(localStorage.getItem("signKeysPair"))[JSON.parse(localStorage.getItem("signKeysPair")).length-1].id,EncryptedData:e.symmetricKey.key},NodesId:null}],GlobalId:null}],RequestType:39,RequestId:x.makeId(),Type:0};x.send(t)}},[e.symmetricKey]),r.a.createElement("div",{className:"dialog"},r.a.createElement("div",{className:"dialog__messages-viewport",ref:k,onDragOver:function(e){return function(e){e.preventDefault(),k.current.classList.add("file-over")}(e)},onDragLeave:function(e){return function(e){e.preventDefault(),k.current.classList.remove("file-over")}(e)},onDrop:function(t){return function(t){if(t.preventDefault(),k.current.classList.remove("file-over"),e.isCrypto){var a=new TextEncoder,n=a.encode("qwerty"),r=te()(1),s=new Z.a(n,r);s.setSymmetricKey(ae.base64ToBuffer(e.symmetricKey.key));var l=localStorage.getItem("FileAccessToken");Vt.a.defaults.headers.FileAccessToken=l;var c=new FormData;c.append("file",t.dataTransfer.files[0]),Vt.a.post("https://".concat(e.node,":5000/api/Files"),c).then(function(t){s.encryptMsg(1,4,99999,a.encode(JSON.stringify(t.data.File))).then(function(t){var a={Messages:[{Id:0,SendingTime:"",SenderId:e.user.Id,ReceiverId:o.SecondUid,ConversationId:o.ConversationId,ConversationType:o.ConversationType,Read:!1,NodesId:null,ReplyTo:null,Text:null,Attachments:[{Type:4,Hash:null,MessageId:0,Payload:{KeyId:e.symmetricKey.id,SignKeyId:JSON.parse(localStorage.getItem("signKeysPair"))[JSON.parse(localStorage.getItem("signKeysPair")).length-1].id,SaveFlag:1,Lifetime:99999,EncryptedData:ae.bufferToBase64(t)},NodesId:null}],GlobalId:null}],RequestType:39,RequestId:x.makeId(),Type:0};x.send(a)}).catch(function(e){})}).catch(function(e){})}else{var i="image/jpeg"===t.dataTransfer.files[0].type||"image/png"===t.dataTransfer.files[0].type,u=null;u=i?2:1;var d=localStorage.getItem("FileAccessToken");Vt.a.defaults.headers.FileAccessToken=d;var m=new FormData;m.append("file",t.dataTransfer.files[0]),Vt.a.post("https://".concat(e.node,":5000/api/Files"),m).then(function(t){if(200===t.status){var a={Messages:[{Id:0,SendingTime:"",SenderId:e.user.Id,ReceiverId:o.SecondUid,ConversationId:o.ConversationId,ConversationType:o.ConversationType,Read:!1,NodesId:null,ReplyTo:null,Text:"",Attachments:[{Type:u,Hash:null,MessageId:0,Payload:t.data.File.FileId,NodesId:null}],GlobalId:null}],RequestType:39,RequestId:x.makeId(),Type:0};x.send(a)}}).catch(function(e){})}}(t)}},r.a.createElement("div",{className:"dialog__messages"},o?e.messages.filter(function(e){return e.ConversationId===parseInt(o.ConversationId||o.ChannelId)&&e.ConversationType===o.ConversationType}).map(function(e){return r.a.createElement(vt,{key:x.makeId(),message:e})}):null)),e.forwardMessage?r.a.createElement("div",{className:"reply-message"},r.a.createElement(Wt.a,{onClick:function(){e.forwardingMessage(!1)},style:{color:"#1890FF",paddingRight:10,cursor:"pointer"}}),"\u041e\u0442\u0432\u0435\u0442 \u043d\u0430:"," ".concat(e.forwardMessage.Text)):null,e.dialog?"channel"===e.dialog.type&&e.dialog.fake?r.a.createElement(K.a,{type:"primary",size:"large",onClick:function(){var t={ChannelsId:[o.ChannelId],UsersId:[e.user.Id],RequestType:48,RequestId:x.makeId(),Type:0};x.send(t)}},"\u0412\u0441\u0442\u0443\u043f\u0438\u0442\u044c"):3!==e.dialog.ConversationType?r.a.createElement(Ht,Object.assign({},e,{dialog:o})):null:null)});var Zt=Object(l.b)(function(e){return{dialogs:e.dialogs}},function(e){return{openDialog:function(t){return e(T(t))}}})(function(e){var t=Object(n.useState)(null),a=Object(V.a)(t,2),o=a[0],s=a[1];return Object(n.useEffect)(function(){e.dialogs.forEach(function(e){e.active&&s(e)})},[e.dialogs]),Object(n.useEffect)(function(){if(o&&!o.messagesRecieved){var e={ConversationType:"channel"===o.type?3:o.ConversationType,ConversationId:o.ConversationId?o.ConversationId:o.ChannelId,NavigationMessageTime:null,MessageId:null,RequestType:25,RequestId:x.makeId(),Type:0};x.send(e)}},[o]),r.a.createElement("div",{className:"dialog-container",style:ue.getActiveDialog(e.dialogs)?{zIndex:2}:null},ue.getActiveDialog(e.dialogs)?r.a.createElement(r.a.Fragment,null,r.a.createElement(Oe,e),r.a.createElement(Yt,{dialog:o})):null)});var $t=Object(l.b)(function(e){return{profile:e.ui.profile,users:e.users,chats:e.chats,node:e.node.activeNode.Domains[0],contacts:e.contacts}},function(e){return{openProfile:function(t){return e(N(t))},openDialog:function(t){return e(T(t))}}})(function(e){var t=Object(n.useState)(!1),a=Object(V.a)(t,2),o=a[0],s=a[1],l=Object(n.useState)(null),c=Object(V.a)(l,2),i=c[0],u=c[1],d=Object(n.useState)(null),m=Object(V.a)(d,2),p=m[0],f=m[1];Object(n.useEffect)(function(){if(e.profile)if(1===e.profile.ConversationType){var t=ue.getUserById(e.profile.SecondUid,e.users);t&&(u(t),s(!0))}else if(e.profile.NameFirst)u(e.profile),s(!0);else if(e.profile.Users)u(e.profile),s(!0);else if(2===e.profile.ConversationType){var a={RequestType:45,ChatsId:[e.profile.ConversationId],RequestId:x.makeId(),Type:0};x.send(a)}},[e.profile]),Object(n.useEffect)(function(){if(e.chats.length){u(e.chats[0]),s(!0);var t=[];if(e.chats[0].Users.map(function(a){ue.getUserById(a.UserId,e.users)||t.push(a.UserId)}),t.length){var a={UsersId:[].concat(t),RequestType:28,RequestId:x.makeId(),Type:0};x.send(a)}}},[e.chats]);var g=function(){s(!1),e.openProfile(null)};return r.a.createElement(Ne.a,{visible:o,onCancel:g,footer:null,maskClosable:!0},i?r.a.createElement("div",{className:"profile"},p?r.a.createElement("div",{onClick:function(){e.openProfile(p),f(null)}},"\u041d\u0430\u0437\u0430\u0434"):null,r.a.createElement(Ce,{user:i}),r.a.createElement("div",{className:"profile__name"},ue.getUserName(i,e.contacts.users)),i.Phones&&i.Phones.length>0?r.a.createElement("div",{className:"profile__info"},r.a.createElement("div",{className:"profile__info_name"},"\u0422\u0435\u043b\u0435\u0444\u043e\u043d"),r.a.createElement("div",{className:"profile__info_value"},i.Phones[0].FullNumber)):null,i.Emails?r.a.createElement("div",{className:"profile__info"},r.a.createElement("div",{className:"profile__info_name"},"Email"),r.a.createElement("div",{className:"profile__info_value"},r.a.createElement("a",{href:"mailto:".concat(i.Emails[0])},i.Emails[0]))):null,i.About?r.a.createElement("div",{className:"profile__info"},r.a.createElement("div",{className:"profile__info_name"},"\u041e \u0441\u0435\u0431\u0435"),r.a.createElement("div",{className:"profile__info_value"},i.About)):null,i.Users?r.a.createElement("div",{className:"profile__info"},r.a.createElement("div",{className:"profile__info_name"},"\u0423\u0447\u0430\u0441\u0442\u043d\u0438\u043a\u0438"),r.a.createElement("div",{className:"profile__info_users"},e.chats[0].Users.map(function(t){var a=ue.getUserById(t.UserId,e.users);if(a){var n=null;return a.NameFirst&&(n=a.NameFirst),a.NameSecond&&(n=n+" "+a.NameSecond),r.a.createElement("div",{key:a.Id,className:"profile__info_user",onClick:function(){var t;t=a,f(i),e.openProfile(t)}},a.Photo?r.a.createElement("div",{style:{width:"50px",height:"50px",backgroundSize:"cover",backgroundPosition:"center center",backgroundImage:"url(https://".concat(e.node,":5000/api/Files/").concat(a.Photo,")"),backgroundRepeat:"no-repeat",borderRadius:100,margin:"0 auto",marginTop:"10px"}}):r.a.createElement("div",{className:"profile__info_ava"},ue.getUserInitials(a)),n||"\u0418\u043c\u044f \u0441\u043a\u0440\u044b\u0442\u043e")}}))):null,e.profile?r.a.createElement(ie.b,{to:"/",onClick:function(){var t={};t.data=e.profile,"dialog"===e.profile.type?t.type="dialog":t.type="user",e.openDialog(t),g()}},r.a.createElement("div",{className:"profile__open_chat"},"\u041e\u0442\u043a\u0440\u044b\u0442\u044c \u0447\u0430\u0442")):null):null)}),Qt=a(477);var Xt=Object(l.b)(function(e){return{createChatModal:e.ui.modals.createChatModal,node:e.node.activeNode.Domains[0],contacts:e.contacts.users}},function(e){return{toggleModal:function(t){return e(R(t))}}})(function(e){var t=Object(n.useState)(null),a=Object(V.a)(t,2),o=a[0],s=a[1],l=Object(n.useState)(!1),c=Object(V.a)(l,2),i=c[0],d=c[1],m=Object(n.useState)(!1),p=Object(V.a)(m,2),f=p[0],g=p[1],y=Object(n.useState)(!1),v=Object(V.a)(y,2),h=v[0],E=v[1],I=Object(n.useState)(!1),b=Object(V.a)(I,2),S=b[0],T=b[1],C=Object(n.useState)(null),O=Object(V.a)(C,2),N=O[0],k=O[1],R=Object(n.useState)([]),_=Object(V.a)(R,2),j=_[0],P=_[1],A=Object(n.useState)(!1),U=Object(V.a)(A,2),w=U[0],M=U[1];return r.a.createElement(Ne.a,{visible:e.createChatModal,onCancel:function(){return e.toggleModal("createChatModal")},title:"\u0421\u043e\u0437\u0434\u0430\u043d\u0438\u0435 \u0433\u0440\u0443\u043f\u043f\u043e\u0432\u043e\u0433\u043e \u0447\u0430\u0442\u0430",className:"create-chat-modal",footer:null,maskClosable:!0},w?r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"modal_back",onClick:function(){return M(!1)}},r.a.createElement(re.a,{type:"arrow-left"})),w?r.a.createElement("div",{className:"wrap_contacts"},e.contacts.map(function(e){if(e){var t=null;return e.Name?t=e.Name:(e.ContactUser.NameFirst||e.ContactUser.NameSecond)&&(t="".concat(e.ContactUser.NameFirst," ").concat(e.ContactUser.NameSecond)),r.a.createElement("div",{key:e.ContactId,className:j.includes(e.ContactUserId)?"contacts contacts-active":"contacts",onClick:function(){!function(e){var t=Object(u.a)(j);if(j.includes(e)){var a=t.indexOf(e);t.splice(a,1),P(t)}else t.push(e),P(t)}(e.ContactUserId)}},r.a.createElement(Ce,{user:e.ContactUser}),t||"\u0418\u043c\u044f \u0441\u043a\u0440\u044b\u0442\u043e")}})):null):r.a.createElement(r.a.Fragment,null,r.a.createElement(Bt.a,{listType:"picture-card",className:"avatar-uploader",showUploadList:!1,customRequest:function(t){return function(t){var a=localStorage.getItem("FileAccessToken");Vt.a.defaults.headers.FileAccessToken=a;var n=new FormData;n.append("file",t.file),Vt.a.post("https://".concat(e.node,":5000/api/Files"),n).then(function(e){200===e.status&&(T(!1),k(e.data.File.FileId))}).catch(function(e){})}(t)},beforeUpload:function(e){var t="image/jpeg"===e.type||"image/png"===e.type;return t||H.a.error("\u041f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442\u0441\u044f \u0442\u043e\u043b\u044c\u043a\u043e \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0430 JPG/PNG \u0444\u0430\u0439\u043b\u043e\u0432!"),t},onChange:function(e){"uploading"!==e.file.status||T(!0)}},S?r.a.createElement(re.a,{type:"loading",className:"loading-icon"}):N?r.a.createElement("img",{src:"https://".concat(e.node,":5000/api/Files/").concat(N),alt:"avatar",style:{width:"100%"}}):r.a.createElement(r.a.Fragment,null,r.a.createElement("p",{className:"ant-upload-drag-icon"},r.a.createElement(re.a,{type:"inbox",style:{fontSize:"40px",color:"#1890ff",marginTop:"15px"}})),r.a.createElement("p",{className:"ant-upload-text"},"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c ",r.a.createElement("br",null)," \u0430\u0432\u0430\u0442\u0430\u0440"))),r.a.createElement(Qt.a,null),r.a.createElement(z.a.Item,{validateStatus:i?"error":"",help:!!i&&"\u042d\u0442\u043e \u043f\u043e\u043b\u0435 \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e \u0434\u043b\u044f \u0437\u0430\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f"},r.a.createElement(W.a,{placeholder:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u0447\u0430\u0442\u0430",onChange:function(e){return t=e.target.value,s(t),d(!1),void(t.length<1&&d(!0));var t}})),r.a.createElement(Qt.a,null),r.a.createElement("div",{className:"switch-label"},r.a.createElement("div",null,"\u041f\u0440\u0438\u0432\u0430\u0442\u043d\u044b\u0439 \u0447\u0430\u0442"),r.a.createElement(Te.a,{checked:f,onChange:function(e){return g(e)}})),r.a.createElement(Qt.a,null),r.a.createElement("div",{className:"switch-label"},r.a.createElement("div",null,"\u0421\u043e\u0437\u0434\u0430\u0442\u044c \u043a\u0430\u043d\u0430\u043b"),r.a.createElement(Te.a,{checked:h,onChange:function(e){return E(e)}})),r.a.createElement(Qt.a,null),r.a.createElement(K.a,{type:"normal",block:!0,icon:"usergroup-add",onClick:function(){return M(!w)}},"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439")),r.a.createElement(Qt.a,null),r.a.createElement(K.a,{type:"primary",block:!0,onClick:function(){return function(){if(o){var t=j.map(function(e){return{userId:e}}),a={Chats:[{Id:0,Name:o,Tag:0,Photo:N,About:null,NodesId:null,Visible:null,Public:null,Security:null,Type:1,Users:t}],RequestId:x.makeId(),RequestType:36,Type:0};x.send(a),e.toggleModal("createChatModal")}else d(!0)}()}},"\u0421\u043e\u0437\u0434\u0430\u0442\u044c"))}),ea=a(479),ta=new(function(){function e(){Object(_.a)(this,e)}return Object(j.a)(e,[{key:"getDialogs",value:function(){var e={NavigationMessageTime:null,RequestId:x.makeId(),RequestType:12,Type:0};x.send(e)}},{key:"getUserContacts",value:function(){var e={RequestId:x.makeId(),RequestType:64,Type:0};x.send(e)}},{key:"getUsers",value:function(e){var t={RequestId:x.makeId(),RequestType:28,Type:0,UsersId:e};x.send(t)}},{key:"getUserGroups",value:function(){var e={RequestId:x.makeId(),RequestType:61,Type:0};x.send(e)}},{key:"getGroupContacts",value:function(e){var t={RequestId:x.makeId(),RequestType:60,Type:0,GroupId:e};x.send(t)}},{key:"editUser",value:function(e){var t={User:{NameFirst:e.NameFirst,NameSecond:e.NameSecond,About:e.About,Photo:e.Photo,Country:null,Language:null,Visible:null,Privacy:e.Privacy,Security:null,Phones:null,Emails:null},RequestId:x.makeId(),RequestType:10,Type:0};x.send(t)}},{key:"createChat",value:function(e){x.send({Chats:[{Id:0,Name:"NEW CHAT",Tag:0,Photo:null,About:"about chat",NodesId:null,Visible:null,Public:null,Security:null,Type:1,Users:[{ChatId:0,UserId:1,Deleted:!1,Banned:!1,UserRole:0,UserInfo:null},{ChatId:0,UserId:2,Deleted:!1,Banned:!1,UserRole:0,UserInfo:null}]}],RequestId:0x2f01c9145555a000,RequestType:36,Type:0})}}]),e}());var aa=Object(l.b)(function(e){return{contactsModal:e.ui.modals.contactsModal,users:e.users,contacts:e.contacts.users,contactsIDs:e.contacts.usersIDs,groups:e.contacts.groups}},function(e){return{toggleModal:function(t){return e(R(t))},openDialog:function(t){return e(T(t))}}})(function(e){var t=ea.a.TabPane;Object(n.useEffect)(function(){ta.getUserContacts(),ta.getUserGroups()},[]);var a=function(){return e.contacts.map(function(t){var a=ue.getUserName(t,e.contacts);if(t.ContactUser)return r.a.createElement("div",{className:"contact",key:t.ContactId,onClick:function(){return function(t){var a={};a.data=t,a.type="user",e.openDialog(a),e.toggleModal("close")}(t.ContactUser)}},r.a.createElement(Ce,{user:t.ContactUser}),r.a.createElement("div",{className:"name"},a))})};return r.a.createElement(Ne.a,{visible:e.contactsModal,onCancel:function(){return e.toggleModal("contactsModal")},title:"\u041a\u043e\u043d\u0442\u0430\u043a\u0442\u044b",footer:null,maskClosable:!0,className:"contacts"},r.a.createElement(ea.a,{defaultActiveKey:"1",onChange:function(e){"all"===e?ta.getUserContacts():ta.getGroupContacts(e)}},r.a.createElement(t,{tab:"\u0412\u0441\u0435",key:"all"},a()),e.groups.map(function(e){return r.a.createElement(t,{tab:e.Title,key:e.GroupId},a())})))});var na=a(482).a.Text;var ra=Object(l.b)(function(e){return{contactsGroupsModal:e.ui.modals.contactsGroupsModal,users:e.users,contacts:e.contacts,contactsIDs:e.contacts.usersIDs,groups:e.contacts.groups}},function(e){return{toggleModal:function(t){return e(R(t))},removeContactFromGroup:function(t){return e({type:"REMOVE_CONTACT_FROM_GROUP",payload:t})},removeGroup:function(t){return e({type:"REMOVE_GROUP",groupId:t})}}})(function(e){var t=Object(n.useState)(null),a=Object(V.a)(t,2),o=a[0],s=a[1],l=Object(n.useState)(!1),c=Object(V.a)(l,2),i=c[0],d=c[1],m=Object(n.useState)(!1),p=Object(V.a)(m,2),f=p[0],g=p[1],y=Object(n.useState)(!1),v=Object(V.a)(y,2),h=v[0],E=v[1],I=Object(n.useState)([]),b=Object(V.a)(I,2),S=b[0],T=b[1],C=Object(n.useState)(!1),O=Object(V.a)(C,2),N=O[0],k=O[1],R=function(e){s(e),d(!1),e.length<1&&d(!0)},_=function(t){var a=e.groups.find(function(e){return e.GroupId===t});a&&g(a)},j=function(){return(f?e.contacts.users.map(function(e){if(!e.GroupsId.includes(f.GroupId))return e}):e.contacts.users).map(function(t){if(t){var a=ue.getUserName(t,e.contacts.users);return r.a.createElement("div",{key:t.ContactId,className:S.includes(t.ContactUserId)?"contacts contacts-active":"contacts",onClick:function(){!function(e){var t=Object(u.a)(S);if(S.includes(e)){var a=t.indexOf(e);t.splice(a,1),T(t)}else t.push(e),T(t)}(t.ContactUserId)}},r.a.createElement(Ce,{user:t.ContactUser}),a)}})};return r.a.createElement(Ne.a,{visible:e.contactsGroupsModal,onCancel:function(){return s(null),d(!1),g(!1),E(!1),T([]),k(!1),void e.toggleModal("contactsGroupsModal")},title:"\u0413\u0440\u0443\u043f\u043f\u044b \u043a\u043e\u043d\u0442\u0430\u043a\u0442\u043e\u0432",footer:null,maskClosable:!0,className:"contacts create-chat-modal"},"step1"===h?r.a.createElement("div",{className:"content"},r.a.createElement("div",{className:"modal_back",onClick:function(){return E(!1)}},r.a.createElement(re.a,{type:"arrow-left"})),r.a.createElement(z.a.Item,{validateStatus:i?"error":"",help:!!i&&"\u042d\u0442\u043e \u043f\u043e\u043b\u0435 \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e \u0434\u043b\u044f \u0437\u0430\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f"},r.a.createElement(W.a,{placeholder:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u0433\u0440\u0443\u043f\u043f\u044b",onChange:function(e){return R(e.target.value)}})),r.a.createElement(Qt.a,null),r.a.createElement(K.a,{type:"primary",block:!0,onClick:function(){o?E("step2"):d(!0)}},"\u0414\u0430\u043b\u0435\u0435")):"step2"===h?r.a.createElement("div",{className:"content"},r.a.createElement("div",{className:"modal_back",onClick:function(){return E("step1")}},r.a.createElement(re.a,{type:"arrow-left"})),r.a.createElement(na,{strong:!0},"\u0414\u043e\u0431\u0430\u0432\u044c\u0442\u0435 \u0443\u0447\u0430\u0441\u0442\u043d\u0438\u043a\u043e\u0432"),r.a.createElement("div",{className:"wrap_contacts"},j()),r.a.createElement(Qt.a,null),r.a.createElement(K.a,{type:"primary",block:!0,onClick:function(){return function(){var t={Group:{GroupId:f?f.GroupId:null,Title:o||f.Title,UsersId:S},RequestId:x.makeId(),RequestType:56,Type:0};x.send(t),e.toggleModal("contactsGroupsModal")}()}},"\u0421\u043e\u0437\u0434\u0430\u0442\u044c \u0433\u0440\u0443\u043f\u043f\u0443")):f?r.a.createElement("div",{className:"content"},N?r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"modal_back",onClick:function(){return k(!1)}},r.a.createElement(re.a,{type:"arrow-left"})),r.a.createElement(na,{strong:!0},"\u0414\u043e\u0431\u0430\u0432\u044c\u0442\u0435 \u0443\u0447\u0430\u0441\u0442\u043d\u0438\u043a\u043e\u0432"),r.a.createElement("div",{className:"wrap_contacts"},j()),r.a.createElement(Qt.a,null)):r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"modal_back",onClick:function(){return g(!1)}},r.a.createElement(re.a,{type:"arrow-left"})),r.a.createElement(na,{strong:!0},"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435:"),r.a.createElement(W.a,{defaultValue:o||f.Title,onChange:function(e){return R(e.target.value)}}),r.a.createElement(Qt.a,null),r.a.createElement(na,{strong:!0},"\u0423\u0447\u0430\u0441\u0442\u043d\u0438\u043a\u0438:"),r.a.createElement("div",{className:"wrap_contacts"},e.contacts.users.map(function(t){if(t.ContactUser&&t.GroupsId.includes(f.GroupId)){var a=null;return t.ContactUser.NameFirst&&(a=t.ContactUser.NameFirst),t.ContactUser.NameSecond&&(a=a+" "+t.ContactUser.NameSecond),r.a.createElement("div",{key:t.ContactId,className:"contacts"},r.a.createElement(r.a.Fragment,null,r.a.createElement(Ce,{user:t.ContactUser}),a||"\u0418\u043c\u044f \u0441\u043a\u0440\u044b\u0442\u043e"),r.a.createElement(K.a,{className:"remove-user",type:"danger",shape:"circle",icon:"user-delete",onClick:function(){return function(t){var a={UsersId:[t.Id],GroupId:f.GroupId,RequestId:x.makeId(),RequestType:59,Type:0};x.send(a),e.removeContactFromGroup({userId:t.Id,groupId:f.GroupId})}(t.ContactUser)}}))}})),r.a.createElement(Qt.a,null),r.a.createElement(K.a,{type:"normal",block:!0,icon:"usergroup-add",onClick:function(){return k(!N)}},"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439"),r.a.createElement(Qt.a,null)),r.a.createElement(K.a,{type:"primary",block:!0,onClick:function(){return function(){var t={UsersId:S,GroupId:f.GroupId,RequestId:x.makeId(),RequestType:58,Type:0};x.send(t),e.toggleModal("contactsGroupsModal")}()}},"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c")):r.a.createElement(r.a.Fragment,null,e.groups.map(function(t){return r.a.createElement("div",{className:"contact",key:t.GroupId},r.a.createElement("div",{className:"name",onClick:function(){return _(t.GroupId)}},t.Title),r.a.createElement(K.a,{className:"remove-user",type:"danger",shape:"circle",icon:"close",onClick:function(){return function(t){var a={GroupsId:[t],RequestId:x.makeId(),RequestType:57,Type:0};x.send(a),e.removeGroup(t)}(t.GroupId)}}))}),r.a.createElement("div",{className:"content"},r.a.createElement(K.a,{type:"primary",block:!0,onClick:function(){return E("step1")}},"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0433\u0440\u0443\u043f\u043f\u0443"))))}),oa=a(484);var sa=Object(l.b)(function(e){return{settingsModal:e.ui.modals.settingsModal,user:e.users.find(function(e){return!0===e.currentUser}),node:e.node.activeNode.Domains[0]}},function(e){return{toggleModal:function(t){return e(R(t))}}})(function(e){var t=Object(n.useState)(!1),a=Object(V.a)(t,2),o=a[0],s=a[1],l=Object(n.useState)(!1),c=Object(V.a)(l,2),i=c[0],u=c[1],d=Object(n.useState)(""),m=Object(V.a)(d,2),p=m[0],f=m[1],g=Object(n.useState)(""),y=Object(V.a)(g,2),v=y[0],h=y[1],E=Object(n.useState)(""),I=Object(V.a)(E,2),b=I[0],S=I[1],T=Object(n.useState)(!1),C=Object(V.a)(T,2),O=C[0],N=C[1],k=Object(n.useState)(!1),R=Object(V.a)(k,2),_=R[0],j=R[1],P=Object(n.useState)(!1),A=Object(V.a)(P,2),U=A[0],w=A[1],M=Object(n.useState)(!1),D=Object(V.a)(M,2),F=D[0],x=D[1],q=Object(n.useState)(!1),G=Object(V.a)(q,2),L=G[0],B=G[1],J=Object(n.useState)(!1),z=Object(V.a)(J,2),Y=z[0],Z=z[1];Object(n.useEffect)(function(){e.user&&(f(e.user.NameFirst),h(e.user.NameSecond),S(e.user.About),u(e.user.Photo),j(e.user.Visible[0][1]),w(e.user.Visible[0][2]),x(e.user.Visible[0][14]),B(e.user.Visible[0][15]),Z(e.user.Visible[0][17]))},[e.user]);var $=r.a.createElement("div",null,r.a.createElement(re.a,{type:o?"loading":"plus"}),r.a.createElement("div",{className:"ant-upload-text"},"Upload"));return r.a.createElement(Ne.a,{visible:e.settingsModal,onCancel:function(){return e.toggleModal("settingsModal")},title:"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043f\u0440\u043e\u0444\u0438\u043b\u044c",footer:null,maskClosable:!0,className:"contacts"},e.user?r.a.createElement("div",{className:"content settings"},O?r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"modal_back",onClick:function(){return N(!1)}},r.a.createElement(re.a,{type:"arrow-left"})),r.a.createElement("div",{className:"switch-label"},r.a.createElement("div",null,"\u0418\u043c\u044f, \u0442\u044d\u0433"),r.a.createElement(Te.a,{checked:_,onChange:function(e){return j(e)}})),r.a.createElement(Qt.a,null),r.a.createElement("div",{className:"switch-label"},r.a.createElement("div",null,"\u041e\u043d\u043b\u0430\u0439\u043d \u0441\u0442\u0430\u0442\u0443\u0441"),r.a.createElement(Te.a,{checked:F,onChange:function(e){return x(e)}})),r.a.createElement(Qt.a,null),r.a.createElement("div",{className:"switch-label"},r.a.createElement("div",null,"\u0422\u0435\u043b\u0435\u0444\u043e\u043d"),r.a.createElement(Te.a,{checked:L,onChange:function(e){return B(e)}})),r.a.createElement(Qt.a,null),r.a.createElement("div",{className:"switch-label"},r.a.createElement("div",null,"Email"),r.a.createElement(Te.a,{checked:Y,onChange:function(e){return Z(e)}})),r.a.createElement(Qt.a,null),r.a.createElement("div",{className:"switch-label"},r.a.createElement("div",null,"\u0424\u043e\u0442\u043e, \u043e \u0441\u0435\u0431\u0435"),r.a.createElement(Te.a,{checked:U,onChange:function(e){return w(e)}}))):r.a.createElement(r.a.Fragment,null,r.a.createElement(Bt.a,{listType:"picture-card",className:"avatar-uploader",showUploadList:!1,customRequest:function(t){return function(t){var a=localStorage.getItem("FileAccessToken");Vt.a.defaults.headers.FileAccessToken=a;var n=new FormData;n.append("file",t.file),Vt.a.post("https://".concat(e.node,":5000/api/Files"),n).then(function(e){200===e.status&&(s(!1),u(e.data.File.FileId))}).catch(function(e){})}(t)},beforeUpload:function(e){var t="image/jpeg"===e.type||"image/png"===e.type;return t||H.a.error("\u041f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442\u0441\u044f \u0442\u043e\u043b\u044c\u043a\u043e \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0430 JPG/PNG \u0444\u0430\u0439\u043b\u043e\u0432!"),t},onChange:function(e){"uploading"!==e.file.status||s(!0)}},o?r.a.createElement(re.a,{type:"loading",className:"loading-icon"}):null,i?r.a.createElement("img",{src:"https://".concat(e.node,":5000/api/Files/").concat(i),alt:"avatar",style:{width:"100%"}}):e.user.Photo?r.a.createElement(Ce,{user:e.user}):$),r.a.createElement(Qt.a,null),r.a.createElement(W.a,{value:v,onChange:function(e){return h(e.target.value)},placeholder:"\u0424\u0430\u043c\u0438\u043b\u0438\u044f"}),r.a.createElement(Qt.a,null),r.a.createElement(W.a,{value:p,onChange:function(e){return f(e.target.value)},placeholder:"\u0418\u043c\u044f"}),r.a.createElement(Qt.a,null),r.a.createElement(W.a,{value:b,onChange:function(e){return S(e.target.value)},placeholder:"\u041e \u0441\u0435\u0431\u0435"}),r.a.createElement(Qt.a,null),r.a.createElement(W.a,{addonBefore:"+",defaultValue:e.user.Phones[0]?e.user.Phones[0].FullNumber.replace("+",""):"",placeholder:"\u0422\u0435\u043b\u0435\u0444\u043e\u043d",disabled:!0}),r.a.createElement(Qt.a,null),r.a.createElement(W.a,{defaultValue:e.user.Emails[0],placeholder:"Email",disabled:!0}),r.a.createElement(Qt.a,null),r.a.createElement(K.a,{type:"link",onClick:function(){N(!0)}},"\u041d\u0430\u0441\u0442\u0440\u043e\u043a\u0438 \u043f\u0440\u0438\u0432\u0430\u0442\u043d\u043e\u0441\u0442\u0438")),r.a.createElement(Qt.a,null),r.a.createElement(K.a,{type:"primary",block:!0,onClick:function(){return function(){var t=e.user.Visible[0];t[1]=_,t[2]=U,t[14]=F,t[15]=L,t[17]=Y;var a={NameFirst:p,NameSecond:v,About:b,Photo:i,Privacy:t};ta.editUser(a)}()}},"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c")):null)});var la=Object(l.b)(function(e){return{dialogs:e.dialogs,showDrawer:e.ui.showDrawer,user:e.users.find(function(e){return!0===e.currentUser}),node:e.node.activeNode.Domains[0]}},function(e){return{toggleDrawer:function(){return e(k())},toggleModal:function(t){return e(R(t))}}})(function(e){return r.a.createElement(ie.a,null,r.a.createElement("div",{className:"page"},r.a.createElement("div",{className:"page__content"},r.a.createElement(oa.a,{visible:e.showDrawer,placement:"left",closable:!0,onClose:function(){return e.toggleDrawer()},width:"366"},e.user?r.a.createElement("div",{className:"drawer-user"},r.a.createElement("div",{className:"drawer-user__ava"},e.user.Photo?r.a.createElement("div",{style:{width:"100%",height:"100%",backgroundSize:"cover",backgroundPosition:"center center",backgroundImage:"url(https://".concat(e.node,":5000/api/Files/").concat(e.user.Photo,")"),backgroundRepeat:"no-repeat"}}):r.a.createElement("div",{className:"drawer-user__photo-default avatar-default"},ue.getUserInitials(e.user))),r.a.createElement("div",{className:"drawer-user__name"},e.user.NameFirst+" "+e.user.NameSecond)):null,r.a.createElement("ul",{className:"menu"},r.a.createElement("li",{onClick:function(){return e.toggleModal("createChatModal")}},"\u0421\u043e\u0437\u0434\u0430\u0442\u044c \u0433\u0440\u0443\u043f\u043f\u043e\u0432\u043e\u0439 \u0447\u0430\u0442"),r.a.createElement("li",{onClick:function(){return e.toggleModal("contactsModal")}},"\u041a\u043e\u043d\u0442\u0430\u043a\u0442\u044b"),r.a.createElement("li",{onClick:function(){return e.toggleModal("contactsGroupsModal")}},"\u0413\u0440\u0443\u043f\u043f\u044b \u043a\u043e\u043d\u0442\u0430\u043a\u0442\u043e\u0432"),r.a.createElement("li",{onClick:function(){return e.toggleModal("settingsModal")}},"\u041d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438"),r.a.createElement("li",{onClick:function(){var e={Full:!1,AccessToken:localStorage.getItem("AccessToken"),RequestType:34,RequestId:x.makeId(),Type:0};x.send(e),localStorage.removeItem("AccessToken"),localStorage.removeItem("FileAccessToken"),localStorage.removeItem("RefreshToken"),localStorage.removeItem("User"),localStorage.removeItem("keysPair"),localStorage.removeItem("signKeysPair"),window.location.replace("/")}},"\u0412\u044b\u0445\u043e\u0434")),r.a.createElement("div",{className:"app-version"},"v0.1.13")),r.a.createElement(r.a.Fragment,null,r.a.createElement(he,e),r.a.createElement(Zt,null)))),r.a.createElement($t,null),r.a.createElement(Xt,null),r.a.createElement(aa,null),r.a.createElement(ra,null),r.a.createElement(sa,null))});var ca=Object(l.b)(function(e){return{users:e.users}},function(e){return{dialogsReceived:function(t){return e(I(t))},chatsReceived:function(t){return e(function(e){return{type:"CHATS_RECEIVED",chats:e}}(t))},chatsUsersReceived:function(t){return e(function(e){return{type:"CHATS_USERS_RECEIVED",chatsUsers:e}}(t))},openDialog:function(t){return e(T(t))},userReceived:function(t){return e(O(t))},messagesReceived:function(t){return e(b(t))},readMessages:function(t){return e(function(e){return{type:"READ_MESSAGES",data:e}}(t))},setAuth:function(t){return e(se(t))},searchResultReceived:function(t){return e({type:"SEARCH_RESULT_RECEIVED",searchResult:t})},setContactUsersIDs:function(t){return e(function(e){return{type:"SET_CONTACT_USERS_IDS",usersIDs:e}}(t))},userGroupsReceived:function(t){return e(function(e){return{type:"USER_GROUPS_RECEIVED",groups:e}}(t))},setContacts:function(t){return e(function(e){return{type:"SET_CONTACTS",contacts:e}}(t))},toggleModal:function(t){return e(R(t))},toggleDrawer:function(t){return e(k(t))},setSymmetricKey:function(t){return e(Re(t))},setPublicKeys:function(t){return e(je(t))},setCallbackData:function(t){return e({type:"SET_CALLBACK_DATA",response:t})},socketReconnect:function(t){return e(function(e){return{type:"SOCKET_RECONNECT",data:e}}(t))}}})(function(e){return Object(n.useEffect)(function(){var t;x.onMessage=function(a){if(a.ErrorCode&&0!=a.ErrorCode&&38!=a.ErrorCode&&18!=a.ErrorCode&&15!=a.ErrorCode&&24!=a.ErrorCode)H.a.warning(a.Message),5===a.ErrorCode&&(localStorage.removeItem("FileAccessToken"),localStorage.removeItem("AccessToken"),localStorage.removeItem("RefreshToken"),localStorage.removeItem("User"),localStorage.removeItem("node"),localStorage.removeItem("keysPair"),localStorage.removeItem("signKeysPair"),window.location.reload());else if(19===a.ResponseType&&999===a.RequestId)clearInterval(t),e.socketReconnect(!1),t=setInterval(function(){x.reconnect(),e.socketReconnect(!0)},5e3);else if(6===a.ResponseType){var n={RequestId:x.makeId(),RequestType:27,Type:0};x.send(n),localStorage.setItem("FileAccessToken",a.FileAccessToken),localStorage.setItem("AccessToken",a.Token.AccessToken),localStorage.setItem("RefreshToken",a.Token.RefreshToken),e.setAuth("AUTH_SUCCESS")}else if(12===a.ResponseType){var r=ue.getFormatedUser([a.User]);r[0].currentUser=!0,e.userReceived(r),e.toggleModal("close"),e.toggleDrawer("close")}else if(15===a.ResponseType)e.dialogsReceived(ue.getFormatedDialogs(a.Conversations));else if(9===a.ResponseType)a.Messages.forEach(function(e){if(e.Attachments&&e.Attachments[0]&&6===e.Attachments[0].Type){var t={UserId:e.SenderId,Direction:!0,KeysId:[e.Attachments[0].Payload.SignKeyId.toString()],RequestType:105,RequestId:x.makeId(),Type:0};x.send(t)}}),e.messagesReceived({messages:ue.getFormatedMessages(a.Messages),isResponse:!0});else if(a.Message&&2===a.Type)e.messagesReceived({messages:ue.getFormatedMessages([a.Message]),isResponse:!1});else if(10===a.ResponseType&&5===a.ErrorCode)localStorage.removeItem("FileAccessToken"),localStorage.removeItem("AccessToken"),localStorage.removeItem("RefreshToken"),localStorage.removeItem("User"),localStorage.removeItem("node"),localStorage.removeItem("keysPair"),localStorage.removeItem("signKeysPair"),window.location.reload();else if(2===a.Type&&5===a.Code)e.readMessages({conversationId:a.ConversationId,conversationType:a.ConversationType});else if(0===a.ResponseType)e.userReceived(ue.getFormatedUser(a.Users));else if(2===a.ResponseType)ue.getFormatedChats(a.Chats).forEach(function(e){var t={ChatId:e.Id,NavigationUserId:null,RequestId:x.makeId(),RequestType:17,Type:0};x.send(t)}),e.chatsReceived(ue.getFormatedChats(a.Chats));else if(16===a.ResponseType)e.chatsUsersReceived(ue.getFormatedChatsUsers(a.ChatUsers));else if(18===a.ResponseType)e.setPublicKeys(a.Keys),e.setCallbackData(a);else if(21===a.ResponseType)ta.getDialogs();else if(23===a.ResponseType){var o={};a.Users.length>0&&(o.users=a.Users),a.Chats.length>0&&(o.chats=a.Chats),a.Channels.length>0&&(o.channels=a.Channels),e.searchResultReceived(o)}else if(27===a.ResponseType){var s=a.Contacts.map(function(e){return e.ContactUserId});e.setContactUsersIDs(s),e.setContacts(a.Contacts),s.length>0&&ta.getUsers(s)}else 26===a.ResponseType?e.userGroupsReceived(a.Groups):5===a.Code?e.messagesRead(a.ConversationId):8===a.Type&&a.PublicKey?ae.devicesKeysExchange(a.PublicKey,a.RequestId):2===a.Type&&12===a.Code&&ae.setKeysFromAnotherDevice(a)}},[]),null}),ia=new WebSocket("wss://testlic-1.ymess.org:5005");var ua=Object(l.b)(function(e){return{dialogs:e.dialogs,users:e.users,user:e.users.find(function(e){return!0===e.currentUser}),auth:e.auth,path:e.path.currentPath,socketReconnect:e.ui.socketReconnect}},function(e){return{dialogsReceived:function(t){return e(I(t))},openDialog:function(t){return e(T(t))},userReceived:function(t){return e(O(t))},messagesReceived:function(t){return e(b(t))},setAuth:function(t){return e(se(t))},setNodes:function(t){return e(function(e){return{type:"SET_NODES",nodes:e}}(t))},setActiveNode:function(t){return e(q(t))},setPath:function(t){return e(G(t))},setAppFocus:function(t){return e(function(e){return{type:"SET_APP_FOCUS",data:e}}(t))}}})(function(e){return Object(n.useEffect)(function(){ue.getActiveDialog(e.dialogs)?document.body.style.position="fixed":document.body.style.position="relative"},[e.dialogs]),window.addEventListener("load",function(){setTimeout(function(){window.scrollTo(0,1)},0)}),Object(n.useEffect)(function(){if("AUTH_SUCCESS"===e.auth){var t={NavigationMessageTime:null,RequestId:x.makeId(),RequestType:12,Type:0};if(x.send(t),localStorage.getItem("keysPair")){var a={PublicKey:JSON.parse(localStorage.getItem("keysPair"))[JSON.parse(localStorage.getItem("keysPair")).length-1].public,NavigationMessageTime:null,RequestId:x.makeId(),RequestType:70,Type:0};x.send(a)}}},[e.auth]),Object(n.useEffect)(function(){ia.onopen=function(){var e={RequestId:x.makeId(),RequestType:1,Type:6};ia.send(JSON.stringify(e))},ia.onmessage=function(t){var a=x.blobToJson(t.data);2===a.ResponseType&&(e.setNodes(a.Nodes),localStorage.getItem("node")&&e.setActiveNode(JSON.parse(localStorage.getItem("node"))))};var t,a=JSON.parse(localStorage.getItem("node"));a&&e.setActiveNode(a),localStorage.getItem("AccessToken")?(localStorage.getItem("User")?t={Token:{UserId:JSON.parse(localStorage.getItem("User")).Id,AccessToken:localStorage.getItem("AccessToken"),RefreshToken:localStorage.getItem("RefreshToken")},LoginType:0,UidType:1,DeviceName:ae.getDevice(),OSName:ae.getOS(),AppName:"Y messenger - WEB",RequestId:x.makeId(),RequestType:33,Type:0}:localStorage.getItem("Phone")?t={Uid:localStorage.getItem("Phone"),Token:{AccessToken:localStorage.getItem("AccessToken"),RefreshToken:localStorage.getItem("RefreshToken")},LoginType:0,UidType:0,DeviceName:ae.getDevice(),OSName:ae.getOS(),AppName:"Y messenger - WEB",RequestId:x.makeId(),RequestType:33,Type:0}:localStorage.getItem("Email"),x.start(a.Domains[0]),x.wsOnConnect=function(){x.send(t)}):e.setAuth("NO_AUTH")},[]),r.a.createElement(r.a.Fragment,null,r.a.createElement(ca,null),"CHECK_AUTH"===e.auth?r.a.createElement("div",{className:"preloader"},r.a.createElement(E.a,{size:"large"})):"AUTH_SUCCESS"===e.auth?r.a.createElement(la,null):"by-phone"===e.path||"by-email"===e.path?r.a.createElement(ce,null):"registration"===e.path?r.a.createElement(ne,null):r.a.createElement(J,null))});Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var da,ma=Object(c.d)(h,da,Object(c.a)(i.a));s.a.render(r.a.createElement(l.a,{store:ma},r.a.createElement(ie.a,null,r.a.createElement(ua,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[234,1,2]]]);
//# sourceMappingURL=main.36c14b8d.chunk.js.map