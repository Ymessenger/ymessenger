(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{212:function(e,t,a){e.exports=a.p+"static/media/logo.024bbe57.PNG"},221:function(e,t,a){e.exports=a(444)},226:function(e,t,a){},228:function(e,t,a){},444:function(t,a,n){"use strict";n.r(a);var r=n(0),o=n.n(r),s=n(6),l=n.n(s),c=(n(226),n(227),n(228),n(13)),i=n(64),u=n(202),d=n(20);var m=n(22),p={activeNode:null,allNodes:null};var f={prevPath:"",currentPath:""};var g={profile:null,search:!1,showDrawer:!1,appFocus:!0,modals:{createChatModal:!1,contactsModal:!1,contactsGroupsModal:!1,settingsModal:!1}};var v={users:[],usersIDs:[],groups:[]};var h=Object(i.c)({dialogs:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;if("DIALOGS_RECEIVED"===t.type){var a=Object(d.a)(e),n=a.find(function(e){return e.active});return a=t.dialogs,n&&a.forEach(function(e){e.ConversationId===n.ConversationId&&e.ConversationType===n.ConversationType&&(e.active=!0,e.messagesRecieved=n.messagesRecieved)}),a}if("OPEN_DIALOG"===t.type){var r=Object(d.a)(e);if("dialog"===t.payload.type)r.forEach(function(e){e.active=!1,e.ConversationId===t.payload.data.ConversationId&&e.ConversationType===t.payload.data.ConversationType&&(console.log(e),e.active=!0,e.UnreadedCount=0,e.type=t.payload.type)});else if("user"===t.payload.type)if(r.find(function(e){return e.SecondUid===t.payload.data.Id}))r.forEach(function(e){e.active=!1,e.SecondUid===t.payload.data.Id&&(e.active=!0,e.UnreadedCount=0,e.type="dialog")});else{var o={};o.ConversationId=t.payload.data.Id,o.Title=t.payload.data.NameFirst+" "+t.payload.data.NameSecond,o.Photo=t.payload.data.Photo,o.ConversationType=1,o.SecondUid=t.payload.data.Id,o.fake=!0,r.push(o),r.forEach(function(e){e.active=!1,e.ConversationId===t.payload.data.Id&&(e.active=!0,e.UnreadedCount=0,e.type=t.payload.type)})}else if("channel"===t.payload.type)r.push(t.payload.data),r.forEach(function(e){e.active=!1,e.ConversationId===t.payload.data.Id&&(e.active=!0,e.UnreadedCount=0,e.type=t.payload.type,e.fake=!0)});else if("chat"===t.payload.type)if(r.find(function(e){return e.ConversationId===t.payload.data.Id}))r.forEach(function(e){e.active=!1,e.ConversationId===t.payload.data.Id&&(e.active=!0,e.UnreadedCount=0,e.type="chat")});else{var s={};s.ConversationId=t.payload.data.Id,s.Title=t.payload.data.NameFirst+" "+t.payload.data.NameSecond,s.Photo=t.payload.data.Photo,s.ConversationType=1,s.SecondUid=t.payload.data.Id,s.fake=!0,r.push(s),r.forEach(function(e){e.active=!1,e.ConversationId===t.payload.data.Id&&(e.active=!0,e.UnreadedCount=0,e.type=t.payload.type)})}return r}if("CLOSE_DIALOG"===t.type){var l=Object(d.a)(e);return l.forEach(function(e){e.active&&(e.active=!1)}),l}if("MESSAGES_RECEIVED"===t.type){var c=Object(d.a)(e);if(t.messages.length){var i=t.messages[0].ConversationId,u=t.messages[0].conversationType;c.forEach(function(e){e.ConversationId===i&&e.ConversationType===u&&(e.messagesRecieved=!0,e.PreviewText=t.messages[0].Text,e.active||(e.UnreadedCount+=1))})}return c}return e},chats:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;if("CHATS_RECEIVED"===t.type)return Object(d.a)(e),t.chats;if("CHATS_USERS_RECEIVED"===t.type){var a=Object(d.a)(e);return a[0].Id===t.chatsUsers[0].ChatId&&(a[0].Users=t.chatsUsers),a}return e},messages:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;if("MESSAGES_RECEIVED"===t.type){var a=Object(d.a)(e);return t.messages.forEach(function(e){a.find(function(t){return t.GlobalId===e.GlobalId})||a.push(e)}),a.sort(function(e,t){var a=new Date(e.SendingTime),n=new Date(t.SendingTime);return a<n?-1:a>n?1:0})}if("READ_MESSAGES"===t.type){var n=Object(d.a)(e);return n.forEach(function(e){e.ConversationId===t.data.ConversationId&&e.ConversationType===t.data.ConversationType&&(e.Read=!0)}),n}return e},users:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;if("USER_RECEIVED"===t.type){var a=e;return t.users.length>0&&(a.find(function(e){return e.Id===t.users[0].Id})||(a=[].concat(Object(d.a)(a),Object(d.a)(t.users)))),a}return e},contacts:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:v,t=arguments.length>1?arguments[1]:void 0;if("SET_CONTACT_USERS_IDS"===t.type){var a=Object(m.a)({},e);return a.usersIDs=t.usersIDs,a}if("SET_CONTACTS"===t.type){var n=Object(m.a)({},e);return n.users=t.contacts,n}if("USER_GROUPS_RECEIVED"===t.type){var r=Object(m.a)({},e);return r.groups=t.groups,r}return e},forwardMessage:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;if("FORWARD_MESSAGE"===t.type)return t.message;return e},auth:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"CHECK_AUTH",t=arguments.length>1?arguments[1]:void 0;if("SET_AUTH"===t.type)return t.auth;return e},node:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:p,t=arguments.length>1?arguments[1]:void 0;if("SET_NODE"===t.type){var a=Object(m.a)({},e);return a.activeNode=t.node,a}if("SET_NODES"===t.type){var n=Object(m.a)({},e);return n.allNodes=t.nodes,n}return e},path:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f,t=arguments.length>1?arguments[1]:void 0;if("SET_PATH"===t.type){var a=Object(m.a)({},e);return a.prevPath=a.path,a.currentPath=t.path,a}if("PREV_PATH"===t.type){var n=Object(m.a)({},e);return n.currentPath=n.prevPath,n}return e},ui:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g,t=arguments.length>1?arguments[1]:void 0;if("OPEN_PROFILE"===t.type){var a=Object(m.a)({},e);return a.profile=t.dialog,a}if("SEARCH_START"===t.type){var n=Object(m.a)({},e);return n.search=t.text,n}if("SEARCH_END"===t.type){var r=Object(m.a)({},e);return r.search=!1,r}if("TOGGLE_DRAWER"===t.type){var o=Object(m.a)({},e);return"close"===t.name?o.showDrawer=!1:o.showDrawer=!o.showDrawer,o}if("TOGGLE_MODAL"===t.type){var s=Object(m.a)({},e);if("close"===t.name)for(var l in s.modals)s.modals[l]=!1;else s.modals[t.name]=!s.modals[t.name];return s}if("SET_APP_FOCUS"===t.type){var c=Object(m.a)({},e);return c.appFocus=t.data,c}return e},searchResult:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;if("SEARCH_RESULT_RECEIVED"===t.type)return Object(m.a)({},e),t.searchResult;if("SEARCH_END"===t.type)return Object(m.a)({},e),null;return e}});var y=n(454);function E(e){return{type:"DIALOGS_RECEIVED",dialogs:e}}function b(e){return{type:"MESSAGES_RECEIVED",messages:e}}function I(e){return{type:"FORWARD_MESSAGE",message:e}}function T(e){return{type:"OPEN_DIALOG",payload:e}}function S(e){return{type:"USER_RECEIVED",users:e}}function C(e){return{type:"OPEN_PROFILE",dialog:e}}function O(e){return{type:"TOGGLE_DRAWER",name:e}}function N(e){return{type:"TOGGLE_MODAL",name:e}}var k=n(47),R=n(48),j=n(76),_=n(74),U=n(77),A=n(460),w=n(450),P=n(451),M=n(39),D=n(462),F=n(9),x=new(function(){function e(){Object(k.a)(this,e)}return Object(R.a)(e,[{key:"start",value:function(e){var t=this;this.webSocket=new WebSocket("wss://".concat(e,":5000")),this.webSocket.onopen=function(){console.log("\u0421\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435 \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u043e"),t.wsOnConnect()},this.webSocket.onclose=function(e){e.wasClean?console.log("\u0421\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435 \u0437\u0430\u043a\u0440\u044b\u0442\u043e"):console.log("\u041e\u0431\u0440\u044b\u0432 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u044f"),console.log("\u041a\u043e\u0434: ",e)},this.webSocket.onmessage=function(e){var a=t.blobToJson(e.data);a.ErrorCode&&0!==a.ErrorCode?console.log("%c REQUEST ERR ","background: #ff4545; color: #bada55; padding: 3px",a):(t.onMessage(a),t.onMessageAuth(a),console.log("%c RESPONSE ","background: #00ff00; color: #000; padding: 3px",t.blobToJson(e.data)))},this.webSocket.onerror=function(e){console.log("%c ERROR CONNECT ","background: red; color: #bada55; padding: 3px",e)}}},{key:"getStatus",value:function(){return this.webSocket.readyState}},{key:"blobToJson",value:function(e){var t,a;return t=URL.createObjectURL(e),(a=new XMLHttpRequest).open("GET",t,!1),a.send(),URL.revokeObjectURL(t),JSON.parse(a.responseText)}},{key:"makeId",value:function(){for(var e="",t="0123456789".length,a=0;a<18;a++)e+="0123456789".charAt(Math.floor(Math.random()*t));return parseInt(e)}},{key:"send",value:function(e){console.log("%c REQUEST ","background: #222; color: #bada55; padding: 3px",e),this.webSocket.send(JSON.stringify(e))}},{key:"onMessage",value:function(){}},{key:"onMessageAuth",value:function(){}},{key:"wsOnConnect",value:function(){}}]),e}());function q(e){return{type:"SET_NODE",node:e}}function G(e){return{type:"SET_PATH",path:e}}var L=function(e){function t(){return Object(k.a)(this,t),Object(j.a)(this,Object(_.a)(t).call(this))}return Object(U.a)(t,e),Object(R.a)(t,[{key:"componentDidMount",value:function(){}},{key:"selectNode",value:function(e){this.props.setActiveNode(e.item.props.data),localStorage.setItem("node",JSON.stringify(e.item.props.data))}},{key:"connectNode",value:function(e){this.props.node.activeNode?x.start(this.props.node.activeNode.Domains[0]):(x.start(this.props.node.allNodes[0].Domains[0]),this.props.setActiveNode(this.props.node.allNodes[0]),localStorage.setItem("node",JSON.stringify(this.props.node.allNodes[0]))),this.props.setPath(e)}},{key:"render",value:function(){var e=o.a.createElement(A.a,{onClick:this.selectNode.bind(this)},this.props.node.allNodes?this.props.node.allNodes.map(function(e,t){return o.a.createElement(A.a.Item,{key:t,data:e},e.Name)}):null);return o.a.createElement(w.a,{type:"flex",align:"middle",justify:"center",style:{height:"100vh"}},o.a.createElement(P.a,null,o.a.createElement("div",{className:"auth__type"},o.a.createElement("h1",null,"\u0412\u0445\u043e\u0434"),o.a.createElement("h2",null,"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u043f\u043e\u0441\u043e\u0431 \u0432\u0445\u043e\u0434\u0430"),o.a.createElement(M.a,{type:"secondary",onClick:this.connectNode.bind(this,"by-phone")},"\u041f\u043e \u043d\u043e\u043c\u0435\u0440\u0443 \u0442\u0435\u043b\u0435\u0444\u043e\u043d\u0430"),o.a.createElement("br",null),o.a.createElement(M.a,{type:"secondary",onClick:this.connectNode.bind(this,"by-email")},"\u041f\u043e \u044d\u043b\u0435\u043a\u0442\u0440\u043e\u043d\u043d\u043e\u0439 \u043f\u043e\u0447\u0442\u0435"),o.a.createElement("br",null),o.a.createElement(M.a,{type:"secondary"},"\u0427\u0435\u0440\u0435\u0437 \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u0435"),o.a.createElement("br",null),o.a.createElement("br",null),o.a.createElement(M.a,{type:"link",onClick:this.connectNode.bind(this,"registration")},"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f"),o.a.createElement("br",null),o.a.createElement("div",{className:"auth__type_server"},o.a.createElement("span",null,"\u0421\u0435\u0440\u0432\u0435\u0440: "),o.a.createElement(D.a,{overlay:e},o.a.createElement("span",{className:"ant-dropdown-link"},localStorage.getItem("node")?JSON.parse(localStorage.getItem("node")).Name:"\u0410\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438",o.a.createElement(F.a,{type:"down"})))))))}}]),t}(r.Component);var V=Object(c.b)(function(e){return{node:e.node}},function(e){return{setActiveNode:function(t){return e(q(t))},setPath:function(t){return e(G(t))}}})(L),H=n(8),B=n(458),J=n(465);var z=function(){var e=Object(r.useState)(""),t=Object(H.a)(e,2),a=t[0],n=t[1],s=Object(r.useState)(""),l=Object(H.a)(s,2),c=l[0],i=l[1],u=Object(r.useState)(""),d=Object(H.a)(u,2),m=d[0],p=d[1],f=Object(r.useState)(""),g=Object(H.a)(f,2),v=g[0],h=g[1],y=Object(r.useState)(!1),E=Object(H.a)(y,2),b=E[0],I=E[1],T=Object(r.useState)(!1),S=Object(H.a)(T,2),C=S[0],O=S[1],N=Object(r.useState)(!1),k=Object(H.a)(N,2),R=k[0],j=k[1],_=Object(r.useState)(null),U=Object(H.a)(_,2),q=U[0],G=U[1];Object(r.useEffect)(function(){x.onMessage=function(e){0!==e.ErrorCode||6===e.ResponseType&&(localStorage.getItem("FileAccessToken",e.FileAccessToken),localStorage.getItem("AccessToken",e.Token.AccessToken),localStorage.getItem("RefreshToken",e.Token.RefreshToken),localStorage.getItem("User",e.User),window.location.replace("/"))},G(JSON.parse(localStorage.getItem("node")))},[]);var L=o.a.createElement(A.a,{onClick:function(e){var t;(t=e).item.props.data&&(G(t.item.props.data),localStorage.setItem("node",JSON.stringify(t.item.props.data)))}},JSON.parse(localStorage.getItem("nodes")).map(function(e,t){return o.a.createElement(A.a.Item,{key:t,data:e},e.Name)}));return o.a.createElement(w.a,{type:"flex",align:"middle",justify:"center",style:{height:"100vh"}},o.a.createElement(P.a,null,o.a.createElement("div",{className:"auth__type"},o.a.createElement("h1",null,"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f"),o.a.createElement("div",null,o.a.createElement(B.a,{className:"login-form"},o.a.createElement(B.a.Item,{validateStatus:b?"error":"",help:b||""},o.a.createElement(J.a,{placeholder:"\u0418\u043c\u044f",onChange:function(e){n(e.target.value),I(!1)}})),o.a.createElement(B.a.Item,{validateStatus:""},o.a.createElement(J.a,{placeholder:"\u0424\u0430\u043c\u0438\u043b\u0438\u044f",onChange:function(e){i(e.target.value)}})),o.a.createElement(B.a.Item,{validateStatus:C?"error":"",help:C||""},o.a.createElement(J.a,{placeholder:"\u041d\u043e\u043c\u0435\u0440 \u0442\u0435\u043b\u0435\u0444\u043e\u043d\u0430",onChange:function(e){p(e.target.value),O(!1)}})),o.a.createElement(B.a.Item,{validateStatus:C?"error":"",help:C||""},o.a.createElement(J.a,{placeholder:"Email",onChange:function(e){h(e.target.value),O(!1)}})),o.a.createElement(B.a.Item,null,o.a.createElement(w.a,null,o.a.createElement(P.a,{style:{textAlign:"center"}},o.a.createElement(M.a,{type:"primary",onClick:function(){if(0===a.length)I("\u042d\u0442\u043e \u043f\u043e\u043b\u0435 \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e \u0434\u043b\u044f \u0437\u0430\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f");else if(0===m.length&&0===v.length)O("\u041e\u0434\u043d\u043e \u0438\u0437 \u044d\u0442\u0438\u0445 \u043f\u043e\u043b\u0435\u0439 \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e \u0434\u043b\u044f \u0437\u0430\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f");else{j(!0);var e={User:{Id:0,Phones:m?[m]:null,NameFirst:a,NameSecond:c,About:"",Photo:"",Country:"",City:"",Birthday:"",Language:null,NodeId:q.Id,Online:null,Emails:v?[v]:null,Blacklist:null,Visible:null,Security:null,Tag:0,RegistrationDate:null},RequestId:x.makeId(),RequestType:37,Type:0};x.send(e)}},loading:R},"\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c\u0441\u044f"))))),o.a.createElement("div",{className:"auth__type_server"},o.a.createElement("span",null,"\u0421\u0435\u0440\u0432\u0435\u0440: "),o.a.createElement(D.a,{overlay:L},o.a.createElement("span",{className:"ant-dropdown-link"},q?q.Name:"\u0410\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438",o.a.createElement(F.a,{type:"down"}))))))))},W=n(57);function K(e){return{type:"SET_AUTH",auth:e}}var Q=function(e){function t(){var e;return Object(k.a)(this,t),(e=Object(j.a)(this,Object(_.a)(t).call(this))).state={verifyUid:null,verifyErr:null,verifyRequestSended:!1,verifyCode:null,verifyCodeErr:null,btnPreloader:!1,redirect:!1},e}return Object(U.a)(t,e),Object(R.a)(t,[{key:"componentDidMount",value:function(){var e=this;x.onMessageAuth=function(t){e.setState({btnPreloader:!1}),0!==t.ErrorCode?e.setState({verifyErr:t.Message}):10===t.ResponseType?e.setState({verifyRequestSended:!0}):6===t.ResponseType&&(localStorage.setItem("FileAccessToken",t.FileAccessToken),localStorage.setItem("AccessToken",t.Token.AccessToken),localStorage.setItem("RefreshToken",t.Token.RefreshToken),localStorage.setItem("User",JSON.stringify(t.User)),e.props.setAuth("AUTH_SUCCESS"),e.setState({redirect:!0}))}}},{key:"onChangePhone",value:function(e){this.setState({verifyUid:e.target.value,verifyErr:null})}},{key:"onChangeVerifCode",value:function(e){this.setState({verifyCode:e.target.value,verifyCodeErr:null})}},{key:"sendverifyCode",value:function(e){e.preventDefault(),this.setState({btnPreloader:!0});var t={Uid:this.state.verifyUid,VCode:this.state.verifyCode,LoginType:1,UidType:"by-email"===this.props.verifyType?2:(this.props.verifyType,0),RequestId:x.makeId(),RequestType:33,Type:0};x.send(t)}},{key:"sendVerificationQuery",value:function(e){e.preventDefault(),this.setState({btnPreloader:!0});var t={VerificationType:"by-email"===this.props.verifyType?1:(this.props.verifyType,0),Uid:this.state.verifyUid,RequestId:x.makeId(),RequestType:42,Type:0};x.send(t)}},{key:"render",value:function(){var e=this;return this.state.redirect?o.a.createElement(W.a,{to:"/"}):o.a.createElement(w.a,{type:"flex",align:"middle",justify:"center",style:{height:"100vh"}},o.a.createElement(P.a,null,o.a.createElement("div",{className:"auth__type"},o.a.createElement("div",{className:"modal_back",onClick:function(){return e.props.setPrevPath()}},o.a.createElement(F.a,{type:"arrow-left"})),o.a.createElement("h1",null,"\u0412\u0445\u043e\u0434"),this.state.verifyRequestSended?o.a.createElement("div",null,o.a.createElement("h2",null,"\u041a\u043e\u0434 \u043f\u043e\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043d\u0438\u044f \u0438\u0437 ","by-email"===this.props.verifyType?"\u043f\u0438\u0441\u044c\u043c\u0430":"by-phone"===this.props.verifyType?"SMS":""),o.a.createElement("p",null,"\u041c\u044b \u043e\u0442\u043f\u0440\u0430\u0432\u0438\u043b\u0438 ","by-email"===this.props.verifyType?"\u043f\u0438\u0441\u044c\u043c\u043e":"by-phone"===this.props.verifyType?"SMS":"","\u043d\u0430 ","by-email"===this.props.verifyType?"email":"by-phone"===this.props.verifyType?"\u043d\u043e\u043c\u0435\u0440":""," ",this.state.verifyUid,". \u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u044b\u0439 \u043a\u043e\u0434 \u0432 \u043f\u043e\u043b\u0435 \u043d\u0438\u0436\u0435"),o.a.createElement(B.a,{onSubmit:this.sendverifyCode.bind(this),className:"login-form"},o.a.createElement(B.a.Item,{validateStatus:this.state.verifyCodeErr?"error":"",help:this.state.verifyCodeErr?this.state.verifyCodeErr:""},o.a.createElement(J.a,{autoFocus:!0,inputMode:"tel",placeholder:"\u041a\u043e\u0434 \u0438\u0437 ".concat("by-email"===this.props.verifyType?"\u043f\u0438\u0441\u044c\u043c\u0430":"by-phone"===this.props.verifyType?"SMS":"",", 4 \u0446\u0438\u0444\u0440\u044b"),onChange:this.onChangeVerifCode.bind(this)})),o.a.createElement(B.a.Item,null,o.a.createElement(w.a,null,o.a.createElement(P.a,{style:{textAlign:"center"}},o.a.createElement(M.a,{type:"primary",htmlType:"submit",disabled:!this.state.verifyCode,loading:!!this.state.btnPreloader},"\u0412\u043e\u0439\u0442\u0438")))))):o.a.createElement("div",null,o.a.createElement("h2",null,"by-email"===this.props.verifyType?"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0432\u0430\u0448 email":"by-phone"===this.props.verifyType?"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043d\u043e\u043c\u0435\u0440 \u0442\u0435\u043b\u0435\u0444\u043e\u043d\u0430":""),o.a.createElement(B.a,{onSubmit:this.sendVerificationQuery.bind(this),className:"login-form"},o.a.createElement(B.a.Item,{validateStatus:this.state.verifyErr?"error":"",help:this.state.verifyErr?this.state.verifyErr:""},o.a.createElement(J.a,{autoFocus:!0,inputMode:"by-email"===this.props.verifyType?"email":"by-phone"===this.props.verifyType?"tel":"",placeholder:"by-email"===this.props.verifyType?"\u0412\u0430\u0448 email":"by-phone"===this.props.verifyType?"\u0412\u0430\u0448 \u043d\u043e\u043c\u0435\u0440 \u0442\u0435\u043b\u0435\u0444\u043e\u043d\u0430":"",onChange:this.onChangePhone.bind(this)})),o.a.createElement(B.a.Item,null,o.a.createElement(w.a,null,o.a.createElement(P.a,{style:{textAlign:"center"}},o.a.createElement(M.a,{type:"primary",htmlType:"submit",disabled:!this.state.verifyUid,loading:!!this.state.btnPreloader},"\u041f\u043e\u043b\u0443\u0447\u0438\u0442\u044c ","by-email"===this.props.verifyType?"\u043f\u0438\u0441\u044c\u043c\u043e":"by-phone"===this.props.verifyType?"SMS":""," \u0441 \u043a\u043e\u0434\u043e\u043c")))))))))}}]),t}(r.Component);var Z=Object(c.b)(function(e){return{verifyType:e.path.currentPath}},function(e){return{setAuth:function(t){return e(K(t))},setPrevPath:function(){return e({type:"PREV_PATH"})}}})(Q),X=n(36);var Y={getFormatedMessages:function(e){var t=[];return e.forEach(function(e){var a={Attachments:e.Attachments,ConversationId:e.ConversationId,ConversationType:e.ConversationType,GlobalId:e.GlobalId,Read:e.Read,SenderId:e.SenderId,SendingTime:e.SendingTime,Text:e.Text};t.push(a)}),t},getFormatedDialogs:function(e){var t=[];return e.forEach(function(e){var a={AttachmentType:e.AttachmentType,ConversationId:e.ConversationId,ConversationType:e.ConversationType,IsMuted:e.IsMuted,LastMessageId:e.LastMessageId,LastMessageSenderId:e.LastMessageSenderId,LastMessageSenderName:e.LastMessageSenderName,LastMessageTime:e.LastMessageTime,Photo:e.Photo,PreviewText:e.PreviewText,Read:e.Read,SecondUid:e.SecondUid,Title:e.Title,UnreadedCount:e.UnreadedCount};t.push(a)}),t},getFormatedChats:function(e){var t=[];return e.forEach(function(e){var a={About:e.About,Id:e.Id,Key:e.Key,Name:e.Name,NodesId:e.NodesId,Photo:e.Photo,Public:e.Public,Security:e.Security,Tag:e.Tag,Type:e.Type,Users:e.Users,Visible:e.Visible};t.push(a)}),t},getFormatedChatsUsers:function(e){var t=[];return e.forEach(function(e){var a={Banned:e.Banned,ChatId:e.ChatId,Deleted:e.Deleted,InviterId:e.InviterId,IsMuted:e.IsMuted,Joined:e.Joined,UserId:e.UserId,UserInfo:e.UserInfo,UserRole:e.UserRole};t.push(a)}),t},getFormatedUser:function(e){var t=[];return e.forEach(function(e){var a={About:e.About,Birthday:e.Birthday,BlackList:e.BlackList,City:e.City,Confirmed:e.Confirmed,Contact:e.Contact,ContactsPrivacy:e.ContactsPrivacy,Country:e.Country,Emails:e.Emails,Encryption:e.Encryption,Groups:e.Groups,Id:e.Id,Keys:e.Keys,Language:e.Language,NameFirst:e.NameFirst,NameSecond:e.NameSecond,NodeId:e.NodeId,Online:e.Online,Phones:e.Phones,Photo:e.Photo,RegistrationDate:e.RegistrationDate,Security:e.Security,Tag:e.Tag,Visible:e.Visible};t.push(a)}),t},getUserById:function(e,t){return t.find(function(t){return t.Id===e})},getUserInitials:function(e){if(!e.Photo){var t="";if(e.Title||e.ChannelName){var a=e.Title||e.ChannelName;(a=a.split(" ",2))[0]&&(t=a[0][0]),a[1]&&(t+=a[1][0])}else e.NameFirst?(t=e.NameFirst[0],e.NameSecond&&(t+=e.NameSecond[0])):t=(e.SecondUid+"").substr(0,2);return t}},getActiveDialog:function(e){return e.find(function(e){return e.active})}},$=function(e){function t(){var e;return Object(k.a)(this,t),(e=Object(j.a)(this,Object(_.a)(t).call(this))).state={defaultAva:""},e}return Object(U.a)(t,e),Object(R.a)(t,[{key:"componentDidMount",value:function(){var e=this.refs.messageText,t=e.innerText;t.length>60&&(e.innerText=t.slice(0,60)+" ..."),this.props.dialog.Photo||this.setState({defaultAva:Y.getUserInitials(this.props.dialog)})}},{key:"openDialog",value:function(){var e={};e.type=this.props.type,e.data=this.props.dialog,this.props.openDialog(e)}},{key:"render",value:function(){var e=this,t={width:"100%",height:"100%",backgroundSize:"cover",backgroundPosition:"center center",backgroundImage:"url(https://".concat(this.props.node,":5000/api/Files/").concat(this.props.dialog.Photo,")"),backgroundRepeat:"no-repeat"};return o.a.createElement(X.b,{to:"/",onClick:function(){return e.openDialog()}},o.a.createElement("div",{className:"sidebar__item"},o.a.createElement("div",{className:"sidebar__ava"},this.props.dialog.UnreadedCount>0?o.a.createElement("div",{className:"sidebar__badge"},this.props.dialog.UnreadedCount):null,o.a.createElement("div",{className:"sidebar__photo"},this.props.dialog.Photo?this.props.dialog.Photo.length>0?o.a.createElement("div",{style:t}):null:o.a.createElement("div",{className:"sidebar__photo-default avatar-default"},this.state.defaultAva))),o.a.createElement("div",null,o.a.createElement("div",{className:"sidebar__name"},o.a.createElement("span",null,this.props.dialog.Title||this.props.dialog.NameFirst+this.props.dialog.NameSecond||this.props.dialog.ChannelName||this.props.dialog.Name||"\u0418\u043c\u044f \u0441\u043a\u0440\u044b\u0442\u043e")),o.a.createElement("div",{className:"sidebar__message",ref:"messageText"},this.props.dialog.PreviewText?this.props.dialog.PreviewText:1===this.props.dialog.AttachmentType?"\u0424\u0430\u0439\u043b":2===this.props.dialog.AttachmentType?"\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435":this.props.dialog.About?this.props.dialog.About:null))))}}]),t}(r.Component);var ee=Object(c.b)(function(e){return{node:e.node.activeNode.Domains[0]}},function(e){return{openDialog:function(t){return e(T(t))}}})($),te=n(212),ae=n.n(te);var ne=Object(c.b)(function(e){return{}},function(e){return{toggleDrawer:function(){return e(O())}}})(function(e){return o.a.createElement("div",{className:"head-sidebar"},o.a.createElement(F.a,{type:"menu",className:"menu-btn",onClick:function(){return e.toggleDrawer()}}),o.a.createElement("div",{className:"head-sidebar__logo"},o.a.createElement("img",{src:ae.a,alt:"Y Messenger"})))});var re=J.a.Search;var oe=Object(c.b)(function(e){return{search:e.ui.search}},function(e){return{searchStart:function(t){return e({type:"SEARCH_START",text:t})},searchEnd:function(){return e({type:"SEARCH_END"})}}})(function(e){var t=Object(r.useState)(""),a=Object(H.a)(t,2),n=a[0],s=a[1],l=function(t){"object"===typeof t?s(t.target.value):"string"===typeof t&&s(t),n.length?e.searchStart(n.toLowerCase()):n.length||e.searchEnd();var a={RequestType:46,SearchQuery:n,RequestId:x.makeId(),Direction:!0,Type:0};x.send(a)};return o.a.createElement("div",{className:"search"},o.a.createElement(re,{placeholder:"\u041f\u043e\u0438\u0441\u043a",value:n,onSearch:l,onChange:l,enterButton:!0}))});var se=Object(c.b)(function(e){return{dialogs:e.dialogs,search:e.ui.search,searchResult:e.searchResult}},function(e){return{openDialog:function(t){return e(T(t))}}})(function(e){var t=Object(r.useState)([]),a=Object(H.a)(t,2),n=a[0],s=a[1];return Object(r.useEffect)(function(){if(e.search){var t=e.dialogs.filter(function(t){if(!t.fake&&t.Title)return t.Title.toLowerCase().indexOf(e.search)>=0});s(t)}else s(e.dialogs)},[e.search,e.dialogs]),o.a.createElement("div",{className:"sidebar"},o.a.createElement(ne,null),o.a.createElement(oe,null),o.a.createElement("div",{className:"sidebar-viewport"},n.map(function(e){if(e&&!e.fake)return o.a.createElement(ee,{dialog:e,key:x.makeId(),type:"dialog"})}),e.searchResult?function(){if(e.searchResult.users)return e.searchResult.users.map(function(e,t){if(e)return 0===t?o.a.createElement("div",{key:x.makeId()},o.a.createElement("div",{className:"sidebar__title"},"\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0438:"),o.a.createElement(ee,{dialog:e,type:"user"})):o.a.createElement(ee,{dialog:e,type:"user",key:x.makeId()})})}():null,e.searchResult?function(){if(e.searchResult.chats)return e.searchResult.chats.map(function(e,t){if(e)return 0===t?o.a.createElement("div",{key:x.makeId()},o.a.createElement("div",{className:"sidebar__title"},"\u0427\u0430\u0442\u044b:"),o.a.createElement(ee,{dialog:e,type:"chat"})):o.a.createElement(ee,{dialog:e,type:"chat",key:x.makeId()})})}():null,e.searchResult?function(){if(e.searchResult.channels)return e.searchResult.channels.map(function(e,t){if(e)return 0===t?o.a.createElement("div",{key:x.makeId()},o.a.createElement("div",{className:"sidebar__title"},"\u041a\u0430\u043d\u0430\u043b\u044b:"),o.a.createElement(ee,{dialog:e,type:"channel"})):o.a.createElement(ee,{dialog:e,type:"channel",key:x.makeId()})})}():null))}),le=n(464),ce=n(457),ie=n(214),ue=n.n(ie);ce.a.locale(ue.a);var de=Object(c.b)(function(e){return{dialogs:e.dialogs,users:e.users,node:e.node.activeNode.Domains[0]}},function(e){return{openProfile:function(t){return e(C(t))},closeDialog:function(){return e({type:"CLOSE_DIALOG"})}}})(function(e){var t=Object(r.useState)(null),a=Object(H.a)(t,2),n=a[0],s=a[1],l=Object(r.useState)(""),c=Object(H.a)(l,2),i=c[0],u=c[1],d=Object(r.useState)(null),m=Object(H.a)(d,2),p=m[0],f=m[1],g=Object(r.useState)(document.body.clientWidth),v=Object(H.a)(g,2),h=v[0],y=v[1];return Object(r.useEffect)(function(){},[h]),window.onresize=function(){y(document.body.clientWidth)},Object(r.useEffect)(function(){if(e.users&&n){var t=e.users.find(function(e){return e.Id===n.SecondUid});f(t)}},[e.users,n]),Object(r.useEffect)(function(){e.dialogs.forEach(function(e){e.active&&s(e)})},[e.dialogs]),Object(r.useEffect)(function(){n&&(n.Photo||u(Y.getUserInitials(n)))},[n]),o.a.createElement("div",{className:"head-dialog"},h<=675&&Y.getActiveDialog(e.dialogs)?o.a.createElement("div",{className:"head-dialog__back",onClick:e.closeDialog},o.a.createElement(F.a,{type:"left"})):null,o.a.createElement("div",{className:"head-dialog__user",onClick:function(){e.openProfile(n)}},o.a.createElement("div",{className:"head-dialog__ava"},n?n.Photo?o.a.createElement("div",{style:{width:"100%",height:"100%",backgroundSize:"cover",backgroundPosition:"center center",backgroundImage:"url(https://".concat(e.node,":5000/api/Files/").concat(n.Photo,")"),backgroundRepeat:"no-repeat"}}):o.a.createElement("div",{className:"head-dialog__photo-default avatar-default"},i):null),o.a.createElement("div",null,o.a.createElement("div",{className:"head-dialog__name"},n?n.Title||n.ChannelName||"\u0418\u043c\u044f \u0441\u043a\u0440\u044b\u0442\u043e":null),o.a.createElement("div",{className:"head-dialog__status"},p&&p.Online?o.a.createElement(le.a,{date:1e3*p.Online,locale:"ru"}):null))),o.a.createElement("div",{onClick:function(){var e={Full:!1,AccessToken:localStorage.getItem("AccessToken"),RequestType:34,RequestId:x.makeId(),Type:0};x.send(e),localStorage.removeItem("AccessToken"),localStorage.removeItem("FileAccessToken"),localStorage.removeItem("RefreshToken"),localStorage.removeItem("User"),window.location.replace("/")},className:"head-dialog__logout"},"\u0412\u044b\u0445\u043e\u0434"))}),me=n(461);var pe=Object(c.b)(function(e){return{node:e.node.activeNode.Domains[0]}},function(e){return{}})(function(e){var t={width:"100%",height:"100%",backgroundSize:"cover",backgroundPosition:"center center",backgroundImage:"url(https://".concat(e.node,":5000/api/Files/").concat(e.user.Photo,")"),backgroundRepeat:"no-repeat",borderRadius:"100%"};return o.a.createElement("div",{className:"avatar"},e.user.Photo?o.a.createElement("div",{style:t}):o.a.createElement("div",{className:"avatar-default"},Y.getUserInitials(e.user)))});function fe(){return(fe=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function ge(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var ve=o.a.createElement("g",null,o.a.createElement("g",{id:"check"},o.a.createElement("polygon",{points:"142.8,323.85 35.7,216.75 0,252.45 142.8,395.25 448.8,89.25 413.1,53.55  "}))),he=o.a.createElement("g",null),ye=o.a.createElement("g",null),Ee=o.a.createElement("g",null),be=o.a.createElement("g",null),Ie=o.a.createElement("g",null),Te=o.a.createElement("g",null),Se=o.a.createElement("g",null),Ce=o.a.createElement("g",null),Oe=o.a.createElement("g",null),Ne=o.a.createElement("g",null),ke=o.a.createElement("g",null),Re=o.a.createElement("g",null),je=o.a.createElement("g",null),_e=o.a.createElement("g",null),Ue=o.a.createElement("g",null),Ae=function(e){var t=e.svgRef,a=ge(e,["svgRef"]);return o.a.createElement("svg",fe({id:"Capa_1",x:"0px",y:"0px",width:"448.8px",height:"448.8px",viewBox:"0 0 448.8 448.8",style:{enableBackground:"new 0 0 448.8 448.8"},xmlSpace:"preserve",ref:t},a),ve,he,ye,Ee,be,Ie,Te,Se,Ce,Oe,Ne,ke,Re,je,_e,Ue)},we=o.a.forwardRef(function(e,t){return o.a.createElement(Ae,fe({svgRef:t},e))});n.p;function Pe(){return(Pe=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function Me(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var De=o.a.createElement("g",null,o.a.createElement("g",{id:"done-all"},o.a.createElement("path",{d:"M448.8,161.925l-35.7-35.7l-160.65,160.65l35.7,35.7L448.8,161.925z M555.899,126.225l-267.75,270.3l-107.1-107.1 l-35.7,35.7l142.8,142.8l306-306L555.899,126.225z M0,325.125l142.8,142.8l35.7-35.7l-142.8-142.8L0,325.125z"}))),Fe=o.a.createElement("g",null),xe=o.a.createElement("g",null),qe=o.a.createElement("g",null),Ge=o.a.createElement("g",null),Le=o.a.createElement("g",null),Ve=o.a.createElement("g",null),He=o.a.createElement("g",null),Be=o.a.createElement("g",null),Je=o.a.createElement("g",null),ze=o.a.createElement("g",null),We=o.a.createElement("g",null),Ke=o.a.createElement("g",null),Qe=o.a.createElement("g",null),Ze=o.a.createElement("g",null),Xe=o.a.createElement("g",null),Ye=function(e){var t=e.svgRef,a=Me(e,["svgRef"]);return o.a.createElement("svg",Pe({id:"Capa_1",x:"0px",y:"0px",width:"594.149px",height:"594.149px",viewBox:"0 0 594.149 594.149",style:{enableBackground:"new 0 0 594.149 594.149"},xmlSpace:"preserve",ref:t},a),De,Fe,xe,qe,Ge,Le,Ve,He,Be,Je,ze,We,Ke,Qe,Ze,Xe)},$e=o.a.forwardRef(function(e,t){return o.a.createElement(Ye,Pe({svgRef:t},e))});n.p;var et=Object(c.b)(function(e){return{users:e.users,forwardMessage:e.forwardMessage,node:e.node.activeNode.Domains[0]}},function(e){return{forwardingMessage:function(t){return e(I(t))}}})(function(e){var t=Object(r.useState)(!1),a=Object(H.a)(t,2),n=a[0],s=a[1],l=Object(r.useState)(""),c=Object(H.a)(l,2),i=c[0],u=c[1],d=Object(r.useState)(!1),m=Object(H.a)(d,2),p=m[0],f=m[1],g=Object(r.useState)(!1),v=Object(H.a)(g,2),h=v[0],y=v[1],E=Y.getUserById(e.message.SenderId,e.users)||{};Object(r.useEffect)(function(){if(e.message){var t=new Date(1e3*e.message.SendingTime),a=new Date;a.setTime(t);var n="".concat(a.getHours()),r="".concat(a.getMinutes());1===n.length&&(n="0".concat(n)),1===r.length&&(r="0".concat(r)),u("".concat(n,":").concat(r))}},[e.message]);var b,I=function(e){var t=e,a=!1;t&&(a=t.match(/(http|https|ftp|ftps)\:\/\/[a-zA-Z0-9\-\.]+\.[a-zA-Z]{2,3}(\/\S*)?/g));var n=0;for(n in a)t=t.replace(a[n],' <a href="'+a[n]+'" target="_blank"> '+a[n]+" </a> ");return t};return h?o.a.createElement(W.a,{to:"/"}):E&&e.message?o.a.createElement("div",{className:E.currentUser?"message message-out":"message message-in",onClick:function(){f(!p)},style:e.message&&p?{background:"#ebf5ff"}:null},o.a.createElement("div",{className:"wrap-message-content"},E.currentUser||3===e.message.ConversationType?null:o.a.createElement(pe,{user:E}),E.currentUser&&e.message.Read?o.a.createElement($e,{className:"message__read"}):E.currentUser&&!e.message.Read?o.a.createElement(we,{className:"message__read"}):null,o.a.createElement("div",{className:"message__content"},E.currentUser?null:o.a.createElement("div",{className:"message__name"},E.NameFirst?E.NameFirst+" ":null,E.NameSecond?E.NameSecond:null),(b=e.message).Attachments?b.Attachments.length?2===b.Attachments[0].Type?o.a.createElement("div",{className:"message__img",onClick:function(){return s(!0)}},o.a.createElement("img",{src:"https://".concat(e.node,":5000/api/Files/")+b.Attachments[0].Payload.FileId,alt:""})):1!==b.Attachments[0].Type?5===b.Attachments[0].Type?b.Attachments[0].Payload.length>0?o.a.createElement("div",{className:"forwarding_message"},"\u041f\u0435\u0440\u0435\u0441\u043b\u0430\u043d\u043d\u043e\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u043e\u0442",o.a.createElement(X.b,{to:"/dialog/".concat(b.ConversationId)},function(t){var a=e.users.find(function(e){return e.Id===t});if(a)return" ".concat(a.NameFirst," ").concat(a.NameSecond)}(b.Attachments[0].Payload[0].SenderId)),o.a.createElement("div",{dangerouslySetInnerHTML:{__html:I(b.Attachments[0].Payload[0].Text)}}),b.Text?o.a.createElement("div",{dangerouslySetInnerHTML:{__html:I(b.Text)}}):null):o.a.createElement("div",{className:"forwarding_message"},"\u041f\u0435\u0440\u0435\u0441\u043b\u0430\u043d\u043d\u043e\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u043e\u0442:",o.a.createElement("div",null,"\u041f\u0435\u0440\u0435\u0441\u043b\u0430\u043d\u043d\u043e\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u0443\u0434\u0430\u043b\u0435\u043d\u043e")):o.a.createElement("div",{style:{fontStyle:"italic"}},"*\u043d\u0435\u043f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u043c\u044b\u0439 \u0442\u0438\u043f \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f*"):b.Attachments[0].Payload?o.a.createElement("div",null,o.a.createElement(F.a,{type:"download",className:"download-icon"}),o.a.createElement("a",{href:"https://".concat(e.node,":5000/api/Files/")+b.Attachments[0].Payload.FileId,download:!0},b.Attachments[0].Payload.Filename),o.a.createElement("span",{dangerouslySetInnerHTML:{__html:I(b.Text)}})):void 0:b.Text?o.a.createElement("div",{dangerouslySetInnerHTML:{__html:I(b.Text)}}):null:b.Text?o.a.createElement("div",null,b.Text):null),o.a.createElement("div",{className:"message__time"},i)),e.message.Attachments&&e.message.Attachments[0]?o.a.createElement(me.a,{visible:n,onCancel:function(){return s(!1)},footer:null,maskClosable:!0},o.a.createElement("img",{className:"popup__img",src:"https://".concat(e.node,":5000/api/Files/").concat(e.message.Attachments[0].Payload.FileId),alt:""})):null,e.message&&p?o.a.createElement("div",{className:"message-menu"},o.a.createElement("ul",null,o.a.createElement("li",{onClick:function(){e.forwardingMessage(e.message)}},"\u041e\u0442\u0432\u0435\u0442\u0438\u0442\u044c"),o.a.createElement("li",{onClick:function(){e.forwardingMessage(e.message),y(!0)}},"\u041f\u0435\u0440\u0435\u0441\u043b\u0430\u0442\u044c"))):null):null});function tt(){return(tt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function at(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var nt=o.a.createElement("g",{transform:"translate(-198)",id:"g69"},o.a.createElement("g",{id:"_x33__22_"},o.a.createElement("g",{id:"g66"},o.a.createElement("path",{id:"path64",d:"m 544.5,99 v 495 c 0,82.021 -66.479,148.5 -148.5,148.5 -82.021,0 -148.5,-66.479 -148.5,-148.5 V 148.5 c 0,-54.673 44.327,-99 99,-99 54.673,0 99,44.327 99,99 V 594 c 0,27.349 -22.176,49.5 -49.5,49.5 -27.349,0 -49.5,-22.151 -49.5,-49.5 V 198 H 297 v 396 c 0,54.673 44.327,99 99,99 54.673,0 99,-44.327 99,-99 V 148.5 C 495,66.479 428.521,0 346.5,0 264.479,0 198,66.479 198,148.5 V 618.75 C 210.202,716.389 295.045,792 396,792 496.955,792 581.798,716.389 594,618.75 V 99 Z"})))),rt=function(e){var t=e.svgRef,a=at(e,["svgRef"]);return o.a.createElement("svg",tt({xmlSpace:"preserve",viewBox:"0 0 396 792",height:0,width:0,y:"0px",x:"0px",id:"Capa_1",ref:t},a),nt)},ot=o.a.forwardRef(function(e,t){return o.a.createElement(rt,tt({svgRef:t},e))});n.p;function st(){return(st=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function lt(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var ct=o.a.createElement("g",{transform:"translate(0,-38.25)",id:"g95"},o.a.createElement("g",{id:"send"},o.a.createElement("polygon",{id:"polygon92",points:"0,38.25 0,216.75 382.5,267.75 0,318.75 0,497.25 535.5,267.75 "}))),it=o.a.createElement("g",{transform:"translate(0,-38.25)",id:"g97"}),ut=o.a.createElement("g",{transform:"translate(0,-38.25)",id:"g99"}),dt=o.a.createElement("g",{transform:"translate(0,-38.25)",id:"g101"}),mt=o.a.createElement("g",{transform:"translate(0,-38.25)",id:"g103"}),pt=o.a.createElement("g",{transform:"translate(0,-38.25)",id:"g105"}),ft=o.a.createElement("g",{transform:"translate(0,-38.25)",id:"g107"}),gt=o.a.createElement("g",{transform:"translate(0,-38.25)",id:"g109"}),vt=o.a.createElement("g",{transform:"translate(0,-38.25)",id:"g111"}),ht=o.a.createElement("g",{transform:"translate(0,-38.25)",id:"g113"}),yt=o.a.createElement("g",{transform:"translate(0,-38.25)",id:"g115"}),Et=o.a.createElement("g",{transform:"translate(0,-38.25)",id:"g117"}),bt=o.a.createElement("g",{transform:"translate(0,-38.25)",id:"g119"}),It=o.a.createElement("g",{transform:"translate(0,-38.25)",id:"g121"}),Tt=o.a.createElement("g",{transform:"translate(0,-38.25)",id:"g123"}),St=o.a.createElement("g",{transform:"translate(0,-38.25)",id:"g125"}),Ct=function(e){var t=e.svgRef,a=lt(e,["svgRef"]);return o.a.createElement("svg",st({xmlSpace:"preserve",viewBox:"0 0 535.5 459",height:0,width:0,y:"0px",x:"0px",id:"Capa_1",ref:t},a),ct,it,ut,dt,mt,pt,ft,gt,vt,ht,yt,Et,bt,It,Tt,St)},Ot=o.a.forwardRef(function(e,t){return o.a.createElement(Ct,st({svgRef:t},e))}),Nt=(n.p,n(455)),kt=n(38),Rt=n.n(kt);var jt=Object(c.b)(function(e){return{user:e.users.find(function(e){return!0===e.currentUser}),dialogs:e.dialog,forwardMessage:e.forwardMessage,node:e.node.activeNode.Domains[0]}},function(e){return{forwardingMessage:function(t){return e(I(t))}}})(function(e){var t=Object(r.useState)(""),a=Object(H.a)(t,2),n=a[0],s=a[1],l=Object(r.useState)(!1),c=Object(H.a)(l,2),i=c[0],u=c[1],d=Object(r.useState)(null),m=Object(H.a)(d,2),p=m[0],f=m[1],g=Object(r.useState)(null),v=Object(H.a)(g,2),h=v[0],y=v[1];Object(r.useEffect)(function(){p&&E()},[p]);var E=function(){if(e.forwardMessage){var t={Messages:[{Id:0,SendingTime:"",SenderId:e.user.Id,ReceiverId:e.dialog.SecondUid,ConversationId:e.dialog.ConversationId,ConversationType:e.dialog.ConversationType,Read:!1,NodesId:null,ReplyTo:null,Text:n,Attachments:[{Type:5,Payload:{MessagesGlobalId:[e.forwardMessage.GlobalId],ConversationId:e.forwardMessage.ConversationId,ConversationType:e.forwardMessage.ConversationType}}]}],RequestType:39,RequestId:x.makeId(),Type:0};x.send(t)}else if(p){var a={Messages:[{Id:0,SendingTime:"",SenderId:e.user.Id,ReceiverId:e.dialog.SecondUid,ConversationId:e.dialog.ConversationId,ConversationType:e.dialog.ConversationType,Read:!1,NodesId:null,ReplyTo:null,Text:n,Attachments:[{Type:h,Hash:null,MessageId:0,Payload:p,NodesId:null}],GlobalId:null}],RequestType:39,RequestId:x.makeId(),Type:0};x.send(a)}else{var r={Messages:[{Id:0,SendingTime:"",SenderId:e.user.Id,ReceiverId:e.dialog.SecondUid,ConversationId:e.dialog.ConversationId,ConversationType:e.dialog.ConversationType,Read:!1,NodesId:null,ReplyTo:null,Text:n,Attachments:null,GlobalId:null}],RequestType:39,RequestId:x.makeId(),Type:0};x.send(r)}s(""),e.forwardMessage&&e.forwardingMessage(!1)};return o.a.createElement("div",{className:"new-message"},o.a.createElement(Nt.a,{showUploadList:!1,customRequest:function(t){return function(t){var a=localStorage.getItem("FileAccessToken");Rt.a.defaults.headers.FileAccessToken=a;var n=new FormData;n.append("file",t.file),Rt.a.post("https://".concat(e.node,":5000/api/Files"),n).then(function(e){200===e.status&&(u(!1),f(e.data.File.FileId))}).catch(function(e){console.log(e)})}(t)},beforeUpload:function(e){var t="image/jpeg"===e.type||"image/png"===e.type;return y(t?2:1),t},onChange:function(e){"uploading"!==e.file.status||u(!0)}},i?o.a.createElement(F.a,{type:"loading",className:"loading-icon"}):o.a.createElement(ot,{className:"new-message__attach"})),o.a.createElement("input",{type:"text",className:"new-message__inp",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435",value:n,onChange:function(e){s(e.target.value)},onKeyDown:function(e){13===e.keyCode&&E()}}),o.a.createElement(Ot,{onClick:function(){E()},className:"new-message__send"}))});var _t=Object(c.b)(function(e){return{messages:e.messages,forwardMessage:e.forwardMessage,users:e.users,user:e.users.find(function(e){return!0===e.currentUser}),node:e.node.activeNode.Domains[0],appFocus:e.ui.appFocus}},function(e){return{openDialog:function(t){return e(T(t))}}})(function(t){var a=Object(r.useState)([]),n=Object(H.a)(a,2),s=n[0],l=n[1],c=Object(r.useState)(null),i=Object(H.a)(c,2),u=i[0],m=i[1],p=Object(r.useRef)(null);return Object(r.useEffect)(function(){if(t.dialog&&(m(t.dialog),t.appFocus&&t.dialog.LastMessageId)){var e={MessagesId:[t.dialog.LastMessageId],ConversationType:t.dialog.ConversationType,ConversationId:t.dialog.ConversationId,RequestId:x.makeId(),RequestType:35,Type:0};x.send(e)}},[t.dialog]),Object(r.useEffect)(function(){if(u){var e=t.messages.filter(function(e){return e.ConversationId===parseInt(u.ConversationId||u.ChannelId)&&e.ConversationType===u.ConversationType});l(e),setTimeout(function(){p.current&&(p.current.scrollTop=45e4)},10),function(e){var a=[];e.forEach(function(e){e.Attachments&&e.Attachments.length&&5===e.Attachments[0].Type&&e.Attachments[0].Payload.length>0&&(t.users.find(function(t){return t.Id===e.Attachments[0].Payload[0].SenderId})||e.Attachments[0].Payload[0].SenderId&&a.push(e.Attachments[0].Payload[0].SenderId)),t.users.find(function(t){return t.Id===e.SenderId})||e.SenderId&&a.push(e.SenderId)});var n=Object(d.a)(new Set(a.map(function(e){return e})));if(n.length){var r={UsersId:Object(d.a)(n),RequestType:28,RequestId:x.makeId(),Type:0};x.send(r)}}(e)}},[u,t.messages]),o.a.createElement("div",{className:"dialog"},o.a.createElement("div",{className:"dialog__messages-viewport",ref:p,onDragOver:function(e){return function(e){e.preventDefault(),p.current.classList.add("file-over")}(e)},onDragLeave:function(){return function(e){e.preventDefault(),p.current.classList.remove("file-over")}(e)},onDrop:function(e){return function(e){e.preventDefault(),p.current.classList.remove("file-over");var a="image/jpeg"===e.dataTransfer.files[0].type||"image/png"===e.dataTransfer.files[0].type,n=null;n=a?2:1;var r=localStorage.getItem("FileAccessToken");Rt.a.defaults.headers.FileAccessToken=r;var o=new FormData;o.append("file",e.dataTransfer.files[0]),Rt.a.post("https://".concat(t.node,":5000/api/Files"),o).then(function(e){if(200===e.status){var a={Messages:[{Id:0,SendingTime:"",SenderId:t.user.Id,ReceiverId:u.SecondUid,ConversationId:u.ConversationId,ConversationType:u.ConversationType,Read:!1,NodesId:null,ReplyTo:null,Text:"",Attachments:[{Type:n,Hash:null,MessageId:0,Payload:e.data.File.FileId,NodesId:null}],GlobalId:null}],RequestType:39,RequestId:x.makeId(),Type:0};x.send(a)}}).catch(function(e){console.log(e)})}(e)}},o.a.createElement("div",{className:"dialog__messages"},u?s.map(function(e){return o.a.createElement(et,{key:x.makeId(),message:e})}):null)),t.forwardMessage?o.a.createElement("div",{className:"reply-message"},"\u041e\u0442\u0432\u0435\u0442 \u043d\u0430:"," ".concat(t.forwardMessage.Text)):null,t.dialog?"channel"===t.dialog.type&&t.dialog.fake?o.a.createElement(M.a,{type:"primary",size:"large",onClick:function(){var e={ChannelsId:[u.ChannelId],UsersId:[t.user.Id],RequestType:48,RequestId:x.makeId(),Type:0};x.send(e)}},"\u0412\u0441\u0442\u0443\u043f\u0438\u0442\u044c"):3!==t.dialog.ConversationType?o.a.createElement(jt,Object.assign({},t,{dialog:u})):null:null)});var Ut=Object(c.b)(function(e){return{dialogs:e.dialogs,messages:e.messages}},function(e){return{openDialog:function(t){return e(T(t))}}})(function(e){var t=Object(r.useState)(null),a=Object(H.a)(t,2),n=a[0],s=a[1];return Object(r.useEffect)(function(){e.dialogs.forEach(function(e){e.active&&s(e)})},[e.dialogs]),Object(r.useEffect)(function(){},[e.messages]),Object(r.useEffect)(function(){if(n&&!n.messagesRecieved){var e={ConversationType:"channel"===n.type?3:n.ConversationType,ConversationId:n.ConversationId?n.ConversationId:n.ChannelId,NavigationMessageTime:null,MessageId:null,RequestType:25,RequestId:x.makeId(),Type:0};x.send(e)}},[n]),o.a.createElement("div",{className:"dialog-container",style:Y.getActiveDialog(e.dialogs)?{zIndex:2}:null},o.a.createElement(de,e),Y.getActiveDialog(e.dialogs)?o.a.createElement(_t,Object.assign({dialog:n},e)):null)});var At=Object(c.b)(function(e){return{profile:e.ui.profile,users:e.users,chats:e.chats,node:e.node.activeNode.Domains[0]}},function(e){return{openProfile:function(t){return e(C(t))},openDialog:function(t){return e(T(t))}}})(function(e){var t=Object(r.useState)(!1),a=Object(H.a)(t,2),n=a[0],s=a[1],l=Object(r.useState)(null),c=Object(H.a)(l,2),i=c[0],u=c[1],d=Object(r.useState)(null),m=Object(H.a)(d,2),p=m[0],f=m[1];Object(r.useEffect)(function(){if(e.profile)if(1===e.profile.ConversationType){var t=Y.getUserById(e.profile.SecondUid,e.users);t&&(u(t),s(!0))}else if(e.profile.NameFirst)u(e.profile),s(!0);else if(e.profile.Users)u(e.profile),s(!0);else if(2===e.profile.ConversationType){var a={RequestType:45,ChatsId:[e.profile.ConversationId],RequestId:x.makeId(),Type:0};x.send(a)}},[e.profile]),Object(r.useEffect)(function(){if(e.chats.length){u(e.chats[0]),s(!0);var t=[];if(e.chats[0].Users.map(function(a){Y.getUserById(a.UserId,e.users)||t.push(a.UserId)}),t.length){var a={UsersId:[].concat(t),RequestType:28,RequestId:x.makeId(),Type:0};x.send(a)}}},[e.chats]);var g=function(){s(!1),e.openProfile(null)};return o.a.createElement(me.a,{visible:n,onCancel:g,footer:null,maskClosable:!0},i?o.a.createElement("div",{className:"profile"},p?o.a.createElement("div",{onClick:function(){e.openProfile(p),f(null)}},"\u041d\u0430\u0437\u0430\u0434"):null,i.Photo?o.a.createElement("div",{className:"profile__ava",style:{width:"100px",height:"100px",backgroundSize:"cover",backgroundPosition:"center center",backgroundImage:"url(https://".concat(e.node,":5000/api/Files/").concat(i.Photo,")"),backgroundRepeat:"no-repeat",borderRadius:100,margin:"0 auto"}}):null,i.Name?o.a.createElement("div",{className:"profile__name"},i.Name):o.a.createElement("div",{className:"profile__name"},i.NameFirst?i.NameFirst:null," ",i.NameSecond?i.NameSecond:null),i.Phones&&i.Phones.length>0?o.a.createElement("div",{className:"profile__info"},o.a.createElement("div",{className:"profile__info_name"},"\u0422\u0435\u043b\u0435\u0444\u043e\u043d"),o.a.createElement("div",{className:"profile__info_value"},i.Phones[0].FullNumber)):null,i.Emails?o.a.createElement("div",{className:"profile__info"},o.a.createElement("div",{className:"profile__info_name"},"Email"),o.a.createElement("div",{className:"profile__info_value"},o.a.createElement("a",{href:"mailto:".concat(i.Emails[0])},i.Emails[0]))):null,i.About?o.a.createElement("div",{className:"profile__info"},o.a.createElement("div",{className:"profile__info_name"},"\u041e \u0441\u0435\u0431\u0435"),o.a.createElement("div",{className:"profile__info_value"},i.About)):null,i.Users?o.a.createElement("div",{className:"profile__info"},o.a.createElement("div",{className:"profile__info_name"},"\u0423\u0447\u0430\u0441\u0442\u043d\u0438\u043a\u0438"),o.a.createElement("div",{className:"profile__info_users"},e.chats[0].Users.map(function(t){var a=Y.getUserById(t.UserId,e.users);if(a){var n=null;return a.NameFirst&&(n=a.NameFirst),a.NameSecond&&(n=n+" "+a.NameSecond),o.a.createElement("div",{key:a.Id,className:"profile__info_user",onClick:function(){var t;t=a,f(i),e.openProfile(t)}},a.Photo?o.a.createElement("div",{style:{width:"50px",height:"50px",backgroundSize:"cover",backgroundPosition:"center center",backgroundImage:"url(https://".concat(e.node,":5000/api/Files/").concat(a.Photo,")"),backgroundRepeat:"no-repeat",borderRadius:100,margin:"0 auto",marginTop:"10px"}}):o.a.createElement("div",{className:"profile__info_ava"},Y.getUserInitials(a)),n||"\u0418\u043c\u044f \u0441\u043a\u0440\u044b\u0442\u043e")}}))):null,e.profile?o.a.createElement(X.b,{to:"/",onClick:function(){var t={};t.data=e.profile,"dialog"===e.profile.type?t.type="dialog":t.type="user",e.openDialog(t),g()}},o.a.createElement("div",{className:"profile__open_chat"},"\u041e\u0442\u043a\u0440\u044b\u0442\u044c \u0447\u0430\u0442")):null):null)}),wt=n(466),Pt=n(452),Mt=n(453);var Dt=Object(c.b)(function(e){return{createChatModal:e.ui.modals.createChatModal,node:e.node.activeNode.Domains[0],contacts:e.contacts.users}},function(e){return{toggleModal:function(t){return e(N(t))}}})(function(e){var t=Object(r.useState)(null),a=Object(H.a)(t,2),n=a[0],s=a[1],l=Object(r.useState)(!1),c=Object(H.a)(l,2),i=c[0],u=c[1],m=Object(r.useState)(!1),p=Object(H.a)(m,2),f=p[0],g=p[1],v=Object(r.useState)(!1),h=Object(H.a)(v,2),y=h[0],E=h[1],b=Object(r.useState)(!1),I=Object(H.a)(b,2),T=I[0],S=I[1],C=Object(r.useState)(null),O=Object(H.a)(C,2),N=O[0],k=O[1],R=Object(r.useState)([]),j=Object(H.a)(R,2),_=j[0],U=j[1],A=Object(r.useState)(!1),w=Object(H.a)(A,2),P=w[0],D=w[1];return o.a.createElement(me.a,{visible:e.createChatModal,onCancel:function(){return e.toggleModal("createChatModal")},title:"\u0421\u043e\u0437\u0434\u0430\u043d\u0438\u0435 \u0433\u0440\u0443\u043f\u043f\u043e\u0432\u043e\u0433\u043e \u0447\u0430\u0442\u0430",className:"create-chat-modal",footer:null,maskClosable:!0},o.a.createElement(Nt.a,{listType:"picture-card",className:"avatar-uploader",showUploadList:!1,customRequest:function(t){return function(t){var a=localStorage.getItem("FileAccessToken");Rt.a.defaults.headers.FileAccessToken=a;var n=new FormData;n.append("file",t.file),Rt.a.post("https://".concat(e.node,":5000/api/Files"),n).then(function(e){200===e.status&&(S(!1),k(e.data.File.FileId))}).catch(function(e){console.log(e)})}(t)},beforeUpload:function(e){var t="image/jpeg"===e.type||"image/png"===e.type;return t||wt.a.error("\u041f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442\u0441\u044f \u0442\u043e\u043b\u044c\u043a\u043e \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0430 JPG/PNG \u0444\u0430\u0439\u043b\u043e\u0432!"),t},onChange:function(e){"uploading"!==e.file.status||S(!0)}},T?o.a.createElement(F.a,{type:"loading",className:"loading-icon"}):N?o.a.createElement("img",{src:"https://".concat(e.node,":5000/api/Files/").concat(N),alt:"avatar",style:{width:"100%"}}):o.a.createElement(o.a.Fragment,null,o.a.createElement("p",{className:"ant-upload-drag-icon"},o.a.createElement(F.a,{type:"inbox",style:{fontSize:"40px",color:"#1890ff",marginTop:"15px"}})),o.a.createElement("p",{className:"ant-upload-text"},"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c ",o.a.createElement("br",null)," \u0430\u0432\u0430\u0442\u0430\u0440"))),o.a.createElement(Pt.a,null),o.a.createElement(B.a.Item,{validateStatus:i?"error":"",help:!!i&&"\u042d\u0442\u043e \u043f\u043e\u043b\u0435 \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e \u0434\u043b\u044f \u0437\u0430\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f"},o.a.createElement(J.a,{placeholder:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u0447\u0430\u0442\u0430",onChange:function(e){return t=e.target.value,s(t),u(!1),void(t.length<1&&u(!0));var t}})),o.a.createElement(Pt.a,null),o.a.createElement("div",{className:"switch-label"},o.a.createElement("div",null,"\u041f\u0440\u0438\u0432\u0430\u0442\u043d\u044b\u0439 \u0447\u0430\u0442"),o.a.createElement(Mt.a,{checked:f,onChange:function(e){return g(e)}})),o.a.createElement(Pt.a,null),o.a.createElement("div",{className:"switch-label"},o.a.createElement("div",null,"\u0421\u043e\u0437\u0434\u0430\u0442\u044c \u043a\u0430\u043d\u0430\u043b"),o.a.createElement(Mt.a,{checked:y,onChange:function(e){return E(e)}})),o.a.createElement(Pt.a,null),o.a.createElement(M.a,{type:"normal",block:!0,icon:"usergroup-add",onClick:function(){return D(!P)}},"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439"),P?o.a.createElement("div",{className:"wrap_contacts"},e.contacts.map(function(e){if(e){var t=null;return e.ContactUser.NameFirst&&(t=e.ContactUser.NameFirst),e.ContactUser.NameSecond&&(t=t+" "+e.ContactUser.NameSecond),o.a.createElement("div",{key:e.ContactId,className:_.includes(e.ContactUserId)?"contacts contacts-active":"contacts",onClick:function(){!function(e){var t=Object(d.a)(_);if(_.includes(e)){var a=t.indexOf(e);t.splice(a,1),U(t)}else t.push(e),U(t)}(e.ContactUserId)}},o.a.createElement(pe,{user:e.ContactUser}),t||"\u0418\u043c\u044f \u0441\u043a\u0440\u044b\u0442\u043e")}})):null,o.a.createElement(Pt.a,null),o.a.createElement(M.a,{type:"primary",block:!0,onClick:function(){return function(){if(n){var t=_.map(function(e){return{userId:e}}),a={Chats:[{Id:0,Name:n,Tag:0,Photo:N,About:null,NodesId:null,Visible:null,Public:null,Security:null,Type:1,Users:t}],RequestId:x.makeId(),RequestType:36,Type:0};x.send(a),e.toggleModal("createChatModal")}else u(!0)}()}},"\u0421\u043e\u0437\u0434\u0430\u0442\u044c"))}),Ft=n(456),xt=new(function(){function e(){Object(k.a)(this,e)}return Object(R.a)(e,[{key:"getDialogs",value:function(){var e={NavigationMessageTime:null,RequestId:x.makeId(),RequestType:12,Type:0};x.send(e)}},{key:"getUserContacts",value:function(){var e={RequestId:x.makeId(),RequestType:64,Type:0};x.send(e)}},{key:"getUsers",value:function(e){var t={RequestId:x.makeId(),RequestType:28,Type:0,UsersId:e};x.send(t)}},{key:"getUsers",value:function(e){var t={RequestId:x.makeId(),RequestType:28,Type:0,UsersId:e};x.send(t)}},{key:"getUserGroups",value:function(){var e={RequestId:x.makeId(),RequestType:61,Type:0};x.send(e)}},{key:"getGroupContacts",value:function(e){var t={RequestId:x.makeId(),RequestType:60,Type:0,GroupId:e};x.send(t)}},{key:"editUser",value:function(e){var t={User:{NameFirst:e.NameFirst,NameSecond:e.NameSecond,About:e.About,Photo:e.Photo,Country:null,Language:null,Visible:null,Security:null,Phones:null,Emails:null},RequestId:x.makeId(),RequestType:10,Type:0};x.send(t)}},{key:"createChat",value:function(e){x.send({Chats:[{Id:0,Name:"NEW CHAT",Tag:0,Photo:null,About:"about chat",NodesId:null,Visible:null,Public:null,Security:null,Type:1,Users:[{ChatId:0,UserId:1,Deleted:!1,Banned:!1,UserRole:0,UserInfo:null},{ChatId:0,UserId:2,Deleted:!1,Banned:!1,UserRole:0,UserInfo:null}]}],RequestId:0x2f01c9145555a000,RequestType:36,Type:0})}}]),e}());var qt=Object(c.b)(function(e){return{contactsModal:e.ui.modals.contactsModal,users:e.users,contacts:e.contacts.users,contactsIDs:e.contacts.usersIDs,groups:e.contacts.groups}},function(e){return{toggleModal:function(t){return e(N(t))},openDialog:function(t){return e(T(t))}}})(function(e){var t=Ft.a.TabPane;Object(r.useEffect)(function(){xt.getUserContacts(),xt.getUserGroups()},[]);var a=function(){return e.contacts.map(function(t){return o.a.createElement("div",{className:"contact",key:t.ContactId,onClick:function(){return function(t){var a={};a.data=t,a.type="user",e.openDialog(a),e.toggleModal("close")}(t.ContactUser)}},o.a.createElement(pe,{user:t.ContactUser}),o.a.createElement("div",{className:"name"},"".concat(t.ContactUser.NameFirst," ").concat(t.ContactUser.NameSecond)))})};return o.a.createElement(me.a,{visible:e.contactsModal,onCancel:function(){return e.toggleModal("contactsModal")},title:"\u041a\u043e\u043d\u0442\u0430\u043a\u0442\u044b",footer:null,maskClosable:!0,className:"contacts"},o.a.createElement(Ft.a,{defaultActiveKey:"1",onChange:function(e){"all"===e?xt.getUserContacts():xt.getGroupContacts(e)}},o.a.createElement(t,{tab:"\u0412\u0441\u0435",key:"all"},a()),e.groups.map(function(e){return o.a.createElement(t,{tab:e.Title,key:e.GroupId},a())})))});n(459).a.Title;var Gt=Object(c.b)(function(e){return{contactsGroupsModal:e.ui.modals.contactsGroupsModal,users:e.users,contacts:e.contacts.users,contactsIDs:e.contacts.usersIDs,groups:e.contacts.groups}},function(e){return{toggleModal:function(t){return e(N(t))}}})(function(e){var t=Object(r.useState)(null),a=Object(H.a)(t,2),n=a[0],s=a[1],l=Object(r.useState)(!1),c=Object(H.a)(l,2),i=c[0],u=c[1],m=Object(r.useState)(!1),p=Object(H.a)(m,2),f=p[0],g=p[1],v=Object(r.useState)(!1),h=Object(H.a)(v,2),y=h[0],E=h[1],b=Object(r.useState)([]),I=Object(H.a)(b,2),T=I[0],S=I[1],C=Object(r.useState)(!1),O=Object(H.a)(C,2),N=O[0],k=O[1],R=function(e){s(e),u(!1),e.length<1&&u(!0)},j=function(t){var a=e.groups.find(function(e){return e.GroupId===t});a&&g(a)},_=function(){if(n){var t={Group:{GroupId:f?f.GroupId:null,Title:n,UsersId:T},RequestId:x.makeId(),RequestType:56,Type:0};x.send(t),e.toggleModal("contactsGroupsModal")}else u(!0)},U=function(){return e.contacts.map(function(e){if(e){var t=null;return e.ContactUser.NameFirst&&(t=e.ContactUser.NameFirst),e.ContactUser.NameSecond&&(t=t+" "+e.ContactUser.NameSecond),o.a.createElement("div",{key:e.ContactId,className:T.includes(e.ContactUserId)?"contacts contacts-active":"contacts",onClick:function(){!function(e){var t=Object(d.a)(T);if(T.includes(e)){var a=t.indexOf(e);t.splice(a,1),S(t)}else t.push(e),S(t)}(e.ContactUserId)}},o.a.createElement(pe,{user:e.ContactUser}),t||"\u0418\u043c\u044f \u0441\u043a\u0440\u044b\u0442\u043e")}})};return o.a.createElement(me.a,{visible:!0,onCancel:function(){return e.toggleModal("contactsGroupsModal")},title:"\u0413\u0440\u0443\u043f\u043f\u044b \u043a\u043e\u043d\u0442\u0430\u043a\u0442\u043e\u0432",footer:null,maskClosable:!0,className:"contacts create-chat-modal"},y?o.a.createElement("div",{className:"content"},o.a.createElement(B.a.Item,{validateStatus:i?"error":"",help:!!i&&"\u042d\u0442\u043e \u043f\u043e\u043b\u0435 \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e \u0434\u043b\u044f \u0437\u0430\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f"},o.a.createElement(J.a,{placeholder:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u0433\u0440\u0443\u043f\u043f\u044b",onChange:function(e){return R(e.target.value)}})),o.a.createElement(Pt.a,null),o.a.createElement("div",null),o.a.createElement(M.a,{type:"normal",block:!0,icon:"usergroup-add",onClick:function(){return k(!N)}},"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439"),N?o.a.createElement("div",{className:"wrap_contacts"},U()):null,o.a.createElement(Pt.a,null),o.a.createElement(M.a,{type:"primary",block:!0,onClick:function(){return _()}},"\u0421\u043e\u0437\u0434\u0430\u0442\u044c \u0433\u0440\u0443\u043f\u043f\u0443")):f?o.a.createElement("div",{className:"content"},o.a.createElement(J.a,{defaultValue:n||f.Title,onChange:function(e){return R(e.target.value)}}),o.a.createElement("div",{className:"wrap_contacts"},e.contacts.map(function(e){if(e.GroupsId.includes(f.GroupId)){var t=null;return e.ContactUser.NameFirst&&(t=e.ContactUser.NameFirst),e.ContactUser.NameSecond&&(t=t+" "+e.ContactUser.NameSecond),o.a.createElement("div",{key:e.ContactId,className:"contacts"},o.a.createElement(pe,{user:e.ContactUser}),t||"\u0418\u043c\u044f \u0441\u043a\u0440\u044b\u0442\u043e")}})),o.a.createElement(Pt.a,null),o.a.createElement(M.a,{type:"normal",block:!0,icon:"usergroup-add",onClick:function(){return k(!N)}},"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439"),N?o.a.createElement("div",{className:"wrap_contacts"},U()):null,o.a.createElement(Pt.a,null),o.a.createElement(M.a,{type:"primary",block:!0,onClick:function(){return _()}},"\u041e\u0431\u043d\u043e\u0432\u0438\u0442\u044c \u0433\u0440\u0443\u043f\u043f\u0443")):o.a.createElement(o.a.Fragment,null,e.groups.map(function(e){return o.a.createElement("div",{className:"contact",key:e.GroupId,onClick:function(){return j(e.GroupId)}},o.a.createElement("div",{className:"name"},e.Title))}),o.a.createElement("div",{className:"content"},o.a.createElement(M.a,{type:"primary",block:!0,onClick:function(){return E(!0)}},"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0433\u0440\u0443\u043f\u043f\u0443"))))}),Lt=n(463);var Vt=Object(c.b)(function(e){return{settingsModal:e.ui.modals.settingsModal,user:e.users.find(function(e){return!0===e.currentUser}),node:e.node.activeNode.Domains[0]}},function(e){return{toggleModal:function(t){return e(N(t))}}})(function(e){var t=Object(r.useState)(!1),a=Object(H.a)(t,2),n=a[0],s=a[1],l=Object(r.useState)(!1),c=Object(H.a)(l,2),i=c[0],u=c[1],d=Object(r.useState)(""),m=Object(H.a)(d,2),p=m[0],f=m[1],g=Object(r.useState)(""),v=Object(H.a)(g,2),h=v[0],y=v[1],E=Object(r.useState)(""),b=Object(H.a)(E,2),I=b[0],T=b[1];Object(r.useEffect)(function(){e.user&&(f(e.user.NameFirst),y(e.user.NameSecond),T(e.user.About),u(e.user.Photo))},[e.user]);var S=o.a.createElement("div",null,o.a.createElement(F.a,{type:n?"loading":"plus"}),o.a.createElement("div",{className:"ant-upload-text"},"Upload"));return o.a.createElement(me.a,{visible:e.settingsModal,onCancel:function(){return e.toggleModal("settingsModal")},title:"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043f\u0440\u043e\u0444\u0438\u043b\u044c",footer:null,maskClosable:!0,className:"contacts"},e.user?o.a.createElement("div",{className:"content settings"},o.a.createElement(Nt.a,{listType:"picture-card",className:"avatar-uploader",showUploadList:!1,customRequest:function(t){return function(t){var a=localStorage.getItem("FileAccessToken");Rt.a.defaults.headers.FileAccessToken=a;var n=new FormData;n.append("file",t.file),Rt.a.post("https://".concat(e.node,":5000/api/Files"),n).then(function(e){200===e.status&&(s(!1),u(e.data.File.FileId))}).catch(function(e){console.log(e)})}(t)},beforeUpload:function(e){var t="image/jpeg"===e.type||"image/png"===e.type;return t||wt.a.error("\u041f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442\u0441\u044f \u0442\u043e\u043b\u044c\u043a\u043e \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0430 JPG/PNG \u0444\u0430\u0439\u043b\u043e\u0432!"),t},onChange:function(e){"uploading"!==e.file.status||s(!0)}},n?o.a.createElement(F.a,{type:"loading",className:"loading-icon"}):null,i?o.a.createElement("img",{src:"https://".concat(e.node,":5000/api/Files/").concat(i),alt:"avatar",style:{width:"100%"}}):e.user.Photo?o.a.createElement(pe,{user:e.user}):S),o.a.createElement(Pt.a,null),o.a.createElement(J.a,{value:h,onChange:function(e){return y(e.target.value)},placeholder:"\u0424\u0430\u043c\u0438\u043b\u0438\u044f"}),o.a.createElement(Pt.a,null),o.a.createElement(J.a,{value:p,onChange:function(e){return f(e.target.value)},placeholder:"\u0418\u043c\u044f"}),o.a.createElement(Pt.a,null),o.a.createElement(J.a,{value:I,onChange:function(e){return T(e.target.value)},placeholder:"\u041e \u0441\u0435\u0431\u0435"}),o.a.createElement(Pt.a,null),o.a.createElement(J.a,{addonBefore:"+7",defaultValue:e.user.Phones[0]?e.user.Phones[0].SubscriberNumber:"",placeholder:"\u0422\u0435\u043b\u0435\u0444\u043e\u043d",disabled:!0}),o.a.createElement(Pt.a,null),o.a.createElement(J.a,{defaultValue:e.user.Emails[0],placeholder:"Email",disabled:!0}),o.a.createElement(Pt.a,null),o.a.createElement(M.a,{type:"primary",block:!0,onClick:function(){return function(){var e={NameFirst:p,NameSecond:h,About:I,Photo:i};xt.editUser(e)}()}},"\u041e\u0431\u043d\u043e\u0432\u0438\u0442\u044c")):null)});var Ht=Object(c.b)(function(e){return{dialogs:e.dialogs,ui:e.ui,user:e.users.find(function(e){return!0===e.currentUser}),node:e.node.activeNode.Domains[0]}},function(e){return{toggleDrawer:function(){return e(O())},toggleModal:function(t){return e(N(t))}}})(function(e){var t=Object(r.useState)(document.body.clientWidth),a=Object(H.a)(t,2),n=(a[0],a[1]);return window.addEventListener("resize",function(){n(document.body.clientWidth)},!1),o.a.createElement(X.a,null,o.a.createElement("div",{className:"page"},o.a.createElement("div",{className:"page__content"},o.a.createElement(Lt.a,{visible:!0,placement:"left",closable:!0,onClose:function(){return e.toggleDrawer()},width:"366"},e.user?o.a.createElement("div",{className:"drawer-user"},o.a.createElement("div",{className:"drawer-user__ava"},e.user.Photo?o.a.createElement("div",{style:{width:"100%",height:"100%",backgroundSize:"cover",backgroundPosition:"center center",backgroundImage:"url(https://".concat(e.node,":5000/api/Files/").concat(e.user.Photo,")"),backgroundRepeat:"no-repeat"}}):o.a.createElement("div",{className:"drawer-user__photo-default avatar-default"},"defaultAva")),o.a.createElement("div",{className:"drawer-user__name"},e.user.NameFirst+" "+e.user.NameSecond)):null,o.a.createElement("ul",{className:"menu"},o.a.createElement("li",{onClick:function(){return e.toggleModal("createChatModal")}},"\u0421\u043e\u0437\u0434\u0430\u0442\u044c \u0433\u0440\u0443\u043f\u043f\u043e\u0432\u043e\u0439 \u0447\u0430\u0442"),o.a.createElement("li",{onClick:function(){return e.toggleModal("contactsModal")}},"\u041a\u043e\u043d\u0442\u0430\u043a\u0442\u044b"),o.a.createElement("li",{onClick:function(){return e.toggleModal("contactsGroupsModal")}},"\u0413\u0440\u0443\u043f\u043f\u044b \u043a\u043e\u043d\u0442\u0430\u043a\u0442\u043e\u0432"),o.a.createElement("li",{onClick:function(){return e.toggleModal("settingsModal")}},"\u041d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438"))),o.a.createElement(o.a.Fragment,null,o.a.createElement(se,e),o.a.createElement(Ut,null)))),o.a.createElement(At,null),o.a.createElement(Dt,null),o.a.createElement(qt,null),o.a.createElement(Gt,null),o.a.createElement(Vt,null))});var Bt=Object(c.b)(function(e){return{users:e.users}},function(e){return{dialogsReceived:function(t){return e(E(t))},chatsReceived:function(t){return e(function(e){return{type:"CHATS_RECEIVED",chats:e}}(t))},chatsUsersReceived:function(t){return e(function(e){return{type:"CHATS_USERS_RECEIVED",chatsUsers:e}}(t))},openDialog:function(t){return e(T(t))},userReceived:function(t){return e(S(t))},messagesReceived:function(t){return e(b(t))},readMessages:function(t){return e(function(e){return{type:"READ_MESSAGES",data:e}}(t))},setAuth:function(t){return e(K(t))},searchResultReceived:function(t){return e({type:"SEARCH_RESULT_RECEIVED",searchResult:t})},setContactUsersIDs:function(t){return e(function(e){return{type:"SET_CONTACT_USERS_IDS",usersIDs:e}}(t))},userGroupsReceived:function(t){return e(function(e){return{type:"USER_GROUPS_RECEIVED",groups:e}}(t))},setContacts:function(t){return e(function(e){return{type:"SET_CONTACTS",contacts:e}}(t))},toggleModal:function(t){return e(N(t))},toggleDrawer:function(t){return e(O(t))}}})(function(e){return Object(r.useEffect)(function(){x.onMessage=function(t){if(6===t.ResponseType){var a={RequestId:x.makeId(),RequestType:27,Type:0};x.send(a),localStorage.setItem("FileAccessToken",t.FileAccessToken),localStorage.setItem("AccessToken",t.Token.AccessToken),localStorage.setItem("RefreshToken",t.Token.RefreshToken),e.setAuth("AUTH_SUCCESS")}else if(12===t.ResponseType){var n=Y.getFormatedUser([t.User]);n[0].currentUser=!0,e.userReceived(n),e.toggleModal("close"),e.toggleDrawer("close")}else if(15===t.ResponseType)e.dialogsReceived(Y.getFormatedDialogs(t.Conversations));else if(9===t.ResponseType)e.messagesReceived(Y.getFormatedMessages(t.Messages));else if(t.Message)e.messagesReceived(Y.getFormatedMessages([t.Message])),xt.getDialogs();else if(2===t.Type&&5===t.Code)e.readMessages({conversationId:t.ConversationId,conversationType:t.ConversationType});else if(0===t.ResponseType)e.userReceived(Y.getFormatedUser(t.Users));else if(2===t.ResponseType)Y.getFormatedChats(t.Chats).forEach(function(e){var t={ChatId:e.Id,NavigationUserId:null,RequestId:x.makeId(),RequestType:17,Type:0};x.send(t)}),e.chatsReceived(Y.getFormatedChats(t.Chats));else if(16===t.ResponseType)e.chatsUsersReceived(Y.getFormatedChatsUsers(t.ChatUsers));else if(21===t.ResponseType)xt.getDialogs();else if(23===t.ResponseType){var r={};t.Users.length>0&&(r.users=t.Users),t.Chats.length>0&&(r.chats=t.Chats),t.Channels.length>0&&(r.channels=t.Channels),e.searchResultReceived(r)}else if(27===t.ResponseType){var o=t.Contacts.map(function(e){return e.ContactUserId});e.setContactUsersIDs(o),e.setContacts(t.Contacts),o.length>0&&xt.getUsers(o)}else 26===t.ResponseType?e.userGroupsReceived(t.Groups):5===t.Code&&e.messagesRead(t.ConversationId)}},[]),null}),Jt=new WebSocket("wss://testlic-1.ymess.org:5005");var zt=Object(c.b)(function(e){return{dialogs:e.dialogs,users:e.users,auth:e.auth,path:e.path.currentPath}},function(e){return{dialogsReceived:function(t){return e(E(t))},openDialog:function(t){return e(T(t))},userReceived:function(t){return e(S(t))},messagesReceived:function(t){return e(b(t))},setAuth:function(t){return e(K(t))},setNodes:function(t){return e(function(e){return{type:"SET_NODES",nodes:e}}(t))},setActiveNode:function(t){return e(q(t))},setPath:function(t){return e(G(t))},setAppFocus:function(t){return e(function(e){return{type:"SET_APP_FOCUS",data:e}}(t))}}})(function(e){return window.onfocus=function(){e.setAppFocus(!0)},window.onblur=function(){e.setAppFocus(!1)},Object(r.useEffect)(function(){if("AUTH_SUCCESS"===e.auth){var t={NavigationMessageTime:null,RequestId:x.makeId(),RequestType:12,Type:0};x.send(t)}},[e.auth]),Object(r.useEffect)(function(){Jt.onopen=function(){var e={RequestId:x.makeId(),RequestType:1,Type:6};Jt.send(JSON.stringify(e))},Jt.onmessage=function(t){var a=x.blobToJson(t.data);2===a.ResponseType&&(e.setNodes(a.Nodes),localStorage.getItem("node")&&e.setActiveNode(JSON.parse(localStorage.getItem("node"))))};var t,a=JSON.parse(localStorage.getItem("node"));a&&e.setActiveNode(a),localStorage.getItem("AccessToken")?(localStorage.getItem("User")?t={Token:{UserId:JSON.parse(localStorage.getItem("User")).Id,AccessToken:localStorage.getItem("AccessToken"),RefreshToken:localStorage.getItem("RefreshToken")},LoginType:0,UidType:1,RequestId:x.makeId(),RequestType:33,Type:0}:localStorage.getItem("Phone")?t={Uid:localStorage.getItem("Phone"),Token:{AccessToken:localStorage.getItem("AccessToken"),RefreshToken:localStorage.getItem("RefreshToken")},LoginType:0,UidType:0,RequestId:x.makeId(),RequestType:33,Type:0}:localStorage.getItem("Email")&&console.log("\u041f\u043e \u043f\u043e\u0447\u0442\u0435"),x.start(a.Domains[0]),x.wsOnConnect=function(){x.send(t)}):e.setAuth("NO_AUTH")},[]),o.a.createElement(o.a.Fragment,null,o.a.createElement(Bt,null),"CHECK_AUTH"===e.auth?o.a.createElement("div",{className:"preloader"},o.a.createElement(y.a,{size:"large"})):"AUTH_SUCCESS"===e.auth?o.a.createElement(Ht,null):"by-phone"===e.path||"by-email"===e.path?o.a.createElement(Z,null):"registration"===e.path?o.a.createElement(z,null):o.a.createElement(V,null))});Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var Wt,Kt=Object(i.d)(h,Wt,Object(i.a)(u.a));l.a.render(o.a.createElement(c.a,{store:Kt},o.a.createElement(X.a,null,o.a.createElement(zt,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[221,1,2]]]);
//# sourceMappingURL=main.254b9b45.chunk.js.map